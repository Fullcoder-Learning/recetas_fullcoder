<!DOCTYPE html>
<html  lang="es">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

      <title>Fullstack Symfony Task Learn</title>
    
          <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
          <link rel="stylesheet" href="../_static/theme.css " type="text/css" />
      
      <!-- sphinx script_files -->
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/translations.js"></script>

      
      <!-- bundled in js (rollup iife) -->
      <!-- <script src="../_static/theme-vendors.js"></script> -->
      <script src="../_static/theme.js" defer></script>
    
      <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <link rel="index" title="Índice" href="../genindex.html" />
  <link rel="search" title="Búsqueda" href="../search.html" />
  <link rel="prev" title="Frontend Angular Task Learn" href="../frontend/angular.html" /> 
  </head>

  <body>
    <div id="app">
    <div class="theme-container" :class="pageClasses"><navbar @toggle-sidebar="toggleSidebar">
  <router-link to="../index.html" class="home-link">
    
      <img class="logo" src="../_static/fullcoderlogo.png" alt="logo"/>
    
  </router-link>

  <div class="links">
    <navlinks class="can-hide">

  
    <div class="nav-item">
      <a href="../index.html#recetas-fullcoder-agile-learning-practico"
         class="nav-link ">
         Proyectos Backend
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../index.html#recetas-fullcoder-agile-learning-practico"
         class="nav-link ">
         Proyectos Frontend
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../index.html#recetas-fullcoder-agile-learning-practico"
         class="nav-link  router-link-active">
         Proyectos Fullstack
      </a>
    </div>
  



    </navlinks>
  </div>
</navbar>

      
      <div class="sidebar-mask" @click="toggleSidebar(false)">
      </div>
        <sidebar @toggle-sidebar="toggleSidebar">
          
          <navlinks>
            

  
    <div class="nav-item">
      <a href="../index.html#recetas-fullcoder-agile-learning-practico"
         class="nav-link ">
         Proyectos Backend
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../index.html#recetas-fullcoder-agile-learning-practico"
         class="nav-link ">
         Proyectos Frontend
      </a>
    </div>
  
    <div class="nav-item">
      <a href="../index.html#recetas-fullcoder-agile-learning-practico"
         class="nav-link  router-link-active">
         Proyectos Fullstack
      </a>
    </div>
  



            
          </navlinks><div id="searchbox" class="searchbox" role="search">
  <div class="caption"><span class="caption-text">Búsqueda rápida</span>
    <div class="searchformwrapper">
      <form class="search" action="../search.html" method="get">
        <input type="text" name="q" />
        <input type="submit" value="Búsqueda" />
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div><div class="sidebar-links" role="navigation" aria-label="main navigation">
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../index.html#recetas-fullcoder-agile-learning-practico">Proyectos Backend</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 ">
            
              <a href="../backend/api-node.html" class="reference internal ">Backend NodeJS + ExpressJS - API Task Learn</a>
            

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../index.html#recetas-fullcoder-agile-learning-practico">Proyectos Frontend</a></span>
      </p>
      <ul class="">
        
          <li class="toctree-l1 ">
            
              <a href="../frontend/react.html" class="reference internal ">Frontend React Task Learn</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="../frontend/angular.html" class="reference internal ">Frontend Angular Task Learn</a>
            

            
          </li>

        
      </ul>
    </div>
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../index.html#recetas-fullcoder-agile-learning-practico">Proyectos Fullstack</a></span>
      </p>
      <ul class="current">
        
          <li class="toctree-l1 current">
            
              <a href="#" class="reference internal current">Fullstack Symfony Task Learn</a>
            

            
              <ul>
                
                  <li class="toctree-l2"><a href="#fase-1-sistema-de-tareas" class="reference internal">Fase 1: Sistema de Tareas</a></li>
                
                  <li class="toctree-l2"><a href="#fase-2-autenticacion-y-perfil" class="reference internal">Fase 2: Autenticación y perfil</a></li>
                
              </ul>
            
          </li>

        
      </ul>
    </div>
  
</div>
        </sidebar>

      <page>
          <div class="body-header" role="navigation" aria-label="navigation">
  
  <ul class="breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
    
    <li>Fullstack Symfony Task Learn</li>
  </ul>
  

  <ul class="page-nav">
  <li class="prev">
    <a href="../frontend/angular.html"
       title="capítulo anterior">← Frontend Angular Task Learn</a>
  </li>
</ul>
  
</div>
<hr>
          <div class="content" role="main" v-pre>
            
  <section id="fullstack-symfony-task-learn">
<h1><a class="toc-backref" href="#id1">Fullstack Symfony Task Learn</a><a class="headerlink" href="#fullstack-symfony-task-learn" title="Enlazar permanentemente con este título">¶</a></h1>
<a class="reference internal image-reference" href="../_images/symfony-logo.png"><img alt="Logo Symfony" class="align-center" src="../_images/symfony-logo.png" style="width: 768.0px; height: 215.7px;" /></a>
<p>Proyecto Lista de tareas con sistema de autenticación en Symfony 6.2.</p>
<ul class="simple">
<li><p>Repositorio proyecto completo: <a class="reference external" href="https://github.com/Fullcoder-Learning/symfony-task-learn">https://github.com/Fullcoder-Learning/symfony-task-learn</a></p></li>
</ul>
<div class="contents topic" id="indice">
<p class="topic-title">Índice</p>
<ul class="simple">
<li><p><a class="reference internal" href="#fullstack-symfony-task-learn" id="id1">Fullstack Symfony Task Learn</a></p>
<ul>
<li><p><a class="reference internal" href="#fase-1-sistema-de-tareas" id="id2">Fase 1: Sistema de Tareas</a></p>
<ul>
<li><p><a class="reference internal" href="#paso-1-instalaciones" id="id3">Paso 1: Instalaciones</a></p>
<ul>
<li><p><a class="reference internal" href="#en-windows" id="id4">En Windows</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#paso-2-preparar-proyecto" id="id5">Paso 2: Preparar proyecto</a></p></li>
<li><p><a class="reference internal" href="#paso-3-conectar-a-la-base-de-datos" id="id6">Paso 3: Conectar a la base de datos</a></p></li>
<li><p><a class="reference internal" href="#paso-4-crear-controlador-para-tareas-taskcontroller" id="id7">Paso 4: Crear controlador para Tareas (TaskController)</a></p></li>
<li><p><a class="reference internal" href="#paso-5-preparar-plantilla-base" id="id8">Paso 5: Preparar plantilla base</a></p></li>
<li><p><a class="reference internal" href="#paso-6-crear-listado-de-tareas" id="id9">Paso 6: Crear listado de tareas</a></p></li>
<li><p><a class="reference internal" href="#paso-7-crear-modelo-de-datos-task" id="id10">Paso 7: Crear modelo de datos (Task)</a></p></li>
<li><p><a class="reference internal" href="#paso-8-listar-tareas" id="id11">Paso 8: Listar tareas</a></p></li>
<li><p><a class="reference internal" href="#paso-9-crear-tareas" id="id12">Paso 9: Crear tareas</a></p></li>
<li><p><a class="reference internal" href="#paso-10-finalizar-y-eliminar-tarea" id="id13">Paso 10: Finalizar y eliminar Tarea</a></p></li>
<li><p><a class="reference internal" href="#paso-11-editar-tareas" id="id14">Paso 11: Editar tareas</a></p></li>
<li><p><a class="reference internal" href="#paso-12-subir-cambios-a-github" id="id15">Paso 12: Subir cambios a GitHub</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#fase-2-autenticacion-y-perfil" id="id16">Fase 2: Autenticación y perfil</a></p>
<ul>
<li><p><a class="reference internal" href="#paso-1-preparar-proyecto" id="id17">Paso 1: Preparar proyecto</a></p></li>
<li><p><a class="reference internal" href="#paso-2-crear-modelo-de-usuarios" id="id18">Paso 2: Crear modelo de usuarios</a></p></li>
<li><p><a class="reference internal" href="#paso-3-establecer-relacion-entre-usuarios-y-tareas" id="id19">Paso 3: Establecer relación entre usuarios y tareas</a></p></li>
<li><p><a class="reference internal" href="#paso-4-crear-registro-de-usuarios" id="id20">Paso 4: Crear registro de usuarios</a></p></li>
<li><p><a class="reference internal" href="#paso-5-crear-login-e-iniciar-sesion" id="id21">Paso 5: Crear Login e iniciar sesión</a></p></li>
<li><p><a class="reference internal" href="#paso-6-crear-logout" id="id22">Paso 6: Crear Logout</a></p></li>
<li><p><a class="reference internal" href="#paso-7-modificar-aspecto-de-login-y-registro" id="id23">Paso 7: Modificar Aspecto de Login y Registro</a></p></li>
<li><p><a class="reference internal" href="#paso-8-relacionar-tareas-con-usuarios" id="id24">Paso 8: Relacionar tareas con usuarios</a></p></li>
<li><p><a class="reference internal" href="#paso-9-perfil-de-usuario-y-edicion" id="id25">Paso 9: Perfil de usuario y edición</a></p></li>
<li><p><a class="reference internal" href="#paso-10-cargar-avatar-rutas-y-nombre-en-navbar" id="id26">Paso 10: Cargar avatar, rutas y nombre en navbar</a></p></li>
<li><p><a class="reference internal" href="#paso-11-securizar-rutas" id="id27">Paso 11: Securizar Rutas</a></p></li>
<li><p><a class="reference internal" href="#paso-12-recuperar-contrasena-email" id="id28">Paso 12: Recuperar contraseña (email)</a></p></li>
<li><p><a class="reference internal" href="#paso-13-recuperar-contrasena-pagina-de-recuperacion" id="id29">Paso 13: Recuperar contraseña (pagina de recuperación)</a></p></li>
<li><p><a class="reference internal" href="#paso-14-crear-alertas" id="id30">Paso 14: Crear alertas</a></p></li>
<li><p><a class="reference internal" href="#paso-15-eliminar-usuario" id="id31">Paso 15: Eliminar Usuario</a></p></li>
<li><p><a class="reference internal" href="#paso-16-subir-cambios-a-github" id="id32">Paso 16: Subir cambios a GitHub</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<section id="fase-1-sistema-de-tareas">
<h2><a class="toc-backref" href="#id2">Fase 1: Sistema de Tareas</a><a class="headerlink" href="#fase-1-sistema-de-tareas" title="Enlazar permanentemente con este título">¶</a></h2>
<p>En esta fase se va a crear la base del proyecto y todo el CRUD de tareas.</p>
<section id="paso-1-instalaciones">
<h3><a class="toc-backref" href="#id3">Paso 1: Instalaciones</a><a class="headerlink" href="#paso-1-instalaciones" title="Enlazar permanentemente con este título">¶</a></h3>
<section id="en-windows">
<h4><a class="toc-backref" href="#id4">En Windows</a><a class="headerlink" href="#en-windows" title="Enlazar permanentemente con este título">¶</a></h4>
<ul class="simple">
<li><p>En un terminal ejecutamos <code class="docutils literal notranslate"><span class="pre">php</span> <span class="pre">--version</span></code> para comprobar si esta instalado.</p></li>
<li><p>Instalar composer: <a class="reference external" href="https://getcomposer.org/download/">https://getcomposer.org/download/</a></p></li>
<li><p>Instalar DBbowser: <a class="reference external" href="https://sqlitebrowser.org/">https://sqlitebrowser.org/</a></p></li>
<li><p>Instalar WAMPP para usar mysql (elige la versión 8 durante la instalación): <a class="reference external" href="https://sourceforge.net/projects/wampserver/files/WampServer%203/WampServer%203.0.0/wampserver3.2.6_x64.exe/download">https://sourceforge.net/projects/wampserver/files/WampServer%203/WampServer%203.0.0/wampserver3.2.6_x64.exe/download</a></p></li>
<li><p>Para abrir WAMP es probable que te haga falta el siguiente paquete en Windows: <a class="reference external" href="https://www.microsoft.com/es-es/download/details.aspx?id=30679">https://www.microsoft.com/es-es/download/details.aspx?id=30679</a></p></li>
<li><p>En un tertminal ejecutamos <code class="docutils literal notranslate"><span class="pre">componser</span> <span class="pre">--version</span></code> para comprobar si esta instalado.</p></li>
<li><dl class="simple">
<dt>Ahora instalamos doctrine para trabajar con modelos de datos:</dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">composer</span> <span class="pre">require</span> <span class="pre">symfony/orm-pack</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">composer</span> <span class="pre">require</span> <span class="pre">--dev</span> <span class="pre">symfony/maker-bundle</span></code></p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
</section>
<section id="paso-2-preparar-proyecto">
<h3><a class="toc-backref" href="#id5">Paso 2: Preparar proyecto</a><a class="headerlink" href="#paso-2-preparar-proyecto" title="Enlazar permanentemente con este título">¶</a></h3>
<ul class="simple">
<li><p>Crear el proyecto con composer ejecutando el comando: <code class="docutils literal notranslate"><span class="pre">composer</span> <span class="pre">create-project</span> <span class="pre">symfony/website-skeleton</span> <span class="pre">task-learn-symfony</span></code></p></li>
<li><p>Crear un repositorio en github, gitlab o simil.</p></li>
<li><p>Accedemos a la carpeta <strong>task-learn-symfony</strong></p></li>
<li><p>Inicializar repositorio: <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">init</span></code></p></li>
<li><p>Añadir repositorio remoto: <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">remote</span> <span class="pre">add</span> <span class="pre">origin</span> <span class="pre">https://github.com/Fullcoder-Learning/symfony-task-learn.git</span></code></p></li>
<li><p>Añadir cambios: <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">add</span> <span class="pre">.</span></code></p></li>
<li><p>Hacer primer commit: <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">commit</span> <span class="pre">-am</span> <span class="pre">&quot;first</span> <span class="pre">commit&quot;</span></code></p></li>
<li><p>Subir cambios a repositorio remoto: <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">push</span> <span class="pre">origin</span> <span class="pre">master</span></code></p></li>
<li><p>Crear rama desarrollo: <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">checkout</span> <span class="pre">-b</span> <span class="pre">developer</span></code></p></li>
<li><p>Subir rama desarrollo: <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">push</span> <span class="pre">origin</span> <span class="pre">developer</span></code></p></li>
<li><p>Crear rama feature a partir de developer: <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">checkout</span> <span class="pre">-b</span> <span class="pre">feature/phase-1-task-system</span></code></p></li>
<li><p>Desde la terminal acceder a la carpeta public y arrancar el servidor: <code class="docutils literal notranslate"><span class="pre">php</span> <span class="pre">-S</span> <span class="pre">localhost:5000</span></code></p></li>
</ul>
</section>
<section id="paso-3-conectar-a-la-base-de-datos">
<h3><a class="toc-backref" href="#id6">Paso 3: Conectar a la base de datos</a><a class="headerlink" href="#paso-3-conectar-a-la-base-de-datos" title="Enlazar permanentemente con este título">¶</a></h3>
<ul class="simple">
<li><p>Lo primero será conectar la base de datos, editamos <strong>.env</strong>:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># In all environments, the following files are loaded if they exist,</span>
<span class="c1"># the latter taking precedence over the former:</span>
<span class="c1">#</span>
<span class="c1">#  * .env                contains default values for the environment variables needed by the app</span>
<span class="c1">#  * .env.local          uncommitted file with local overrides</span>
<span class="c1">#  * .env.$APP_ENV       committed environment-specific defaults</span>
<span class="c1">#  * .env.$APP_ENV.local uncommitted environment-specific overrides</span>
<span class="c1">#</span>
<span class="c1"># Real environment variables win over .env files.</span>
<span class="c1">#</span>
<span class="c1"># DO NOT DEFINE PRODUCTION SECRETS IN THIS FILE NOR IN ANY OTHER COMMITTED FILES.</span>
<span class="c1"># https://symfony.com/doc/current/configuration/secrets.html</span>
<span class="c1">#</span>
<span class="c1"># Run &quot;composer dump-env prod&quot; to compile .env files for production use (requires symfony/flex &gt;=1.2).</span>
<span class="c1"># https://symfony.com/doc/current/best_practices.html#use-environment-variables-for-infrastructure-configuration</span>

<span class="c1">###&gt; symfony/framework-bundle ###</span>
<span class="n">APP_ENV</span><span class="o">=</span><span class="n">dev</span>
<span class="n">APP_SECRET</span><span class="o">=</span><span class="n">ed9ab4f4909f4c19450d0ce0d7b82f76</span>
<span class="c1">###&lt; symfony/framework-bundle ###</span>

<span class="c1">###&gt; doctrine/doctrine-bundle ###</span>
<span class="c1"># Format described at https://www.doctrine-project.org/projects/doctrine-dbal/en/latest/reference/configuration.html#connecting-using-a-url</span>
<span class="c1"># IMPORTANT: You MUST configure your server version, either here or in config/packages/doctrine.yaml</span>
<span class="c1"># DATABASE_URL=&quot;sqlite:///%kernel.project_dir%/var/data.db&quot;</span>
<span class="n">DESCOMENTAMOS</span> <span class="n">LA</span> <span class="n">VERSIÓN</span> <span class="n">MYSQL</span> <span class="n">y</span> <span class="n">añadimos</span> <span class="n">los</span> <span class="n">datos</span> <span class="n">de</span> <span class="n">conexión</span> <span class="n">y</span> <span class="n">el</span> <span class="n">nombre</span> <span class="n">de</span> <span class="n">la</span> <span class="n">base</span> <span class="n">de</span> <span class="n">datos</span><span class="p">:</span>
<span class="n">DATABASE_URL</span><span class="o">=</span><span class="s2">&quot;mysql://root:@127.0.0.1:3306/symfony_task_learn?serverVersion=8&amp;charset=utf8mb4&quot;</span>
<span class="c1"># DATABASE_URL=&quot;postgresql://app:!ChangeMe!@127.0.0.1:5432/app?serverVersion=14&amp;charset=utf8&quot;</span>
<span class="c1">###&lt; doctrine/doctrine-bundle ###</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Para crear la base de datos ejecutar en la raiz del proyecto: <code class="docutils literal notranslate"><span class="pre">php</span> <span class="pre">bin/console</span> <span class="pre">doctrine:database:create</span></code></p></li>
</ul>
<div class="admonition attention">
<p class="admonition-title">Atención</p>
<p>Si se utiliza un motor distinto al configurado, ej: MariaDB o MySQL 5.7 en lugar de la 8; puede provocar errores en los metadatos.</p>
</div>
</section>
<section id="paso-4-crear-controlador-para-tareas-taskcontroller">
<h3><a class="toc-backref" href="#id7">Paso 4: Crear controlador para Tareas (TaskController)</a><a class="headerlink" href="#paso-4-crear-controlador-para-tareas-taskcontroller" title="Enlazar permanentemente con este título">¶</a></h3>
<ul class="simple">
<li><p>Desde consola en la raiz ejecutar comando: <code class="docutils literal notranslate"><span class="pre">php</span> <span class="pre">bin/console</span> <span class="pre">make:controller</span> <span class="pre">TaskController</span></code></p></li>
<li><p>Esto ha creado un controlador que se encuntra en <strong>src/Controller/</strong> llamado <strong>TaskController.php</strong>:</p></li>
<li><p>También ha creado una plantilla en <strong>templates</strong> llamada **</p></li>
<li><p>Si vamos a la ruta <a class="reference external" href="http://localhost:5000/task">http://localhost:5000/task</a> veremos la pagina en funcionamiento.</p></li>
<li><p>Vamos a quitar la ruta del controlador <strong>TaskController.php</strong>:</p></li>
</ul>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Bundle\FrameworkBundle\Controller\AbstractController</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Routing\Annotation\Route</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">TaskController</span> <span class="k">extends</span> <span class="nx">AbstractController</span>
<span class="p">{</span>
    <span class="c1">// borrar esta ruta local: #[Route(&#39;/task&#39;, name: &#39;app_task&#39;)]</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;task/index.html.twig&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;controller_name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;TaskController&#39;</span><span class="p">,</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Vamos a la carpeta <strong>config</strong> y añadimos una nueva ruta a <strong>routes.yaml</strong>:</p></li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># borramos y añadimos la ruta para listar tareas:</span><span class="w"></span>
<span class="nt">index</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\TaskController::index</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><p>Ahora podemos ver la nueva ruta directamente en <a class="reference external" href="http://localhost:5000">http://localhost:5000</a></p></li>
</ul>
</section>
<section id="paso-5-preparar-plantilla-base">
<h3><a class="toc-backref" href="#id8">Paso 5: Preparar plantilla base</a><a class="headerlink" href="#paso-5-preparar-plantilla-base" title="Enlazar permanentemente con este título">¶</a></h3>
<ul class="simple">
<li><p>crear dentro de la carpeta <strong>public</strong> la carpeta <strong>assets</strong> y dentro la carpeta <strong>images</strong></p></li>
<li><p>Descargar el avatar genérico y guardar en <strong>images</strong>: <a class="reference external" href="https://raw.githubusercontent.com/Fullcoder-Learning/-task-learning-frontend/master/src/assets/avatar.png">https://raw.githubusercontent.com/Fullcoder-Learning/-task-learning-frontend/master/src/assets/avatar.png</a></p></li>
<li><p>Vamos a editar la plantilla twig en la carpeta <strong>templates</strong> editamos <strong>base.html.twig</strong>:</p></li>
</ul>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>{% block title %}Task Learn{% endblock %}<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;icon&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 128 128%22&gt;&lt;text y=%221.2em%22 font-size=%2296%22&gt;⚫️&lt;/text&gt;&lt;/svg&gt;&quot;</span><span class="p">&gt;</span>
        <span class="cm">&lt;!-- Cargar css bootstrap --&gt;</span>
        <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css&quot;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&quot;sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx&quot;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&quot;anonymous&quot;</span><span class="p">&gt;</span>
        <span class="cm">&lt;!-- Crear nueva hoja css para ajustar valores del nav --&gt;</span>
        <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{asset(&#39;assets/css/base.css&#39;)}}&quot;</span> <span class="p">/&gt;</span>
        {# Run `composer require symfony/webpack-encore-bundle` to start using Symfony UX #}
        {% block stylesheets %}
            {{ encore_entry_link_tags(&#39;app&#39;) }}
        {% endblock %}

        {% block javascripts %}
            {{ encore_entry_script_tags(&#39;app&#39;) }}
        {% endblock %}
    <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
        <span class="cm">&lt;!-- crear navbar --&gt;</span>
        <span class="p">&lt;</span><span class="nt">nav</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar navbar-expand-lg navbar-dark bg-dark&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-11 align-items-start ms-2&quot;</span> <span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ path(&#39;index&#39;) }}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar-brand&quot;</span><span class="p">&gt;</span>Task Learn<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

            <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar-nav mb-2 mb-lg-0 col-md-1 align-items-end me-3&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-item align-items-end&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/users&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-link text-center&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">img</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;avatar rounded img-thumbnail img-fluid&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;./assets/images/avatar.png&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;foto&quot;</span> <span class="p">/&gt;</span>
                        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">small</span><span class="p">&gt;</span>Usuario<span class="p">&lt;/</span><span class="nt">small</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>

        {% block body %}{% endblock %}

        <span class="cm">&lt;!-- cargar scripts de boostrap --&gt;</span>
        <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.min.js&quot;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&quot;sha384-ODmDIVzN+pFdexxHEHFBQH3/9/vQ9uori45z4JjnFsRydbmQbmL5t1tQ0culUzyK&quot;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&quot;anonymous&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Añadimos el estilo para reducir la imagen, para ello creamos dentro de <strong>assests</strong> la carpeta <strong>css</strong> y dentro el archivo <strong>base.css</strong>:</p></li>
</ul>
<div class="highlight-css notranslate"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nc">avatar</span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">height</span><span class="p">:</span><span class="w"> </span><span class="mi">40</span><span class="kt">px</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">40</span><span class="kt">px</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="paso-6-crear-listado-de-tareas">
<h3><a class="toc-backref" href="#id9">Paso 6: Crear listado de tareas</a><a class="headerlink" href="#paso-6-crear-listado-de-tareas" title="Enlazar permanentemente con este título">¶</a></h3>
<ul class="simple">
<li><p>Vamos a crear una lista de tareas dummy en <strong>taskController.php</strong>:</p></li>
</ul>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Bundle\FrameworkBundle\Controller\AbstractController</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Routing\Annotation\Route</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">TaskController</span> <span class="k">extends</span> <span class="nx">AbstractController</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="c1">// crear un objeto dummy para llenar la tabla:</span>
        <span class="nv">$dummyData</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="s2">&quot;_id&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Cocinar&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Cocinar galletas el sábado&quot;</span><span class="p">,</span> <span class="s2">&quot;date_created&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;08/08/2022&quot;</span><span class="p">,</span> <span class="s2">&quot;is_complete&quot;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span> <span class="s2">&quot;date_finish&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;10/08/2022&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;_id&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Preparar proyecto&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Preparar proyecto para presentar en Septiembre&quot;</span><span class="p">,</span> <span class="s2">&quot;date_created&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;15/08/2022&quot;</span><span class="p">,</span> <span class="s2">&quot;is_complete&quot;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;_id&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Estudiar Java&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Aprender Java para cubrir las especificaciones del proyecto&quot;</span><span class="p">,</span> <span class="s2">&quot;date_created&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;19/08/2022&quot;</span><span class="p">,</span> <span class="s2">&quot;is_complete&quot;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">]</span>
        <span class="p">];</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;task/index.html.twig&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;tasks&#39;</span> <span class="o">=&gt;</span> <span class="nv">$dummyData</span><span class="p">,</span> <span class="c1">// le pasamos a la vista la data</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>En la ruta <strong>templates/task</strong> editamos la plantilla <strong>index.html.twig</strong>:</p></li>
</ul>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>{% extends &#39;base.html.twig&#39; %}

{% block title %}Listado de tareas{% endblock %}

{% block body %}

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-center container&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;table mt-4&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span> <span class="na">scope</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>Título<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span> <span class="na">scope</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>Descripción<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span> <span class="na">scope</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>Fecha creación<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span> <span class="na">scope</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>Finalizada<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span> <span class="na">scope</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>Fecha Finalización<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span> <span class="na">scope</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>Operaciones<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">thead</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tbody</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-start&quot;</span><span class="p">&gt;</span>
            {% for task in tasks %}
            <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{task.name}}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{task.description}}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{task.date_created}}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                    {% if task.is_complete == true %}
                    si
                    {% else %}
                    no
                    {% endif %}
                <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                    {% if task.date_finish is defined %}
                        {% if task.date_finish is not null %}
                            {{task.date_finish}}
                        {% endif %}
                    {% endif %}
                <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-center&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-sm btn-primary me-2&quot;</span><span class="p">&gt;</span>finalizar tarea<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-sm btn-danger me-2&quot;</span><span class="p">&gt;</span>Eliminar tarea<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
            {% endfor %}
        <span class="p">&lt;/</span><span class="nt">tbody</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

{% endblock %}
</pre></div>
</div>
</section>
<section id="paso-7-crear-modelo-de-datos-task">
<h3><a class="toc-backref" href="#id10">Paso 7: Crear modelo de datos (Task)</a><a class="headerlink" href="#paso-7-crear-modelo-de-datos-task" title="Enlazar permanentemente con este título">¶</a></h3>
<ul class="simple">
<li><p>Crear una nueva entidad: <code class="docutils literal notranslate"><span class="pre">php</span> <span class="pre">bin/console</span> <span class="pre">make:entity</span> <span class="pre">Task</span></code></p></li>
<li><dl class="simple">
<dt>Desde la consola podemos ir añadiendo los siguientes campos:</dt><dd><ul>
<li><p>name, string, 100, no.</p></li>
<li><p>description, string, 255, yes.</p></li>
<li><p>is_complete, boolean, yes.</p></li>
<li><p>date_created, datetime, no.</p></li>
<li><p>date_finish, datetime, yes.</p></li>
<li><p>Presionar Intro para terminar.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>en src/Entity podemos ver el archivo con las entidades de task llamado <strong>Task.php</strong>.</p></li>
<li><p>Revisar las diferencias con la base de datos actual: <code class="docutils literal notranslate"><span class="pre">php</span> <span class="pre">bin/console</span> <span class="pre">doctrine:migrations:diff</span></code></p></li>
<li><p>Ejecutar migración: <code class="docutils literal notranslate"><span class="pre">php</span> <span class="pre">bin/console</span> <span class="pre">doctrine:migrations:migrate</span></code> confirmamos la operación (los datos existentes se perderán).</p></li>
</ul>
</section>
<section id="paso-8-listar-tareas">
<h3><a class="toc-backref" href="#id11">Paso 8: Listar tareas</a><a class="headerlink" href="#paso-8-listar-tareas" title="Enlazar permanentemente con este título">¶</a></h3>
<ul class="simple">
<li><p>Abrimos la base de datos que se encuentra en <strong>var/data.db</strong> con DBbowser y añadimos una tarea nueva.</p></li>
<li><p>Editamos <strong>TaskController.php</strong>:</p></li>
</ul>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Bundle\FrameworkBundle\Controller\AbstractController</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Routing\Annotation\Route</span><span class="p">;</span>
<span class="c1">// cargamos el entitymanagerinterface:</span>
<span class="k">use</span> <span class="nx">Doctrine\ORM\EntityManagerInterface</span><span class="p">;</span>
<span class="c1">// cargar la entidad de tareas:</span>
<span class="k">use</span> <span class="nx">App\Entity\Task</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">TaskController</span> <span class="k">extends</span> <span class="nx">AbstractController</span>
<span class="p">{</span>
    <span class="c1">// importar en el método la entidad de tareas el entitymanagerinterface:</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">(</span><span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="c1">// recuperar tareas:</span>
        <span class="nv">$tasks</span> <span class="o">=</span> <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="nx">Task</span><span class="o">::</span><span class="na">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">findAll</span><span class="p">();</span>


        <span class="c1">// se borra la dummyData</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;task/index.html.twig&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;tasks&#39;</span> <span class="o">=&gt;</span> <span class="nv">$tasks</span><span class="p">,</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Editamos la plantilla para ajustar listado <strong>index.html.twig</strong>:</p></li>
</ul>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>{% extends &#39;base.html.twig&#39; %}

{% block title %}Listado de tareas{% endblock %}

{% block body %}
<span class="cm">&lt;!-- podemos ver la estructura de la información: --&gt;</span>
{{dump(tasks)}}

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-center container&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;table mt-4&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span> <span class="na">scope</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>Título<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span> <span class="na">scope</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>Descripción<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span> <span class="na">scope</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>Fecha creación<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span> <span class="na">scope</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>Finalizada<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span> <span class="na">scope</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>Fecha Finalización<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span> <span class="na">scope</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>Operaciones<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">thead</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tbody</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-start&quot;</span><span class="p">&gt;</span>
            {% for task in tasks %}
            <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{task.name}}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{task.description}}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{task.dateCreated|date(&quot;d/m/Y H:m:s&quot;)}}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                    {% if task.isComplete == true %}
                    si
                    {% else %}
                    no
                    {% endif %}
                <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                    {% if task.dateFinish is defined %}
                        {% if task.dateFinish is not null %}
                            {{task.dateFinish|date(&quot;d/m/Y H:m:s&quot;)}}
                        {% endif %}
                    {% endif %}
                <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-center&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-sm btn-primary me-2&quot;</span><span class="p">&gt;</span>finalizar tarea<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-sm btn-danger me-2&quot;</span><span class="p">&gt;</span>Eliminar tarea<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
            {% endfor %}
        <span class="p">&lt;/</span><span class="nt">tbody</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

{% endblock %}
</pre></div>
</div>
</section>
<section id="paso-9-crear-tareas">
<h3><a class="toc-backref" href="#id12">Paso 9: Crear tareas</a><a class="headerlink" href="#paso-9-crear-tareas" title="Enlazar permanentemente con este título">¶</a></h3>
<ul class="simple">
<li><dl class="simple">
<dt>Crear un nuevo formulario con: <code class="docutils literal notranslate"><span class="pre">php</span> <span class="pre">bin/console</span> <span class="pre">make:form</span></code></dt><dd><ul>
<li><p>elegimos la clase del formulario: Task.</p></li>
<li><p>elegimos la entidad: Task.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Editamos el formulario <strong>TaskType.php</strong>:</p></li>
</ul>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Form</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Entity\Task</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\AbstractType</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\FormBuilderInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\OptionsResolver\OptionsResolver</span><span class="p">;</span>
<span class="c1">// cargamos el input submit:</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\Extension\Core\Type\SubmitType</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">TaskType</span> <span class="k">extends</span> <span class="nx">AbstractType</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">buildForm</span><span class="p">(</span><span class="nx">FormBuilderInterface</span> <span class="nv">$builder</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$options</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>   <span class="c1">// quitamos los campos que no vamos a usar del formulario:</span>
        <span class="nv">$builder</span>
            <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">)</span>
        <span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">configureOptions</span><span class="p">(</span><span class="nx">OptionsResolver</span> <span class="nv">$resolver</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$resolver</span><span class="o">-&gt;</span><span class="na">setDefaults</span><span class="p">([</span>
            <span class="s1">&#39;data_class&#39;</span> <span class="o">=&gt;</span> <span class="nx">Task</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Editamos el método index del controlador <strong>TaskController.php</strong>:</p></li>
</ul>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Bundle\FrameworkBundle\Controller\AbstractController</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Routing\Annotation\Route</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Doctrine\ORM\EntityManagerInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Entity\Task</span><span class="p">;</span>
<span class="c1">// importamos el request (el de symfony no el de App):</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>
<span class="c1">// cargamos el formulario de tareas:</span>
<span class="k">use</span> <span class="nx">App\Form\TaskType</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">TaskController</span> <span class="k">extends</span> <span class="nx">AbstractController</span>
<span class="p">{</span>   <span class="c1">// para poder redireccionar definimos el nombre de la ruta:</span>
    <span class="c1">#[Route(&#39;/&#39;, name: &#39;index&#39;)]</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nv">$tasks</span> <span class="o">=</span> <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="nx">Task</span><span class="o">::</span><span class="na">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">findAll</span><span class="p">();</span>

        <span class="c1">// creamos un atributo con la entidad tarea:</span>
        <span class="nv">$task</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Task</span><span class="p">();</span>
        <span class="c1">// creamos un formulario con la entidad tarea:</span>
        <span class="nv">$form</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">TaskType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$task</span><span class="p">);</span>
        <span class="c1">// recuperar los datos del post en el formulario:</span>
        <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">handleRequest</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$form</span><span class="o">-&gt;</span><span class="na">isSubmitted</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">()){</span>
            <span class="c1">// cargar en la tarea la fecha actual y definir como incompleta:</span>
            <span class="nv">$task</span><span class="o">-&gt;</span><span class="na">setDateCreated</span><span class="p">(</span><span class="k">new</span> <span class="nx">\DateTime</span><span class="p">())</span>
                <span class="o">-&gt;</span><span class="na">setIsComplete</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
            <span class="c1">// cargamos los datos en el modelo:</span>
            <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$task</span><span class="p">);</span>
            <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span> <span class="c1">// con flush se guardan en la base de datos</span>
            <span class="c1">// si todo ha ido bien redireccionamos usando el nombre de la ruta local:</span>
            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;task/index.html.twig&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;tasks&#39;</span> <span class="o">=&gt;</span> <span class="nv">$tasks</span><span class="p">,</span>
            <span class="s1">&#39;taskForm&#39;</span> <span class="o">=&gt;</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">createView</span><span class="p">()</span>
        <span class="p">]);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Luego añadimos un pequeño formulario para guardar la tarea en <strong>index.html.twig</strong>:</p></li>
</ul>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>{% extends &#39;base.html.twig&#39; %}

{% block title %}Listado de tareas{% endblock %}

{% block body %}

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-center container&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;table mt-4&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span> <span class="na">scope</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>Título<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span> <span class="na">scope</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>Descripción<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span> <span class="na">scope</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>Fecha creación<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span> <span class="na">scope</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>Finalizada<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span> <span class="na">scope</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>Fecha Finalización<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span> <span class="na">scope</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>Operaciones<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">thead</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tbody</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-start&quot;</span><span class="p">&gt;</span>
            {% for task in tasks %}
            <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{task.name}}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{task.description}}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{task.dateCreated|date(&quot;d/m/Y H:m:s&quot;)}}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                    {% if task.isComplete == true %}
                    si
                    {% else %}
                    no
                    {% endif %}
                <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                    {% if task.dateFinish is defined %}
                        {% if task.dateFinish is not null %}
                            {{task.dateFinish|date(&quot;d/m/Y H:m:s&quot;)}}
                        {% endif %}
                    {% endif %}
                <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-center&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-sm btn-primary me-2&quot;</span><span class="p">&gt;</span>finalizar tarea<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-sm btn-danger me-2&quot;</span><span class="p">&gt;</span>Eliminar tarea<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
            {% endfor %}
        <span class="p">&lt;/</span><span class="nt">tbody</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
    <span class="cm">&lt;!-- cargamos de forma manual el formulario para crear tarea tal y como se muestra --&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row text-center align-items-end&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{{path(&#39;index&#39;)}}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">role</span><span class="o">=</span><span class="s">&quot;form&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-5&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            {{ form_row(taskForm._token) }}

            {{ form_label(taskForm.name, &#39;name&#39;, {&#39;label_attr&#39;: {&#39;style&#39;: &#39;display:none&#39;}}) }}
            {{ form_widget(taskForm.name, {&#39;attr&#39;: {&#39;class&#39;: &#39;col me-2 form-control form-sm&#39;, &#39;placeholder&#39;:&#39;Título&#39;}}) }}
            {{ form_errors(taskForm.name) }}

            {{ form_label(taskForm.description, &#39;description&#39;, {&#39;label_attr&#39;: {&#39;style&#39;: &#39;display:none&#39;}}) }}
            {{ form_widget(taskForm.description, {&#39;attr&#39;:{&#39;class&#39;: &#39;col me-2 form-control&#39;, &#39;placeholder&#39;:&#39;Descripción&#39;}}) }}
            {{ form_errors(taskForm.description, {&#39;attr&#39;: {&#39;class&#39;: &#39;col-md-3&#39;}}) }}

            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col me-2 form-control btn btn-success&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Crear tarea&quot;</span> <span class="p">/&gt;</span>
        <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

{% endblock %}
</pre></div>
</div>
</section>
<section id="paso-10-finalizar-y-eliminar-tarea">
<h3><a class="toc-backref" href="#id13">Paso 10: Finalizar y eliminar Tarea</a><a class="headerlink" href="#paso-10-finalizar-y-eliminar-tarea" title="Enlazar permanentemente con este título">¶</a></h3>
<ul class="simple">
<li><p>Vamos a crear un nuevo método en el controlador <strong>TaskController.php</strong>:</p></li>
</ul>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Bundle\FrameworkBundle\Controller\AbstractController</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Routing\Annotation\Route</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Doctrine\ORM\EntityManagerInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Entity\Task</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Form\TaskType</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">TaskController</span> <span class="k">extends</span> <span class="nx">AbstractController</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nv">$tasks</span> <span class="o">=</span> <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="nx">Task</span><span class="o">::</span><span class="na">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">findAll</span><span class="p">();</span>

        <span class="nv">$task</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Task</span><span class="p">();</span>
        <span class="nv">$form</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">TaskType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$task</span><span class="p">);</span>
        <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">handleRequest</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>

        <span class="k">if</span><span class="p">(</span><span class="nv">$form</span><span class="o">-&gt;</span><span class="na">isSubmitted</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">()){</span>
            <span class="nv">$task</span><span class="o">-&gt;</span><span class="na">setDateCreated</span><span class="p">(</span><span class="k">new</span> <span class="nx">\DateTime</span><span class="p">())</span>
                <span class="o">-&gt;</span><span class="na">setIsComplete</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
            <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$task</span><span class="p">);</span>
            <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;task/index.html.twig&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;tasks&#39;</span> <span class="o">=&gt;</span> <span class="nv">$tasks</span><span class="p">,</span>
            <span class="s1">&#39;taskForm&#39;</span> <span class="o">=&gt;</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">createView</span><span class="p">()</span>
        <span class="p">]);</span>
    <span class="p">}</span>

    <span class="c1">// la función recibe el id y doctrine:</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">finish</span><span class="p">(</span><span class="nv">$id</span><span class="p">,</span> <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="c1">// recuperamos la tarea con el id recibido:</span>
        <span class="nv">$task</span> <span class="o">=</span> <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="nx">Task</span><span class="o">::</span><span class="na">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">findOneBy</span><span class="p">([</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$id</span><span class="p">]);</span>
        <span class="c1">// la establecemos como finalizada y añadimos su fecha de fin:</span>
        <span class="nv">$task</span><span class="o">-&gt;</span><span class="na">setIsComplete</span><span class="p">(</span><span class="k">true</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">setDateFinish</span><span class="p">(</span><span class="k">new</span> <span class="nx">\DateTime</span><span class="p">());</span>

        <span class="c1">// cargamos los datos en el modelo:</span>
        <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$task</span><span class="p">);</span>
        <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span> <span class="c1">// con flush se guardan en la base de datos</span>
        <span class="c1">// regresamos al índice de tareas:</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// la función recibe el id y doctrine:</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">delete</span><span class="p">(</span><span class="nv">$id</span><span class="p">,</span> <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="c1">// recuperamos la tarea con el id recibido:</span>
        <span class="nv">$task</span> <span class="o">=</span> <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="nx">Task</span><span class="o">::</span><span class="na">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">findOneBy</span><span class="p">([</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$id</span><span class="p">]);</span>
        <span class="c1">// ejecutamos la acción de borrar la tarea:</span>
        <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">remove</span><span class="p">(</span><span class="nv">$task</span><span class="p">);</span>
        <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span> <span class="c1">// con flush se guardan en la base de datos</span>
        <span class="c1">// regresamos al índice de tareas:</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>En la ruta <strong>public/assets</strong> creamos una nueva carpeta llamada <strong>js</strong> y dentro de esta un archivo llamado <strong>base.js</strong>.</p></li>
<li><p>Añadimos el archivo <strong>base.js</strong> a <strong>base.html.twig</strong>:</p></li>
</ul>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>{% block title %}Task Learn{% endblock %}<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;icon&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 128 128%22&gt;&lt;text y=%221.2em%22 font-size=%2296%22&gt;⚫️&lt;/text&gt;&lt;/svg&gt;&quot;</span><span class="p">&gt;</span>
        <span class="cm">&lt;!-- Cargar css bootstrap --&gt;</span>
        <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css&quot;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&quot;sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx&quot;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&quot;anonymous&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{asset(&#39;assets/css/base.css&#39;)}}&quot;</span> <span class="p">/&gt;</span>
        {# Run `composer require symfony/webpack-encore-bundle` to start using Symfony UX #}
        {% block stylesheets %}
            {{ encore_entry_link_tags(&#39;app&#39;) }}
        {% endblock %}

        {% block javascripts %}
            {{ encore_entry_script_tags(&#39;app&#39;) }}
        {% endblock %}
    <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
        <span class="cm">&lt;!-- crear navbar --&gt;</span>
        <span class="p">&lt;</span><span class="nt">nav</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar navbar-expand-lg navbar-dark bg-dark&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-11 align-items-start ms-2&quot;</span> <span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ path(&#39;index&#39;) }}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar-brand&quot;</span><span class="p">&gt;</span>Task Learn<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

            <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar-nav mb-2 mb-lg-0 col-md-1 align-items-end me-3&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-item align-items-end&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/users&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-link text-center&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">img</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;avatar rounded img-thumbnail img-fluid&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;./assets/images/avatar.png&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;foto&quot;</span> <span class="p">/&gt;</span>
                        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">small</span><span class="p">&gt;</span>Usuario<span class="p">&lt;/</span><span class="nt">small</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>

        {% block body %}{% endblock %}

        <span class="cm">&lt;!-- cargar scripts de boostrap --&gt;</span>
        <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.min.js&quot;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&quot;sha384-ODmDIVzN+pFdexxHEHFBQH3/9/vQ9uori45z4JjnFsRydbmQbmL5t1tQ0culUzyK&quot;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&quot;anonymous&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;{{asset(&#39;assets/js/base.js&#39;)}}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Ahora editamos la plantilla <strong>index.html.twig</strong>:</p></li>
</ul>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>{% extends &#39;base.html.twig&#39; %}

{% block title %}Listado de tareas{% endblock %}

{% block body %}

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-center container&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;table mt-4&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span> <span class="na">scope</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>Título<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span> <span class="na">scope</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>Descripción<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span> <span class="na">scope</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>Fecha creación<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span> <span class="na">scope</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>Finalizada<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span> <span class="na">scope</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>Fecha Finalización<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">th</span> <span class="na">scope</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>Operaciones<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">thead</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tbody</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-start&quot;</span><span class="p">&gt;</span>
            {% for task in tasks %}
            <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{task.name}}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{task.description}}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{task.dateCreated|date(&quot;d/m/Y H:m:s&quot;)}}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                    {% if task.isComplete == true %}
                    si
                    {% else %}
                    no
                    {% endif %}
                <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                    {% if task.dateFinish is defined %}
                        {% if task.dateFinish is not null %}
                            {{task.dateFinish|date(&quot;d/m/Y H:m:s&quot;)}}
                        {% endif %}
                    {% endif %}
                <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-center&quot;</span><span class="p">&gt;</span>
                    <span class="cm">&lt;!-- vinculamos el modal al botón eliminar tarea y añadimos una función al evento click para recuperar id y name (el name al ser string hay que ponerlo entre comillas) --&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-sm btn-primary me-2&quot;</span> <span class="na">data-bs-toggle</span><span class="o">=</span><span class="s">&quot;modal&quot;</span> <span class="na">data-bs-target</span><span class="o">=</span><span class="s">&quot;#taskModal&quot;</span> <span class="na">onclick</span><span class="o">=</span><span class="s">&quot;getTask({{task.id}}, &#39;{{task.name}}&#39;, &#39;finish&#39;)&quot;</span><span class="p">&gt;</span>finalizar tarea<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                    <span class="cm">&lt;!-- vinculamos el modal al botón eliminar tarea y añadimos una función al evento click para recuperar id y name (el name al ser string hay que ponerlo entre comillas) --&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-sm btn-danger me-2&quot;</span> <span class="na">data-bs-toggle</span><span class="o">=</span><span class="s">&quot;modal&quot;</span> <span class="na">data-bs-target</span><span class="o">=</span><span class="s">&quot;#taskModal&quot;</span> <span class="na">onclick</span><span class="o">=</span><span class="s">&quot;getTask({{task.id}}, &#39;{{task.name}}&#39;, &#39;delete&#39;)&quot;</span><span class="p">&gt;</span>Eliminar tarea<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
            {% endfor %}
        <span class="p">&lt;/</span><span class="nt">tbody</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row text-center align-items-end&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{{path(&#39;index&#39;)}}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">role</span><span class="o">=</span><span class="s">&quot;form&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-5&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            {{ form_row(taskForm._token) }}

            {{ form_label(taskForm.name, &#39;name&#39;, {&#39;label_attr&#39;: {&#39;style&#39;: &#39;display:none&#39;}}) }}
            {{ form_widget(taskForm.name, {&#39;attr&#39;: {&#39;class&#39;: &#39;col me-2 form-control form-sm&#39;, &#39;placeholder&#39;:&#39;Título&#39;}}) }}
            {{ form_errors(taskForm.name) }}

            {{ form_label(taskForm.description, &#39;description&#39;, {&#39;label_attr&#39;: {&#39;style&#39;: &#39;display:none&#39;}}) }}
            {{ form_widget(taskForm.description, {&#39;attr&#39;:{&#39;class&#39;: &#39;col me-2 form-control&#39;, &#39;placeholder&#39;:&#39;Descripción&#39;}}) }}
            {{ form_errors(taskForm.description, {&#39;attr&#39;: {&#39;class&#39;: &#39;col-md-3&#39;}}) }}

            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col me-2 form-control btn btn-success&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Crear tarea&quot;</span> <span class="p">/&gt;</span>
        <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal fade&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;taskModal&quot;</span> <span class="na">tabIndex</span><span class="o">=</span><span class="s">&quot;-1&quot;</span> <span class="na">aria-labelledby</span><span class="o">=</span><span class="s">&quot;exampleModalLabel&quot;</span> <span class="na">aria-hidden</span><span class="o">=</span><span class="s">&quot;true&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-dialog&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-content&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-header&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">h5</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-title&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;taskModalTitle&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">h5</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;button&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn-close&quot;</span> <span class="na">data-bs-dismiss</span><span class="o">=</span><span class="s">&quot;modal&quot;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&quot;Close&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-body&quot;</span><span class="p">&gt;</span>
            <span class="cm">&lt;!-- creamos un id para pasar id y nombre --&gt;</span>
            <span class="p">&lt;</span><span class="nt">p</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;taskDefinition&quot;</span><span class="p">&gt;</span>id - tarea<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-footer&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;button&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-secondary&quot;</span> <span class="na">data-bs-dismiss</span><span class="o">=</span><span class="s">&quot;modal&quot;</span><span class="p">&gt;</span>Cancelar<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
            <span class="cm">&lt;!-- creamos un identificador para asignar la ruta por javascript: --&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;taskButton&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;</span>Aceptar<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

{% endblock %}
</pre></div>
</div>
<ul class="simple">
<li><p>Ahora pasamos al archivo javascript <strong>base.js</strong>:</p></li>
</ul>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// añadimos la función para eliminar tarea:</span><span class="w"></span>
<span class="kd">function</span><span class="w"> </span><span class="nx">getTask</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">action</span><span class="p">){</span><span class="w"></span>
<span class="w">    </span><span class="c1">// cargar etiquetas:</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">taskModalTitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;taskModalTitle&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">taskButton</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;taskButton&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">taskDefinition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;taskDefinition&#39;</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// comprobar la acción recibida y asignar datos a las etiquetas:</span><span class="w"></span>
<span class="w">    </span><span class="k">switch</span><span class="p">(</span><span class="nx">action</span><span class="p">){</span><span class="w"></span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;finish&#39;</span><span class="o">:</span><span class="w"></span>
<span class="w">            </span><span class="nx">taskModalTitle</span><span class="p">.</span><span class="nx">textContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Se va a finalizar la siguiente tarea&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="nx">taskDefinition</span><span class="p">.</span><span class="nx">textContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; - &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">name</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="nx">taskButton</span><span class="p">.</span><span class="nx">href</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;/tasks/finish/&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">id</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="nx">taskButton</span><span class="p">.</span><span class="nx">className</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;btn btn-primary&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;delete&#39;</span><span class="o">:</span><span class="w"></span>
<span class="w">            </span><span class="nx">taskModalTitle</span><span class="p">.</span><span class="nx">textContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Se va a eliminar la siguiente tarea&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="nx">taskDefinition</span><span class="p">.</span><span class="nx">textContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; - &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">name</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="nx">taskButton</span><span class="p">.</span><span class="nx">href</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;/tasks/delete/&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">id</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="nx">taskButton</span><span class="p">.</span><span class="nx">className</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;btn btn-danger&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><p>Por último creamos la ruta general al método en <strong>routes.yaml</strong>:</p></li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">index</span><span class="p">:</span><span class="w"></span>
<span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span><span class="w"></span>
<span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\TaskController::index</span><span class="w"></span>

<span class="nt">finish</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tasks/finish/{id}</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\TaskController::finish</span><span class="w"></span>

<span class="c1"># Añadimos la ruta para eliminar tareas:</span><span class="w"></span>
<span class="nt">delete</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tasks/delete/{id}</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\TaskController::delete</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="paso-11-editar-tareas">
<h3><a class="toc-backref" href="#id14">Paso 11: Editar tareas</a><a class="headerlink" href="#paso-11-editar-tareas" title="Enlazar permanentemente con este título">¶</a></h3>
<ul class="simple">
<li><p>Creamos un nuevo metodo en <strong>TaskController.php</strong>:</p></li>
</ul>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Bundle\FrameworkBundle\Controller\AbstractController</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Routing\Annotation\Route</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Doctrine\ORM\EntityManagerInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Entity\Task</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Form\TaskType</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">TaskController</span> <span class="k">extends</span> <span class="nx">AbstractController</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nv">$tasks</span> <span class="o">=</span> <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="nx">Task</span><span class="o">::</span><span class="na">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">findAll</span><span class="p">();</span>

        <span class="nv">$task</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Task</span><span class="p">();</span>
        <span class="nv">$form</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">TaskType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$task</span><span class="p">);</span>
        <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">handleRequest</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>

        <span class="k">if</span><span class="p">(</span><span class="nv">$form</span><span class="o">-&gt;</span><span class="na">isSubmitted</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">()){</span>
            <span class="nv">$task</span><span class="o">-&gt;</span><span class="na">setDateCreated</span><span class="p">(</span><span class="k">new</span> <span class="nx">\DateTime</span><span class="p">())</span>
                <span class="o">-&gt;</span><span class="na">setIsComplete</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
            <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$task</span><span class="p">);</span>
            <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;task/index.html.twig&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;tasks&#39;</span> <span class="o">=&gt;</span> <span class="nv">$tasks</span><span class="p">,</span>
            <span class="s1">&#39;taskForm&#39;</span> <span class="o">=&gt;</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">createView</span><span class="p">(),</span>
            <span class="s1">&#39;taskEditForm&#39;</span> <span class="o">=&gt;</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">createView</span><span class="p">()</span> <span class="c1">// recargamos otro formulario para evitar fallos</span>
        <span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">finish</span><span class="p">(</span><span class="nv">$id</span><span class="p">,</span> <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nv">$task</span> <span class="o">=</span> <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="nx">Task</span><span class="o">::</span><span class="na">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">findOneBy</span><span class="p">([</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$id</span><span class="p">]);</span>
        <span class="nv">$task</span><span class="o">-&gt;</span><span class="na">setIsComplete</span><span class="p">(</span><span class="k">true</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">setDateFinish</span><span class="p">(</span><span class="k">new</span> <span class="nx">\DateTime</span><span class="p">());</span>

        <span class="c1">// cargamos los datos en el modelo:</span>
        <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$task</span><span class="p">);</span>
        <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">delete</span><span class="p">(</span><span class="nv">$id</span><span class="p">,</span> <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nv">$task</span> <span class="o">=</span> <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="nx">Task</span><span class="o">::</span><span class="na">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">findOneBy</span><span class="p">([</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$id</span><span class="p">]);</span>
        <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">remove</span><span class="p">(</span><span class="nv">$task</span><span class="p">);</span>
        <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// creamos un nuevo método para editar tareas:</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nv">$id</span><span class="p">,</span> <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">,</span> <span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="c1">// recuperar tarea:</span>
        <span class="nv">$task</span> <span class="o">=</span> <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="nx">Task</span><span class="o">::</span><span class="na">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">findOneBy</span><span class="p">([</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$id</span><span class="p">]);</span>
        <span class="nx">dump</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">));</span>
        <span class="c1">// crear formulario y pasarle la request:</span>
        <span class="nv">$form</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">TaskType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$task</span><span class="p">);</span>
        <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">handleRequest</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
        <span class="c1">// ahora no lo persistimos solo lo escribimos:</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$form</span><span class="o">-&gt;</span><span class="na">isSubmitted</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">()){</span>
            <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="c1">// redireccionar:</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">);</span>

    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Modificamos la vista para añadir un nuevo formulario de edición en <strong>index.html.twig</strong>:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>{% extends &#39;base.html.twig&#39; %}

{% block title %}Listado de tareas{% endblock %}

{% block body %}

&lt;div class=&quot;text-center container&quot;&gt;
    &lt;table class=&quot;table mt-4&quot;&gt;
        &lt;thead&gt;
            &lt;tr&gt;
                &lt;th scope=&quot;col&quot;&gt;Título&lt;/th&gt;
                &lt;th scope=&quot;col&quot;&gt;Descripción&lt;/th&gt;
                &lt;th scope=&quot;col&quot;&gt;Fecha creación&lt;/th&gt;
                &lt;th scope=&quot;col&quot;&gt;Finalizada&lt;/th&gt;
                &lt;th scope=&quot;col&quot;&gt;Fecha Finalización&lt;/th&gt;
                &lt;th scope=&quot;col&quot;&gt;Operaciones&lt;/th&gt;
            &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody id=&quot;taskList&quot; class=&quot;text-start&quot;&gt;
            {% for task in tasks %}
            &lt;tr&gt;
                &lt;td&gt;{{task.name}}&lt;/td&gt;
                &lt;td&gt;{{task.description}}&lt;/td&gt;
                &lt;td&gt;{{task.dateCreated|date(&quot;d/m/Y H:m:s&quot;)}}&lt;/td&gt;
                &lt;td&gt;
                    {% if task.isComplete == true %}
                    si
                    {% else %}
                    no
                    {% endif %}
                &lt;/td&gt;
                &lt;td&gt;
                    {% if task.dateFinish is defined %}
                        {% if task.dateFinish is not null %}
                            {{task.dateFinish|date(&quot;d/m/Y H:m:s&quot;)}}
                        {% endif %}
                    {% endif %}
                &lt;/td&gt;
                &lt;td class=&quot;text-center&quot;&gt;
                    &lt;!-- añadimos el botón para editar tarea y le pasamos los valores: --&gt;
                    &lt;button class=&quot;btn btn-sm btn-warning me-2&quot; onclick=&quot;editTask({{task.id}}, &#39;{{task.name}}&#39;, &#39;{{task.description}}&#39;, &#39;{{task.dateCreated|date(&quot;d/m/Y H:m:s&quot;)}}&#39;, &#39;{{task.isComplete}}&#39;, &#39;{{task.dateFinish|date(&quot;d/m/Y H:m:s&quot;)}}&#39;)&quot;&gt;editar tarea&lt;/button&gt;
                    &lt;button class=&quot;btn btn-sm btn-primary me-2&quot; data-bs-toggle=&quot;modal&quot; data-bs-target=&quot;#taskModal&quot; onclick=&quot;getTask({{task.id}}, &#39;{{task.name}}&#39;, &#39;finish&#39;)&quot;&gt;finalizar tarea&lt;/button&gt;
                    &lt;button class=&quot;btn btn-sm btn-danger me-2&quot; data-bs-toggle=&quot;modal&quot; data-bs-target=&quot;#taskModal&quot; onclick=&quot;getTask({{task.id}}, &#39;{{task.name}}&#39;, &#39;delete&#39;)&quot;&gt;Eliminar tarea&lt;/button&gt;
                &lt;/td&gt;
            &lt;/tr&gt;
            {% endfor %}
        &lt;/tbody&gt;
        &lt;tbody id=&quot;taskEdit&quot; class=&quot;d-none&quot;&gt;
            &lt;form id=&quot;taskForm&quot; action=&quot;&quot; method=&quot;post&quot; role=&quot;form&quot; class=&quot;row&quot;&gt;
                {{ form_row(taskEditForm._token) }}
                &lt;tr&gt;
                    &lt;td&gt;
                        {{ form_label(taskEditForm.name, &#39;name&#39;, {&#39;label_attr&#39;: {&#39;style&#39;: &#39;display:none&#39;}}) }}
                        {{ form_widget(taskEditForm.name, {&#39;attr&#39;: {&#39;class&#39;: &#39;col me-2 form-control form-sm&#39;}}) }}
                        {{ form_errors(taskEditForm.name) }}
                    &lt;/td&gt;
                    &lt;td&gt;
                        {{ form_label(taskEditForm.description, &#39;description&#39;, {&#39;label_attr&#39;: {&#39;style&#39;: &#39;display:none&#39;}}) }}
                        {{ form_widget(taskEditForm.description, {&#39;attr&#39;:{&#39;class&#39;: &#39;col me-2 form-control&#39;}}) }}
                        {{ form_errors(taskEditForm.description, {&#39;attr&#39;: {&#39;class&#39;: &#39;col-md-3&#39;}}) }}
                    &lt;/td&gt;
                    &lt;td id=&quot;taskDateCreated&quot;&gt;&lt;/td&gt;
                    &lt;td id=&quot;taskComplete&quot;&gt;&lt;/td&gt;
                    &lt;td id=&quot;taskDateFinish&quot;&gt;&lt;/td&gt;
                    &lt;td class=&quot;text-center&quot;&gt;
                        &lt;button type=&quot;submit&quot; class=&quot;btn btn-sm btn-success me-2 mb-1&quot;&gt;Guardar&lt;/button&gt;
                        &lt;button type=&quot;button&quot; class=&quot;btn btn-sm btn-primary me-2 mb-1&quot; onclick=&quot;cancelEdit()&quot;&gt;Cancelar&lt;/button&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;
            &lt;/form&gt;
        &lt;/tbody&gt;
    &lt;/table&gt;
    &lt;div id=&quot;taskCreate&quot; class=&quot;row text-center align-items-end&quot;&gt;
        &lt;form action=&quot;{{path(&#39;index&#39;)}}&quot; method=&quot;post&quot; role=&quot;form&quot; class=&quot;row&quot;&gt;
            &lt;div class=&quot;col-md-5&quot;&gt;&lt;/div&gt;
            {{ form_row(taskForm._token) }}

            {{ form_label(taskForm.name, &#39;name&#39;, {&#39;label_attr&#39;: {&#39;style&#39;: &#39;display:none&#39;}}) }}
            {{ form_widget(taskForm.name, {&#39;attr&#39;: {&#39;class&#39;: &#39;col me-2 form-control form-sm&#39;, &#39;placeholder&#39;:&#39;Título&#39;}}) }}
            {{ form_errors(taskForm.name) }}

            {{ form_label(taskForm.description, &#39;description&#39;, {&#39;label_attr&#39;: {&#39;style&#39;: &#39;display:none&#39;}}) }}
            {{ form_widget(taskForm.description, {&#39;attr&#39;:{&#39;class&#39;: &#39;col me-2 form-control&#39;, &#39;placeholder&#39;:&#39;Descripción&#39;}}) }}
            {{ form_errors(taskForm.description, {&#39;attr&#39;: {&#39;class&#39;: &#39;col-md-3&#39;}}) }}

            &lt;input class=&quot;col me-2 form-control btn btn-success&quot; type=&quot;submit&quot; value=&quot;Crear tarea&quot; /&gt;
        &lt;/form&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;div class=&quot;modal fade&quot; id=&quot;taskModal&quot; tabIndex=&quot;-1&quot; aria-labelledby=&quot;exampleModalLabel&quot; aria-hidden=&quot;true&quot;&gt;
    &lt;div class=&quot;modal-dialog&quot;&gt;
        &lt;div class=&quot;modal-content&quot;&gt;
        &lt;div class=&quot;modal-header&quot;&gt;
            &lt;h5 class=&quot;modal-title&quot; id=&quot;taskModalTitle&quot;&gt;&lt;/h5&gt;
            &lt;button type=&quot;button&quot; class=&quot;btn-close&quot; data-bs-dismiss=&quot;modal&quot; aria-label=&quot;Close&quot;&gt;&lt;/button&gt;
        &lt;/div&gt;
        &lt;div class=&quot;modal-body&quot;&gt;
            &lt;!-- creamos un id para pasar id y nombre --&gt;
            &lt;p id=&quot;taskDefinition&quot;&gt;id - tarea&lt;/p&gt;
        &lt;/div&gt;
        &lt;div class=&quot;modal-footer&quot;&gt;
            &lt;button type=&quot;button&quot; class=&quot;btn btn-secondary&quot; data-bs-dismiss=&quot;modal&quot;&gt;Cancelar&lt;/button&gt;
            &lt;!-- creamos un identificador para asignar la ruta por javascript: --&gt;
            &lt;a id=&quot;taskButton&quot; href=&quot;&quot; class=&quot;&quot;&gt;Aceptar&lt;/a&gt;
        &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;

{% endblock %}
</pre></div>
</div>
<ul class="simple">
<li><p>Creamos dos nuevas funciones en javascript para manejar cambios de pantalla en <strong>base.js</strong>:</p></li>
</ul>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span><span class="w"> </span><span class="nx">getTask</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">action</span><span class="p">){</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">taskModalTitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;taskModalTitle&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">taskButton</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;taskButton&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">taskDefinition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;taskDefinition&#39;</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="k">switch</span><span class="p">(</span><span class="nx">action</span><span class="p">){</span><span class="w"></span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;finish&#39;</span><span class="o">:</span><span class="w"></span>
<span class="w">            </span><span class="nx">taskModalTitle</span><span class="p">.</span><span class="nx">textContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Se va a finalizar la siguiente tarea&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="nx">taskDefinition</span><span class="p">.</span><span class="nx">textContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; - &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">name</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="nx">taskButton</span><span class="p">.</span><span class="nx">href</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;/tasks/finish/&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">id</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="nx">taskButton</span><span class="p">.</span><span class="nx">className</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;btn btn-primary&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;delete&#39;</span><span class="o">:</span><span class="w"></span>
<span class="w">            </span><span class="nx">taskModalTitle</span><span class="p">.</span><span class="nx">textContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Se va a eliminar la siguiente tarea&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="nx">taskDefinition</span><span class="p">.</span><span class="nx">textContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; - &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">name</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="nx">taskButton</span><span class="p">.</span><span class="nx">href</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;/tasks/delete/&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">id</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="nx">taskButton</span><span class="p">.</span><span class="nx">className</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;btn btn-danger&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// función para cargar datos en campos:</span><span class="w"></span>
<span class="kd">function</span><span class="w"> </span><span class="nx">editTask</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">description</span><span class="p">,</span><span class="w"> </span><span class="nx">dateCreated</span><span class="p">,</span><span class="w"> </span><span class="nx">isComplete</span><span class="p">,</span><span class="w"> </span><span class="nx">dateFinish</span><span class="p">){</span><span class="w"></span>
<span class="w">    </span><span class="c1">// recuperar nodos padres:</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">taskList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;taskList&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">taskEdit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;taskEdit&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">taskCreate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;taskCreate&#39;</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// recuperar etiquetas a editar y añadir información:</span><span class="w"></span>
<span class="w">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;taskForm&#39;</span><span class="p">).</span><span class="nx">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;/tasks/update/&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">id</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;task_name&#39;</span><span class="p">).</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">name</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;task_description&#39;</span><span class="p">).</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">description</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;taskDateCreated&#39;</span><span class="p">).</span><span class="nx">textContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dateCreated</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;taskComplete&#39;</span><span class="p">).</span><span class="nx">textContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">isComplete</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s2">&quot;Si&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;No&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;taskDateFinish&#39;</span><span class="p">).</span><span class="nx">textContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">isComplete</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">dateFinish</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// cambiar clases de boostrap para ocultar listado de tareas y mostrar editor:</span><span class="w"></span>
<span class="w">    </span><span class="nx">taskList</span><span class="p">.</span><span class="nx">className</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;d-none&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nx">taskEdit</span><span class="p">.</span><span class="nx">className</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nx">taskCreate</span><span class="p">.</span><span class="nx">className</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;d-none&quot;</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// cancelar edición:</span><span class="w"></span>
<span class="kd">function</span><span class="w"> </span><span class="nx">cancelEdit</span><span class="p">(){</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">taskList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;taskList&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">taskEdit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;taskEdit&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">taskCreate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;taskCreate&#39;</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// cambiar clases de boostrap para mostrar listado de tareas y ocultar editor:</span><span class="w"></span>
<span class="w">    </span><span class="nx">taskList</span><span class="p">.</span><span class="nx">className</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;text-start&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nx">taskEdit</span><span class="p">.</span><span class="nx">className</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;d-none&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nx">taskCreate</span><span class="p">.</span><span class="nx">className</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;row text-center align-items-end&quot;</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><p>Finalmente cargamos la ruta en <strong>routes.yaml</strong>:</p></li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">index</span><span class="p">:</span><span class="w"></span>
<span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span><span class="w"></span>
<span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\TaskController::index</span><span class="w"></span>

<span class="nt">finish</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tasks/finish/{id}</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\TaskController::finish</span><span class="w"></span>

<span class="nt">delete</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tasks/delete/{id}</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\TaskController::delete</span><span class="w"></span>

<span class="c1"># Añadimos la ruta para actualizar tareas:</span><span class="w"></span>
<span class="nt">update</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tasks/update/{id}</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\TaskController::update</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="paso-12-subir-cambios-a-github">
<h3><a class="toc-backref" href="#id15">Paso 12: Subir cambios a GitHub</a><a class="headerlink" href="#paso-12-subir-cambios-a-github" title="Enlazar permanentemente con este título">¶</a></h3>
<ul class="simple">
<li><p>Parar ejecución de app.</p></li>
<li><p>Añadir cambios: <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">add</span> <span class="pre">.</span></code></p></li>
<li><p>Realizar un commit: <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">commit</span> <span class="pre">-am</span> <span class="pre">&quot;Phase</span> <span class="pre">1</span> <span class="pre">complete&quot;</span></code></p></li>
<li><p>Subir cambios a Github con el nombre de la rama actual: <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">push</span> <span class="pre">origin</span> <span class="pre">feature/phase-1-task-system</span></code></p></li>
<li><p>Desde gitHub presionar botón <strong>Compare &amp; pull request</strong>.</p></li>
<li><p>cambiar rama base <strong>master</strong> por <strong>developer</strong> y pulsar <strong>Create pull request</strong></p></li>
<li><p>Pulsar en <strong>Merge pull request</strong> y a continuación en <strong>Confirm merge</strong>.</p></li>
<li><p>Una vez terminado volvemos a local y cambiamos de rama a developer: <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">checkout</span> <span class="pre">developer</span></code></p></li>
<li><p>Actualizamos rama developer: <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">pull</span> <span class="pre">origin</span> <span class="pre">developer</span></code></p></li>
</ul>
<p>Y con esto concluye la primera fase del proyecto.</p>
<hr><br></section>
</section>
<section id="fase-2-autenticacion-y-perfil">
<h2><a class="toc-backref" href="#id16">Fase 2: Autenticación y perfil</a><a class="headerlink" href="#fase-2-autenticacion-y-perfil" title="Enlazar permanentemente con este título">¶</a></h2>
<p>En esta fase se va a crear el sistema de usuarios, autenticación y la relación entre tareas y usuarios.</p>
<section id="paso-1-preparar-proyecto">
<h3><a class="toc-backref" href="#id17">Paso 1: Preparar proyecto</a><a class="headerlink" href="#paso-1-preparar-proyecto" title="Enlazar permanentemente con este título">¶</a></h3>
<ul class="simple">
<li><p>Crear rama nueva <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">checkout</span> <span class="pre">-b</span> <span class="pre">feature/phase-2-user-authentication</span></code></p></li>
<li><p>Instalar librería <strong>symfony/mailer</strong>: <code class="docutils literal notranslate"><span class="pre">composer</span> <span class="pre">require</span> <span class="pre">symfony/mailer</span></code></p></li>
</ul>
</section>
<section id="paso-2-crear-modelo-de-usuarios">
<h3><a class="toc-backref" href="#id18">Paso 2: Crear modelo de usuarios</a><a class="headerlink" href="#paso-2-crear-modelo-de-usuarios" title="Enlazar permanentemente con este título">¶</a></h3>
<ul class="simple">
<li><dl class="simple">
<dt>Ejecutar el comando: <code class="docutils literal notranslate"><span class="pre">php</span> <span class="pre">bin/console</span> <span class="pre">make:user</span></code></dt><dd><ul>
<li><p>User</p></li>
<li><p>yes</p></li>
<li><p>email</p></li>
<li><p>yes</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Para agregar el resto de campo vamos a ejecutar el comando <code class="docutils literal notranslate"><span class="pre">php</span> <span class="pre">bin/console</span> <span class="pre">make:entity</span></code></dt><dd><ul>
<li><p>name, string, 150, yes</p></li>
<li><p>lastname, string, 200, yes</p></li>
<li><p>avatar, string, 200, yes</p></li>
<li><p>Presionar Intro para terminar.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Revisar las diferencias con la base de datos actual: <code class="docutils literal notranslate"><span class="pre">php</span> <span class="pre">bin/console</span> <span class="pre">doctrine:migrations:diff</span></code></p></li>
<li><p>Ejecutar migración: <code class="docutils literal notranslate"><span class="pre">php</span> <span class="pre">bin/console</span> <span class="pre">doctrine:migrations:migrate</span></code> confirmamos la operación (los datos existentes se perderán).</p></li>
</ul>
</section>
<section id="paso-3-establecer-relacion-entre-usuarios-y-tareas">
<h3><a class="toc-backref" href="#id19">Paso 3: Establecer relación entre usuarios y tareas</a><a class="headerlink" href="#paso-3-establecer-relacion-entre-usuarios-y-tareas" title="Enlazar permanentemente con este título">¶</a></h3>
<ul class="simple">
<li><p>Para que cada tarea pertenezca a un usuario editamos la entidad añadiendo una llave foranea.</p></li>
<li><dl class="simple">
<dt>Ejecutamos el comando <code class="docutils literal notranslate"><span class="pre">php</span> <span class="pre">bin/console</span> <span class="pre">make:entity</span></code></dt><dd><ul>
<li><p>Task</p></li>
<li><p>owner</p></li>
<li><p>ManyToOne</p></li>
<li><p>User</p></li>
<li><p>no</p></li>
<li><p>yes</p></li>
<li><p>tasks</p></li>
<li><p>yes (es necesario borrar los datos de la base de datos que no tienen relación para evitar inconcurrencias).</p></li>
<li><p>Presionar Intro para terminar.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Revisar las diferencias con la base de datos actual: <code class="docutils literal notranslate"><span class="pre">php</span> <span class="pre">bin/console</span> <span class="pre">doctrine:migrations:diff</span></code></p></li>
<li><p>Ejecutar migración: <code class="docutils literal notranslate"><span class="pre">php</span> <span class="pre">bin/console</span> <span class="pre">doctrine:migrations:migrate</span></code> confirmamos la operación (los datos existentes se perderán).</p></li>
</ul>
</section>
<section id="paso-4-crear-registro-de-usuarios">
<h3><a class="toc-backref" href="#id20">Paso 4: Crear registro de usuarios</a><a class="headerlink" href="#paso-4-crear-registro-de-usuarios" title="Enlazar permanentemente con este título">¶</a></h3>
<ul class="simple">
<li><p>Lo primero que hay que hacer es crear un nuevo controlador: <code class="docutils literal notranslate"><span class="pre">php</span> <span class="pre">bin/console</span> <span class="pre">make:controller</span> <span class="pre">UserController</span></code></p></li>
<li><dl class="simple">
<dt>Creamos un formulario: <code class="docutils literal notranslate"><span class="pre">php</span> <span class="pre">bin/console</span> <span class="pre">make:form</span> <span class="pre">User</span></code></dt><dd><ul>
<li><p>elegimos la clase del formulario: User.</p></li>
<li><p>elegimos la entidad: User.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Editamos el formulario <strong>UserType.php</strong>:</p></li>
</ul>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">App\Form</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Entity\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\AbstractType</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\FormBuilderInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\OptionsResolver\OptionsResolver</span><span class="p">;</span>
<span class="c1">// añadimos el passwordType y el emailtype:</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\Extension\Core\Type\PasswordType</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\Extension\Core\Type\EmailType</span><span class="p">;</span>


<span class="k">class</span> <span class="nc">UserType</span> <span class="k">extends</span> <span class="nx">AbstractType</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">buildForm</span><span class="p">(</span><span class="nx">FormBuilderInterface</span> <span class="nv">$builder</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$options</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$builder</span>
            <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="nx">EmailType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;required&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span> <span class="c1">// que sea requerido</span>
            <span class="p">))</span>
            <span class="c1">// Eliminamos los roles ya que nos los vamos a usar: -&gt;add(&#39;roles&#39;)</span>
            <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="nx">PasswordType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;required&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span> <span class="c1">// que sea requerido</span>
                <span class="s1">&#39;always_empty&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span> <span class="c1">// irá siempre vacio (esto servirá para editar usuario)</span>
            <span class="p">))</span>
            <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;lastname&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;avatar&#39;</span><span class="p">)</span>
        <span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">configureOptions</span><span class="p">(</span><span class="nx">OptionsResolver</span> <span class="nv">$resolver</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$resolver</span><span class="o">-&gt;</span><span class="na">setDefaults</span><span class="p">([</span>
            <span class="s1">&#39;data_class&#39;</span> <span class="o">=&gt;</span> <span class="nx">User</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Editamos <strong>UserController.php</strong>:</p></li>
</ul>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Bundle\FrameworkBundle\Controller\AbstractController</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Routing\Annotation\Route</span><span class="p">;</span>
<span class="c1">// cargamos el request de httpfoundation:</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>
<span class="c1">// cargamos el entitymanagerinterface:</span>
<span class="k">use</span> <span class="nx">Doctrine\ORM\EntityManagerInterface</span><span class="p">;</span>
<span class="c1">// cargamos el cifrado de contarseñas:</span>
<span class="k">use</span> <span class="nx">Symfony\Component\PasswordHasher\Hasher\UserPasswordHasherInterface</span><span class="p">;</span>

<span class="c1">// cargamos la entidad user:</span>
<span class="k">use</span> <span class="nx">App\Entity\User</span><span class="p">;</span>
<span class="c1">// cargamos el formulario de user:</span>
<span class="k">use</span> <span class="nx">App\Form\UserType</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">AbstractController</span>
<span class="p">{</span>
    <span class="c1">// eliminamos la ruta local y cambiamos el nombre del index por login:</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">login</span><span class="p">()</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="c1">// creamos un objeto de la entidad user:</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
        <span class="c1">// creamos el formulario de registro y le asignamos la entidad user:</span>
        <span class="nv">$registrationForm</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">UserType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$user</span><span class="p">);</span>

        <span class="c1">// del mismo modo cambiamos el nombre del template por login.html.twig (el archivo también)</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;user/login.html.twig&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;registration_form&#39;</span> <span class="o">=&gt;</span> <span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">createView</span><span class="p">()</span>
        <span class="p">]);</span>
    <span class="p">}</span>

    <span class="c1">// creamos una ruta para registrar usuarios:</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">(</span>
        <span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span>
        <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">,</span>
        <span class="nx">UserPasswordHasherInterface</span> <span class="nv">$passwordHasher</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span> <span class="c1">// cargamos el request, el entityManagerInterface y el codificador de contraseñas</span>
    <span class="p">{</span>
        <span class="c1">// creamos un objeto de la entidad user:</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
        <span class="c1">// creamos el formulario de registro y le asignamos la entidad user:</span>
        <span class="nv">$registrationForm</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">UserType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$user</span><span class="p">);</span>

        <span class="c1">// recuperamos la petición de request en el formulario:</span>
        <span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">handleRequest</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
        <span class="c1">// comprobamos que llega un request y todo es válido:</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">isSubmitted</span><span class="p">()){</span>
            <span class="k">if</span><span class="p">(</span><span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">()){</span>
                <span class="c1">// definimos el rol a mano por seguridad:</span>
                <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setRoles</span><span class="p">([</span><span class="s1">&#39;ROLE_USER&#39;</span><span class="p">]);</span>
                <span class="c1">// recuperamos la contraseña del campo form para cifrar:</span>
                <span class="nv">$plainPassword</span> <span class="o">=</span> <span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">();</span>
                <span class="c1">// antes de guardar ciframos la contraseña:</span>
                <span class="nv">$hashedPassword</span> <span class="o">=</span> <span class="nv">$passwordHasher</span><span class="o">-&gt;</span><span class="na">hashPassword</span><span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="nv">$plainPassword</span><span class="p">);</span>
                <span class="c1">// añadimos la nueva contraseña cifrada:</span>
                <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$hashedPassword</span><span class="p">);</span>

                <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
                <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
                <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Añadimos la ruta a <strong>routes.yaml</strong>:</p></li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">index</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\TaskController::index</span><span class="w"></span>

<span class="nt">finish</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tasks/finish/{id}</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\TaskController::finish</span><span class="w"></span>

<span class="nt">delete</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tasks/delete/{id}</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\TaskController::delete</span><span class="w"></span>

<span class="nt">update</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tasks/update/{id}</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\TaskController::update</span><span class="w"></span>

<span class="c1"># Añadimos la ruta para iniciar sesión y registro:</span><span class="w"></span>
<span class="nt">login</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/login</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\UserController::login</span><span class="w"></span>

<span class="nt">register</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/register</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\UserController::register</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><p>Ahora vamos a ocultar el navbar con una condición de ruta en <strong>base.html.twig</strong>:</p></li>
</ul>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>{% block title %}Task Learn{% endblock %}<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;icon&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 128 128%22&gt;&lt;text y=%221.2em%22 font-size=%2296%22&gt;⚫️&lt;/text&gt;&lt;/svg&gt;&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css&quot;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&quot;sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx&quot;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&quot;anonymous&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{asset(&#39;assets/css/base.css&#39;)}}&quot;</span> <span class="p">/&gt;</span>
        {# Run `composer require symfony/webpack-encore-bundle` to start using Symfony UX #}
        {% block stylesheets %}
            {{ encore_entry_link_tags(&#39;app&#39;) }}
        {% endblock %}

        {% block javascripts %}
            {{ encore_entry_script_tags(&#39;app&#39;) }}
        {% endblock %}
    <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
        <span class="cm">&lt;!-- Ocultar navbar cuando la ruta sea login o register: --&gt;</span>
        {% if app.request.get(&#39;_route&#39;) not in [&#39;login&#39;,&#39;reset_password&#39;] %}
            <span class="p">&lt;</span><span class="nt">nav</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar navbar-expand-lg navbar-dark bg-dark&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-11 align-items-start ms-2&quot;</span> <span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ path(&#39;index&#39;) }}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar-brand&quot;</span><span class="p">&gt;</span>Task Learn<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

                <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar-nav mb-2 mb-lg-0 col-md-1 align-items-end me-3&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-item align-items-end&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/users&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-link text-center&quot;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">img</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;avatar rounded img-thumbnail img-fluid&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;./assets/images/avatar.png&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;foto&quot;</span> <span class="p">/&gt;</span>
                            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">small</span><span class="p">&gt;</span>Usuario<span class="p">&lt;/</span><span class="nt">small</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>
        {% endif %}

        {% block body %}{% endblock %}

        <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.min.js&quot;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&quot;sha384-ODmDIVzN+pFdexxHEHFBQH3/9/vQ9uori45z4JjnFsRydbmQbmL5t1tQ0culUzyK&quot;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&quot;anonymous&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;{{asset(&#39;assets/js/base.js&#39;)}}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Editamos la pantalla de login para añadir el formulario de registro <strong>login.html.twig</strong>:</p></li>
</ul>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>{% extends &#39;base.html.twig&#39; %}

{% block title %}Iniciar Sesión{% endblock %}

{% block body %}
<span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="nc">example-wrapper</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">em</span><span class="w"> </span><span class="kc">auto</span><span class="p">;</span><span class="w"> </span><span class="k">max-width</span><span class="p">:</span><span class="w"> </span><span class="mi">800</span><span class="kt">px</span><span class="p">;</span><span class="w"> </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">95</span><span class="kt">%</span><span class="p">;</span><span class="w"> </span><span class="k">font</span><span class="p">:</span><span class="w"> </span><span class="mi">18</span><span class="kt">px</span><span class="o">/</span><span class="mf">1.5</span><span class="w"> </span><span class="kc">sans-serif</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="nc">example-wrapper</span><span class="w"> </span><span class="nt">code</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="mh">#F5F5F5</span><span class="p">;</span><span class="w"> </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="kt">px</span><span class="w"> </span><span class="mi">6</span><span class="kt">px</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- cargar formulario de registro, luego arreglamos el login y el registro lo añadimos a un modal --&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">form</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;userForm&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{{path(&#39;register&#39;)}}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">role</span><span class="o">=</span><span class="s">&quot;form&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
            {{ form_row(registration_form._token) }}

            {{ form_label(registration_form.email, &#39;email&#39;, {&#39;label_attr&#39;: {&#39;style&#39;: &#39;display:none&#39;}}) }}
            {{ form_widget(registration_form.email, {&#39;attr&#39;: {&#39;class&#39;: &#39;form-control mt-3&#39;, &#39;placeholder&#39;:&#39;Email&#39;}}) }}
            {{ form_errors(registration_form.email) }}

            {{ form_label(registration_form.password, &#39;password&#39;, {&#39;label_attr&#39;: {&#39;style&#39;: &#39;display:none&#39;}}) }}
            {{ form_widget(registration_form.password, {&#39;attr&#39;:{&#39;class&#39;: &#39;form-control mt-3&#39;, &#39;placeholder&#39;: &#39;Contraseña&#39;, &#39;type&#39;:&#39;password&#39;}}) }}
            {{ form_errors(registration_form.password, {&#39;attr&#39;: {&#39;class&#39;: &#39;col-md-3&#39;}}) }}

            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-success form-control mt-3&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Darse de alta&quot;</span> <span class="p">/&gt;</span>
        <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

{% endblock %}
</pre></div>
</div>
</section>
<section id="paso-5-crear-login-e-iniciar-sesion">
<h3><a class="toc-backref" href="#id21">Paso 5: Crear Login e iniciar sesión</a><a class="headerlink" href="#paso-5-crear-login-e-iniciar-sesion" title="Enlazar permanentemente con este título">¶</a></h3>
<ul class="simple">
<li><p>En la carpeta <strong>config/packages</strong> editamos <strong>security.yaml</strong>:</p></li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">security</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="c1"># https://symfony.com/doc/current/security.html#registering-the-user-hashing-passwords</span><span class="w"></span>
<span class="w">    </span><span class="nt">password_hashers</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">Symfony\Component\Security\Core\User\PasswordAuthenticatedUserInterface</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;auto&#39;</span><span class="w"></span>
<span class="w">    </span><span class="c1"># https://symfony.com/doc/current/security.html#loading-the-user-the-user-provider</span><span class="w"></span>
<span class="w">    </span><span class="nt">providers</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="c1"># used to reload user from session &amp; other features (e.g. switch_user)</span><span class="w"></span>
<span class="w">        </span><span class="nt">app_user_provider</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="nt">entity</span><span class="p">:</span><span class="w"></span>
<span class="w">                </span><span class="nt">class</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Entity\User</span><span class="w"></span>
<span class="w">                </span><span class="nt">property</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">email</span><span class="w"></span>
<span class="w">    </span><span class="nt">firewalls</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">dev</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^/(_(profiler|wdt)|css|images|js)/</span><span class="w"></span>
<span class="w">            </span><span class="nt">security</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w"></span>
<span class="w">        </span><span class="nt">main</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="nt">lazy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">            </span><span class="nt">provider</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app_user_provider</span><span class="w"></span>
<span class="w">            </span><span class="nt">form_login</span><span class="p">:</span><span class="w"> </span><span class="c1"># Añadimos esta línea para autorizar el login en symfony</span><span class="w"></span>
<span class="w">                </span><span class="nt">login_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">login</span><span class="w"></span>
<span class="w">                </span><span class="nt">check_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">login</span><span class="w"></span>

<span class="w">            </span><span class="c1"># activate different ways to authenticate</span><span class="w"></span>
<span class="w">            </span><span class="c1"># https://symfony.com/doc/current/security.html#the-firewall</span><span class="w"></span>

<span class="w">            </span><span class="c1"># https://symfony.com/doc/current/security/impersonating_user.html</span><span class="w"></span>
<span class="w">            </span><span class="c1"># switch_user: true</span><span class="w"></span>

<span class="w">    </span><span class="c1"># Easy way to control access for large sections of your site</span><span class="w"></span>
<span class="w">    </span><span class="c1"># Note: Only the *first* access control that matches will be used</span><span class="w"></span>
<span class="w">    </span><span class="nt">access_control</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="c1"># - { path: ^/admin, roles: ROLE_ADMIN }</span><span class="w"></span>
<span class="w">        </span><span class="c1"># - { path: ^/profile, roles: ROLE_USER }</span><span class="w"></span>

<span class="nt">when@test</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">security</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">password_hashers</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="c1"># By default, password hashers are resource intensive and take time. This is</span><span class="w"></span>
<span class="w">            </span><span class="c1"># important to generate secure password hashes. In tests however, secure hashes</span><span class="w"></span>
<span class="w">            </span><span class="c1"># are not important, waste resources and increase test times. The following</span><span class="w"></span>
<span class="w">            </span><span class="c1"># reduces the work factor to the lowest possible values.</span><span class="w"></span>
<span class="w">            </span><span class="nt">Symfony\Component\Security\Core\User\PasswordAuthenticatedUserInterface</span><span class="p">:</span><span class="w"></span>
<span class="w">                </span><span class="nt">algorithm</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">auto</span><span class="w"></span>
<span class="w">                </span><span class="nt">cost</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span><span class="w"> </span><span class="c1"># Lowest possible value for bcrypt</span><span class="w"></span>
<span class="w">                </span><span class="nt">time_cost</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class="w"> </span><span class="c1"># Lowest possible value for argon</span><span class="w"></span>
<span class="w">                </span><span class="nt">memory_cost</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span><span class="w"> </span><span class="c1"># Lowest possible value for argon</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><p>Ahora editamos el controlador <strong>UserController.php</strong>:</p></li>
</ul>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Bundle\FrameworkBundle\Controller\AbstractController</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Routing\Annotation\Route</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Doctrine\ORM\EntityManagerInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\PasswordHasher\Hasher\UserPasswordHasherInterface</span><span class="p">;</span>
<span class="c1">// importamos la librería de autenticación:</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Security\Http\Authentication\AuthenticationUtils</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Entity\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Form\UserType</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">AbstractController</span>
<span class="p">{</span>   <span class="c1">// cargamos la librería de autenticación en el método:</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">login</span><span class="p">(</span><span class="nx">AuthenticationUtils</span> <span class="nv">$authenticationUtils</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="c1">// creamos un caso de error en una variable:</span>
        <span class="nv">$error</span> <span class="o">=</span> <span class="nv">$authenticationUtils</span><span class="o">-&gt;</span><span class="na">getLastAuthenticationError</span><span class="p">();</span>
        <span class="c1">// obtener el último usuario:</span>
        <span class="nv">$lastUsername</span> <span class="o">=</span> <span class="nv">$authenticationUtils</span><span class="o">-&gt;</span><span class="na">getLastUsername</span><span class="p">();</span>

        <span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
        <span class="nv">$registrationForm</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">UserType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$user</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;user/login.html.twig&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;registration_form&#39;</span> <span class="o">=&gt;</span> <span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">createView</span><span class="p">(),</span>
            <span class="s1">&#39;last_username&#39;</span> <span class="o">=&gt;</span> <span class="nv">$lastUsername</span><span class="p">,</span> <span class="c1">// pasamos el error y el ultimo usuario a la vista</span>
            <span class="s1">&#39;error&#39;</span> <span class="o">=&gt;</span> <span class="nv">$error</span>
        <span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">(</span>
        <span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span>
        <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">,</span>
        <span class="nx">UserPasswordHasherInterface</span> <span class="nv">$passwordHasher</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
        <span class="nv">$registrationForm</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">UserType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$user</span><span class="p">);</span>

        <span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">handleRequest</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">isSubmitted</span><span class="p">()){</span>
            <span class="k">if</span><span class="p">(</span><span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">()){</span>
                <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setRoles</span><span class="p">([</span><span class="s1">&#39;ROLE_USER&#39;</span><span class="p">]);</span>
                <span class="nv">$plainPassword</span> <span class="o">=</span> <span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">();</span>
                <span class="nv">$hashedPassword</span> <span class="o">=</span> <span class="nv">$passwordHasher</span><span class="o">-&gt;</span><span class="na">hashPassword</span><span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="nv">$plainPassword</span><span class="p">);</span>
                <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$hashedPassword</span><span class="p">);</span>

                <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
                <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
                <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Editamos la plantilla <strong>login.html.twig</strong>:</p></li>
</ul>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>{% extends &#39;base.html.twig&#39; %}

{% block title %}Iniciar Sesión{% endblock %}

{% block body %}
<span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="nc">example-wrapper</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">em</span><span class="w"> </span><span class="kc">auto</span><span class="p">;</span><span class="w"> </span><span class="k">max-width</span><span class="p">:</span><span class="w"> </span><span class="mi">800</span><span class="kt">px</span><span class="p">;</span><span class="w"> </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">95</span><span class="kt">%</span><span class="p">;</span><span class="w"> </span><span class="k">font</span><span class="p">:</span><span class="w"> </span><span class="mi">18</span><span class="kt">px</span><span class="o">/</span><span class="mf">1.5</span><span class="w"> </span><span class="kc">sans-serif</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="nc">example-wrapper</span><span class="w"> </span><span class="nt">code</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="mh">#F5F5F5</span><span class="p">;</span><span class="w"> </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="kt">px</span><span class="w"> </span><span class="mi">6</span><span class="kt">px</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- cargamos un formulario tal y como se describe en la documentación oficial: --&gt;</span>
<span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{{ path(&#39;login&#39;)}}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;username&quot;</span><span class="p">&gt;</span>Email<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;username&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;_username&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;{{last_username}}&quot;</span> <span class="p">/&gt;</span>

    <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">&gt;</span>Password<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;_password&quot;</span> <span class="p">/&gt;</span>

    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Login<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">form</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;userForm&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{{path(&#39;register&#39;)}}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">role</span><span class="o">=</span><span class="s">&quot;form&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
            {{ form_row(registration_form._token) }}

            {{ form_label(registration_form.email, &#39;email&#39;, {&#39;label_attr&#39;: {&#39;style&#39;: &#39;display:none&#39;}}) }}
            {{ form_widget(registration_form.email, {&#39;attr&#39;: {&#39;class&#39;: &#39;form-control mt-3&#39;, &#39;placeholder&#39;:&#39;Email&#39;}}) }}
            {{ form_errors(registration_form.email) }}

            {{ form_label(registration_form.password, &#39;password&#39;, {&#39;label_attr&#39;: {&#39;style&#39;: &#39;display:none&#39;}}) }}
            {{ form_widget(registration_form.password, {&#39;attr&#39;:{&#39;class&#39;: &#39;form-control mt-3&#39;, &#39;placeholder&#39;: &#39;Contraseña&#39;, &#39;type&#39;:&#39;password&#39;}}) }}
            {{ form_errors(registration_form.password, {&#39;attr&#39;: {&#39;class&#39;: &#39;col-md-3&#39;}}) }}

            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-success form-control mt-3&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Darse de alta&quot;</span> <span class="p">/&gt;</span>
        <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

{% endblock %}
</pre></div>
</div>
<ul class="simple">
<li><p>Si iniciamos sesión con un usuario ya creado nos mostrará en la barra de estado de desarrollo el usuario con el que hemos iniciado sesión.</p></li>
</ul>
</section>
<section id="paso-6-crear-logout">
<h3><a class="toc-backref" href="#id22">Paso 6: Crear Logout</a><a class="headerlink" href="#paso-6-crear-logout" title="Enlazar permanentemente con este título">¶</a></h3>
<ul class="simple">
<li><p>Vamos a crear por convención un método para logout vacío en <strong>UserController.php</strong>:</p></li>
</ul>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Bundle\FrameworkBundle\Controller\AbstractController</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Routing\Annotation\Route</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Doctrine\ORM\EntityManagerInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\PasswordHasher\Hasher\UserPasswordHasherInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Security\Http\Authentication\AuthenticationUtils</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Entity\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Form\UserType</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">AbstractController</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">login</span><span class="p">(</span><span class="nx">AuthenticationUtils</span> <span class="nv">$authenticationUtils</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nv">$error</span> <span class="o">=</span> <span class="nv">$authenticationUtils</span><span class="o">-&gt;</span><span class="na">getLastAuthenticationError</span><span class="p">();</span>
        <span class="nv">$lastUsername</span> <span class="o">=</span> <span class="nv">$authenticationUtils</span><span class="o">-&gt;</span><span class="na">getLastUsername</span><span class="p">();</span>

        <span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
        <span class="nv">$registrationForm</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">UserType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$user</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;user/login.html.twig&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;registration_form&#39;</span> <span class="o">=&gt;</span> <span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">createView</span><span class="p">(),</span>
            <span class="s1">&#39;last_username&#39;</span> <span class="o">=&gt;</span> <span class="nv">$lastUsername</span><span class="p">,</span>
            <span class="s1">&#39;error&#39;</span> <span class="o">=&gt;</span> <span class="nv">$error</span>
        <span class="p">]);</span>
    <span class="p">}</span>

    <span class="c1">// creamos el método logout, es un método que no retorna nada:</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">logout</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span> <span class="p">{}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">(</span>
        <span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span>
        <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">,</span>
        <span class="nx">UserPasswordHasherInterface</span> <span class="nv">$passwordHasher</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
        <span class="nv">$registrationForm</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">UserType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$user</span><span class="p">);</span>

        <span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">handleRequest</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">isSubmitted</span><span class="p">()){</span>
            <span class="k">if</span><span class="p">(</span><span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">()){</span>
                <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setRoles</span><span class="p">([</span><span class="s1">&#39;ROLE_USER&#39;</span><span class="p">]);</span>
                <span class="nv">$plainPassword</span> <span class="o">=</span> <span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">();</span>
                <span class="nv">$hashedPassword</span> <span class="o">=</span> <span class="nv">$passwordHasher</span><span class="o">-&gt;</span><span class="na">hashPassword</span><span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="nv">$plainPassword</span><span class="p">);</span>
                <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$hashedPassword</span><span class="p">);</span>

                <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
                <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
                <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Añadimos la ruta a <strong>routes.yaml</strong>:</p></li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">index</span><span class="p">:</span><span class="w"></span>
<span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span><span class="w"></span>
<span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\TaskController::index</span><span class="w"></span>

<span class="nt">finish</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tasks/finish/{id}</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\TaskController::finish</span><span class="w"></span>

<span class="nt">delete</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tasks/delete/{id}</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\TaskController::delete</span><span class="w"></span>

<span class="nt">update</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tasks/update/{id}</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\TaskController::update</span><span class="w"></span>

<span class="nt">login</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/login</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\UserController::login</span><span class="w"></span>

<span class="c1"># Añadimos la ruta para iniciar sesión y registro:</span><span class="w"></span>
<span class="nt">logout</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/logout</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\UserController::logout</span><span class="w"></span>

<span class="nt">register</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/register</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\UserController::register</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><p>Registramos el logout en el firewall de <strong>security.yaml</strong>:</p></li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">security</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="c1"># https://symfony.com/doc/current/security.html#registering-the-user-hashing-passwords</span><span class="w"></span>
<span class="w">    </span><span class="nt">password_hashers</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">Symfony\Component\Security\Core\User\PasswordAuthenticatedUserInterface</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;auto&#39;</span><span class="w"></span>
<span class="w">    </span><span class="c1"># https://symfony.com/doc/current/security.html#loading-the-user-the-user-provider</span><span class="w"></span>
<span class="w">    </span><span class="nt">providers</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="c1"># used to reload user from session &amp; other features (e.g. switch_user)</span><span class="w"></span>
<span class="w">        </span><span class="nt">app_user_provider</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="nt">entity</span><span class="p">:</span><span class="w"></span>
<span class="w">                </span><span class="nt">class</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Entity\User</span><span class="w"></span>
<span class="w">                </span><span class="nt">property</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">email</span><span class="w"></span>
<span class="w">    </span><span class="nt">firewalls</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">dev</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^/(_(profiler|wdt)|css|images|js)/</span><span class="w"></span>
<span class="w">            </span><span class="nt">security</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w"></span>
<span class="w">        </span><span class="nt">main</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="nt">lazy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">            </span><span class="nt">provider</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app_user_provider</span><span class="w"></span>
<span class="w">            </span><span class="nt">form_login</span><span class="p">:</span><span class="w"></span>
<span class="w">                </span><span class="nt">login_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">login</span><span class="w"></span>
<span class="w">                </span><span class="nt">check_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">login</span><span class="w"></span>
<span class="w">            </span><span class="c1"># añadimos la línea logout que apunta al path logout en las rutas:</span><span class="w"></span>
<span class="w">            </span><span class="nt">logout</span><span class="p">:</span><span class="w"></span>
<span class="w">                </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">logout</span><span class="w"></span>

<span class="w">            </span><span class="c1"># activate different ways to authenticate</span><span class="w"></span>
<span class="w">            </span><span class="c1"># https://symfony.com/doc/current/security.html#the-firewall</span><span class="w"></span>

<span class="w">            </span><span class="c1"># https://symfony.com/doc/current/security/impersonating_user.html</span><span class="w"></span>
<span class="w">            </span><span class="c1"># switch_user: true</span><span class="w"></span>

<span class="w">    </span><span class="c1"># Easy way to control access for large sections of your site</span><span class="w"></span>
<span class="w">    </span><span class="c1"># Note: Only the *first* access control that matches will be used</span><span class="w"></span>
<span class="w">    </span><span class="nt">access_control</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="c1"># - { path: ^/admin, roles: ROLE_ADMIN }</span><span class="w"></span>
<span class="w">        </span><span class="c1"># - { path: ^/profile, roles: ROLE_USER }</span><span class="w"></span>

<span class="nt">when@test</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">security</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">password_hashers</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="c1"># By default, password hashers are resource intensive and take time. This is</span><span class="w"></span>
<span class="w">            </span><span class="c1"># important to generate secure password hashes. In tests however, secure hashes</span><span class="w"></span>
<span class="w">            </span><span class="c1"># are not important, waste resources and increase test times. The following</span><span class="w"></span>
<span class="w">            </span><span class="c1"># reduces the work factor to the lowest possible values.</span><span class="w"></span>
<span class="w">            </span><span class="nt">Symfony\Component\Security\Core\User\PasswordAuthenticatedUserInterface</span><span class="p">:</span><span class="w"></span>
<span class="w">                </span><span class="nt">algorithm</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">auto</span><span class="w"></span>
<span class="w">                </span><span class="nt">cost</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span><span class="w"> </span><span class="c1"># Lowest possible value for bcrypt</span><span class="w"></span>
<span class="w">                </span><span class="nt">time_cost</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class="w"> </span><span class="c1"># Lowest possible value for argon</span><span class="w"></span>
<span class="w">                </span><span class="nt">memory_cost</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span><span class="w"> </span><span class="c1"># Lowest possible value for argon</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="paso-7-modificar-aspecto-de-login-y-registro">
<h3><a class="toc-backref" href="#id23">Paso 7: Modificar Aspecto de Login y Registro</a><a class="headerlink" href="#paso-7-modificar-aspecto-de-login-y-registro" title="Enlazar permanentemente con este título">¶</a></h3>
<ul class="simple">
<li><p>Creamos una nueva hoja de estilos en la carpeta <strong>css</strong> llamada <strong>login_style.css</strong>:</p></li>
</ul>
<div class="highlight-css notranslate"><div class="highlight"><pre><span></span><span class="nt">html</span><span class="o">,</span><span class="w"></span>
<span class="p">.</span><span class="nc">bodystyle</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">height</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="kt">vh</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="p">.</span><span class="nc">bodystyle</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">flex</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">align-items</span><span class="p">:</span><span class="w"> </span><span class="kc">center</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">padding-top</span><span class="p">:</span><span class="w"> </span><span class="mi">40</span><span class="kt">px</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">padding-bottom</span><span class="p">:</span><span class="w"> </span><span class="mi">40</span><span class="kt">px</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#f5f5f5</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="p">.</span><span class="nc">form-signin</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="kt">%</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">max-width</span><span class="p">:</span><span class="w"> </span><span class="mi">330</span><span class="kt">px</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="kt">px</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">margin</span><span class="p">:</span><span class="w"> </span><span class="kc">auto</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="p">.</span><span class="nc">form-signin</span><span class="w"> </span><span class="p">.</span><span class="nc">checkbox</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">font-weight</span><span class="p">:</span><span class="w"> </span><span class="mi">400</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="p">.</span><span class="nc">form-signin</span><span class="w"> </span><span class="p">.</span><span class="nc">form-floating</span><span class="p">:</span><span class="nd">focus-within</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">z-index</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="p">.</span><span class="nc">form-signin</span><span class="w"> </span><span class="nt">input</span><span class="o">[</span><span class="nt">type</span><span class="o">=</span><span class="s2">&quot;email&quot;</span><span class="o">]</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">margin-bottom</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="kt">px</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">border-bottom-right-radius</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">border-bottom-left-radius</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="p">.</span><span class="nc">form-signin</span><span class="w"> </span><span class="nt">input</span><span class="o">[</span><span class="nt">type</span><span class="o">=</span><span class="s2">&quot;password&quot;</span><span class="o">]</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">margin-bottom</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="kt">px</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">border-top-left-radius</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">border-top-right-radius</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="p">.</span><span class="nc">cursor</span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">border</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="kt">px</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="kc">transparent</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><p>Vamos a la plantilla base y la añadimos con la condicion de que trabaje en la ruta <strong>login</strong> y <strong>reset_password</strong> (esta última la veremos mas adelante):</p></li>
</ul>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>{% block title %}Task Learn{% endblock %}<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;icon&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 128 128%22&gt;&lt;text y=%221.2em%22 font-size=%2296%22&gt;⚫️&lt;/text&gt;&lt;/svg&gt;&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css&quot;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&quot;sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx&quot;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&quot;anonymous&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{asset(&#39;assets/css/base.css&#39;)}}&quot;</span> <span class="p">/&gt;</span>
        <span class="cm">&lt;!-- Esta hoja comprueba si la ruta es login o reset_password para cargarse: --&gt;</span>
       {% if app.request.get(&#39;_route&#39;) in [&#39;login&#39;,&#39;reset_password&#39;] %}
            <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{asset(&#39;assets/css/login_style.css&#39;)}}&quot;</span> <span class="p">/&gt;</span>
        {% endif %}
        {# Run `composer require symfony/webpack-encore-bundle` to start using Symfony UX #}
        {% block stylesheets %}
            {{ encore_entry_link_tags(&#39;app&#39;) }}
        {% endblock %}

        {% block javascripts %}
            {{ encore_entry_script_tags(&#39;app&#39;) }}
        {% endblock %}
    <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
        <span class="cm">&lt;!-- Ocultar navbar cuando la ruta sea login o register: --&gt;</span>
        {% if app.request.get(&#39;_route&#39;) not in [&#39;login&#39;,&#39;reset_password&#39;] %}
            <span class="p">&lt;</span><span class="nt">nav</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar navbar-expand-lg navbar-dark bg-dark&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-11 align-items-start ms-2&quot;</span> <span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ path(&#39;index&#39;) }}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar-brand&quot;</span><span class="p">&gt;</span>Task Learn<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

                <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar-nav mb-2 mb-lg-0 col-md-1 align-items-end me-3&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-item align-items-end&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/users&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-link text-center&quot;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">img</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;avatar rounded img-thumbnail img-fluid&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;./assets/images/avatar.png&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;foto&quot;</span> <span class="p">/&gt;</span>
                            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">small</span><span class="p">&gt;</span>Usuario<span class="p">&lt;/</span><span class="nt">small</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>
        {% endif %}

        {% block body %}{% endblock %}

        <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.min.js&quot;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&quot;sha384-ODmDIVzN+pFdexxHEHFBQH3/9/vQ9uori45z4JjnFsRydbmQbmL5t1tQ0culUzyK&quot;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&quot;anonymous&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;{{asset(&#39;assets/js/base.js&#39;)}}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Vamos a modificar la plantilla de login y registro para que muestre el login como principal y el registro en un modal en <strong>login.html.twig</strong>:</p></li>
</ul>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>{% extends &#39;base.html.twig&#39; %}

{% block title %}Iniciar Sesión{% endblock %}

{% block body %}
<span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="nc">example-wrapper</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">em</span><span class="w"> </span><span class="kc">auto</span><span class="p">;</span><span class="w"> </span><span class="k">max-width</span><span class="p">:</span><span class="w"> </span><span class="mi">800</span><span class="kt">px</span><span class="p">;</span><span class="w"> </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">95</span><span class="kt">%</span><span class="p">;</span><span class="w"> </span><span class="k">font</span><span class="p">:</span><span class="w"> </span><span class="mi">18</span><span class="kt">px</span><span class="o">/</span><span class="mf">1.5</span><span class="w"> </span><span class="kc">sans-serif</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="nc">example-wrapper</span><span class="w"> </span><span class="nt">code</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="mh">#F5F5F5</span><span class="p">;</span><span class="w"> </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="kt">px</span><span class="w"> </span><span class="mi">6</span><span class="kt">px</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- creamos una estructura para mostrar el login: --&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;bodystyle text-center&quot;</span> <span class="na">cz-shortcut-listen</span><span class="o">=</span><span class="s">&quot;true&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-signin text-center&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Por favor inicia sesión<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{{ path(&#39;login&#39;)}}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-floating&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;email&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;username&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;_username&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;{{last_username}}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-control&quot;</span> <span class="p">/&gt;</span>
                <span class="p">&lt;</span><span class="nt">label</span> <span class="na">htmlFor</span><span class="o">=</span><span class="s">&quot;floatingInput&quot;</span><span class="p">&gt;</span>Email<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-floating&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;_password&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-control&quot;</span> <span class="p">/&gt;</span>
                <span class="p">&lt;</span><span class="nt">label</span> <span class="na">htmlFor</span><span class="o">=</span><span class="s">&quot;floatingPassword&quot;</span><span class="p">&gt;</span>Contraseña<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mb-3&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;button&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;cursor&quot;</span> <span class="na">data-bs-toggle</span><span class="o">=</span><span class="s">&quot;modal&quot;</span> <span class="na">data-bs-target</span><span class="o">=</span><span class="s">&quot;#registerUser&quot;</span>  <span class="na">data-bs-toggle</span><span class="o">=</span><span class="s">&quot;modal&quot;</span> <span class="na">data-bs-target</span><span class="o">=</span><span class="s">&quot;#registerUser&quot;</span><span class="p">&gt;</span>Crear usuario<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mb-3&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;button&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;cursor&quot;</span><span class="p">&gt;</span>¿has olvidado la contraseña?<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-100 btn btn-lg btn-primary&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Iniciar sesión<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- Modal para crear usuarios: --&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal fade&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;registerUser&quot;</span> <span class="na">tabIndex</span><span class="o">=</span><span class="s">&quot;-1&quot;</span> <span class="na">aria-labelledby</span><span class="o">=</span><span class="s">&quot;exampleModalLabel&quot;</span> <span class="na">aria-hidden</span><span class="o">=</span><span class="s">&quot;true&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-dialog&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-content&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-header&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">h5</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-title&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;exampleModalLabel&quot;</span><span class="p">&gt;</span>Registro<span class="p">&lt;/</span><span class="nt">h5</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;button&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn-close&quot;</span> <span class="na">data-bs-dismiss</span><span class="o">=</span><span class="s">&quot;modal&quot;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&quot;Close&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-body&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container&quot;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">form</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;userForm&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{{path(&#39;register&#39;)}}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">role</span><span class="o">=</span><span class="s">&quot;form&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container&quot;</span><span class="p">&gt;</span>
                                {{ form_row(registration_form._token) }}

                                {{ form_label(registration_form.email, &#39;email&#39;, {&#39;label_attr&#39;: {&#39;style&#39;: &#39;display:none&#39;}}) }}
                                {{ form_widget(registration_form.email, {&#39;attr&#39;: {&#39;class&#39;: &#39;form-control mt-3&#39;, &#39;placeholder&#39;:&#39;Email&#39;}}) }}
                                {{ form_errors(registration_form.email) }}

                                {{ form_label(registration_form.password, &#39;password&#39;, {&#39;label_attr&#39;: {&#39;style&#39;: &#39;display:none&#39;}}) }}
                                {{ form_widget(registration_form.password, {&#39;attr&#39;:{&#39;class&#39;: &#39;form-control mt-3&#39;, &#39;placeholder&#39;: &#39;Contraseña&#39;, &#39;type&#39;:&#39;password&#39;}}) }}
                                {{ form_errors(registration_form.password, {&#39;attr&#39;: {&#39;class&#39;: &#39;col-md-3&#39;}}) }}

                                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-success form-control mt-3&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Darse de alta&quot;</span> <span class="p">/&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

{% endblock %}
</pre></div>
</div>
</section>
<section id="paso-8-relacionar-tareas-con-usuarios">
<h3><a class="toc-backref" href="#id24">Paso 8: Relacionar tareas con usuarios</a><a class="headerlink" href="#paso-8-relacionar-tareas-con-usuarios" title="Enlazar permanentemente con este título">¶</a></h3>
<ul class="simple">
<li><p>Editamos el controlador para asignar el usuario que ha iniciado sesión a la tarea en <strong>TaskController.php</strong>:</p></li>
</ul>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Bundle\FrameworkBundle\Controller\AbstractController</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Routing\Annotation\Route</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Doctrine\ORM\EntityManagerInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Entity\Task</span><span class="p">;</span>
<span class="c1">// importamos user:</span>
<span class="k">use</span> <span class="nx">App\Entity\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Form\TaskType</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">TaskController</span> <span class="k">extends</span> <span class="nx">AbstractController</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="c1">// localizamos el usuario a través del token que esta usando en sesión:</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getUser</span><span class="p">();</span>
        <span class="c1">// filtramos la recuperacion de tareas para solo coger las del propietario:</span>
        <span class="nv">$tasks</span> <span class="o">=</span> <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="nx">Task</span><span class="o">::</span><span class="na">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">findBy</span><span class="p">([</span><span class="s1">&#39;owner&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="p">]);</span>
        <span class="nv">$task</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Task</span><span class="p">();</span>
        <span class="nv">$form</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">TaskType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$task</span><span class="p">);</span>
        <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">handleRequest</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>

        <span class="k">if</span><span class="p">(</span><span class="nv">$form</span><span class="o">-&gt;</span><span class="na">isSubmitted</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">()){</span>
            <span class="nv">$task</span><span class="o">-&gt;</span><span class="na">setDateCreated</span><span class="p">(</span><span class="k">new</span> <span class="nx">\DateTime</span><span class="p">())</span>
                <span class="o">-&gt;</span><span class="na">setIsComplete</span><span class="p">(</span><span class="k">false</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">setOwner</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span> <span class="c1">// le pasamos el usuario a la clave foranea de la tarea</span>
            <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$task</span><span class="p">);</span>
            <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;task/index.html.twig&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;tasks&#39;</span> <span class="o">=&gt;</span> <span class="nv">$tasks</span><span class="p">,</span>
            <span class="s1">&#39;taskForm&#39;</span> <span class="o">=&gt;</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">createView</span><span class="p">(),</span>
            <span class="s1">&#39;taskEditForm&#39;</span> <span class="o">=&gt;</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">createView</span><span class="p">()</span>
        <span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">finish</span><span class="p">(</span><span class="nv">$id</span><span class="p">,</span> <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="c1">// localizamos el usuario a través del token que esta usando en sesión:</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getUser</span><span class="p">();</span>
        <span class="c1">// del mismo modo vamos a filtrar las tareas para no finalizar las de otros usuarios:</span>
        <span class="nv">$task</span> <span class="o">=</span> <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="nx">Task</span><span class="o">::</span><span class="na">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">findOneBy</span><span class="p">([</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$id</span><span class="p">,</span> <span class="s1">&#39;owner&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="p">]);</span>

        <span class="c1">// comprobamos que hemos recuperado una tarea:</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$task</span><span class="p">){</span>
            <span class="nv">$task</span><span class="o">-&gt;</span><span class="na">setIsComplete</span><span class="p">(</span><span class="k">true</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">setDateFinish</span><span class="p">(</span><span class="k">new</span> <span class="nx">\DateTime</span><span class="p">());</span>

            <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$task</span><span class="p">);</span>
            <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">delete</span><span class="p">(</span><span class="nv">$id</span><span class="p">,</span> <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="c1">// localizamos el usuario a través del token que esta usando en sesión:</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getUser</span><span class="p">();</span>
        <span class="c1">// del mismo modo vamos a filtrar las tareas para no eliminar las de otros usuarios:</span>
        <span class="nv">$task</span> <span class="o">=</span> <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="nx">Task</span><span class="o">::</span><span class="na">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">findOneBy</span><span class="p">([</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$id</span><span class="p">,</span> <span class="s1">&#39;owner&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="p">]);</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$task</span><span class="p">){</span>
            <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">remove</span><span class="p">(</span><span class="nv">$task</span><span class="p">);</span>
            <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nv">$id</span><span class="p">,</span> <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">,</span> <span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="c1">// localizamos el usuario a través del token que esta usando en sesión:</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getUser</span><span class="p">();</span>
        <span class="c1">// del mismo modo vamos a filtrar las tareas para no eliminar las de otros usuarios:</span>
        <span class="nv">$task</span> <span class="o">=</span> <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="nx">Task</span><span class="o">::</span><span class="na">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">findOneBy</span><span class="p">([</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$id</span><span class="p">,</span> <span class="s1">&#39;owner&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="p">]);</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$task</span><span class="p">){</span>
            <span class="nx">dump</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">));</span>
            <span class="nv">$form</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">TaskType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$task</span><span class="p">);</span>
            <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">handleRequest</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="nv">$form</span><span class="o">-&gt;</span><span class="na">isSubmitted</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">()){</span>
                <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">);</span>

    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="paso-9-perfil-de-usuario-y-edicion">
<h3><a class="toc-backref" href="#id25">Paso 9: Perfil de usuario y edición</a><a class="headerlink" href="#paso-9-perfil-de-usuario-y-edicion" title="Enlazar permanentemente con este título">¶</a></h3>
<ul class="simple">
<li><p>Editamos el formulario para gestionar las contraseñas y los archivos en <strong>UserType.php</strong>:</p></li>
</ul>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Form</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Entity\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\AbstractType</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\FormBuilderInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\OptionsResolver\OptionsResolver</span><span class="p">;</span>
<span class="c1">// añadimos el passwordType y el emailtype:</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\Extension\Core\Type\PasswordType</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\Extension\Core\Type\EmailType</span><span class="p">;</span>
<span class="c1">// también añadimos el Filetype para subir archivos y el File para crear un nuevo objeto archivo:</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\Extension\Core\Type\FileType</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Validator\Constraints\File</span><span class="p">;</span>


<span class="k">class</span> <span class="nc">UserType</span> <span class="k">extends</span> <span class="nx">AbstractType</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">buildForm</span><span class="p">(</span><span class="nx">FormBuilderInterface</span> <span class="nv">$builder</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$options</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$builder</span>
            <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="nx">EmailType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;required&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span> <span class="c1">// que sea requerido</span>
            <span class="p">))</span>
            <span class="c1">// Eliminamos los roles ya que nos los vamos a usar: -&gt;add(&#39;roles&#39;)</span>
            <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="nx">PasswordType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;required&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span> <span class="c1">// que sea requerido</span>
                <span class="s1">&#39;empty_data&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span> <span class="c1">// definimos un valor vacio si no se escribe nada en la contraseña</span>
            <span class="p">))</span>
            <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;lastname&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;avatar&#39;</span><span class="p">,</span> <span class="nx">FileType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="p">[</span>
                <span class="s1">&#39;required&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span> <span class="c1">// que no sea requerido</span>
                <span class="s1">&#39;data_class&#39;</span> <span class="o">=&gt;</span> <span class="k">null</span><span class="p">,</span> <span class="c1">// evita un fallo en symfony con la clase del archivo</span>
                <span class="s1">&#39;constraints&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span> <span class="c1">// los constraints son las limitaciones a la hora de subir el archivo:</span>
                    <span class="k">new</span> <span class="nx">File</span><span class="p">([</span>
                        <span class="s1">&#39;maxSize&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;1024k&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;mimeTypes&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                            <span class="s1">&#39;image/jpeg&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;image/jpg&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;image/png&#39;</span>
                        <span class="p">],</span>
                        <span class="s1">&#39;mimeTypesMessage&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;El formato de archivo no es correcto&#39;</span>
                    <span class="p">])</span>
                <span class="p">]</span>
            <span class="p">])</span>
        <span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">configureOptions</span><span class="p">(</span><span class="nx">OptionsResolver</span> <span class="nv">$resolver</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$resolver</span><span class="o">-&gt;</span><span class="na">setDefaults</span><span class="p">([</span>
            <span class="s1">&#39;data_class&#39;</span> <span class="o">=&gt;</span> <span class="nx">User</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Vamos a hacer es crear un método para ver los datos del usuario en <strong>UserController.php</strong>:</p></li>
</ul>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Bundle\FrameworkBundle\Controller\AbstractController</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Routing\Annotation\Route</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Doctrine\ORM\EntityManagerInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\PasswordHasher\Hasher\UserPasswordHasherInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Security\Http\Authentication\AuthenticationUtils</span><span class="p">;</span>
<span class="c1">// importamos la librería slugger y las librerías para trabajar con archivos:</span>
<span class="k">use</span> <span class="nx">Symfony\Component\String\Slugger\SluggerInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\File\Exception\FileException</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\File\UploadedFile</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Entity\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Form\UserType</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">AbstractController</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">login</span><span class="p">(</span><span class="nx">AuthenticationUtils</span> <span class="nv">$authenticationUtils</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nv">$error</span> <span class="o">=</span> <span class="nv">$authenticationUtils</span><span class="o">-&gt;</span><span class="na">getLastAuthenticationError</span><span class="p">();</span>
        <span class="nv">$lastUsername</span> <span class="o">=</span> <span class="nv">$authenticationUtils</span><span class="o">-&gt;</span><span class="na">getLastUsername</span><span class="p">();</span>

        <span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
        <span class="nv">$registrationForm</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">UserType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$user</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;user/login.html.twig&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;registration_form&#39;</span> <span class="o">=&gt;</span> <span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">createView</span><span class="p">(),</span>
            <span class="s1">&#39;last_username&#39;</span> <span class="o">=&gt;</span> <span class="nv">$lastUsername</span><span class="p">,</span>
            <span class="s1">&#39;error&#39;</span> <span class="o">=&gt;</span> <span class="nv">$error</span>
        <span class="p">]);</span>
    <span class="p">}</span>

    <span class="c1">// creamos el método logout, es un método que no retorna nada:</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">logout</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span> <span class="p">{}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">(</span>
        <span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span>
        <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">,</span>
        <span class="nx">UserPasswordHasherInterface</span> <span class="nv">$passwordHasher</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
        <span class="nv">$registrationForm</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">UserType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$user</span><span class="p">);</span>

        <span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">handleRequest</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">isSubmitted</span><span class="p">()){</span>
            <span class="k">if</span><span class="p">(</span><span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">()){</span>
                <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setRoles</span><span class="p">([</span><span class="s1">&#39;ROLE_USER&#39;</span><span class="p">]);</span>
                <span class="nv">$plainPassword</span> <span class="o">=</span> <span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">();</span>
                <span class="nv">$hashedPassword</span> <span class="o">=</span> <span class="nv">$passwordHasher</span><span class="o">-&gt;</span><span class="na">hashPassword</span><span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="nv">$plainPassword</span><span class="p">);</span>
                <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$hashedPassword</span><span class="p">);</span>

                <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
                <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
                <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">// creamos el nuevo método para editar el perfil:</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">profile</span><span class="p">(</span>
        <span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span>
        <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">,</span>
        <span class="nx">UserPasswordHasherInterface</span> <span class="nv">$passwordHasher</span><span class="p">,</span>
        <span class="nx">SluggerInterface</span> <span class="nv">$slugger</span> <span class="c1">// cargamos la librería slugger</span>
    <span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="c1">// localizamos el usuario a través del token que esta usando en sesión:</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getUser</span><span class="p">();</span>
        <span class="c1">// comprobamos si tenemos una imagen ya registrada y la cargamos en avatar:</span>
        <span class="nv">$isAvatar</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getAvatar</span><span class="p">();</span>

        <span class="k">if</span><span class="p">(</span><span class="nv">$isAvatar</span><span class="p">){</span>
            <span class="nv">$avatar</span> <span class="o">=</span> <span class="s1">&#39;./uploads/avatars/&#39;</span> <span class="o">.</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getAvatar</span><span class="p">();</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="nv">$avatar</span> <span class="o">=</span> <span class="s1">&#39;./assets/images/avatar.png&#39;</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// creamos una variable para el password antiguo:</span>
        <span class="nv">$oldPassword</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getPassword</span><span class="p">();</span>
        <span class="c1">// cargamos el usuario en el formulario:</span>
        <span class="nv">$userEditForm</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">UserType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$user</span><span class="p">);</span>

        <span class="c1">// recuperamos los datos de la request y los cargamos en el formulario para validarlos:</span>
        <span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">handleRequest</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>

        <span class="k">if</span><span class="p">(</span><span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">isSubmitted</span><span class="p">()){</span>
            <span class="k">if</span><span class="p">(</span><span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">()){</span>
                <span class="c1">// obtener el archivo:</span>
                <span class="nv">$file</span> <span class="o">=</span> <span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;avatar&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">();</span>
                <span class="c1">// comprobamos si existe un archivo:</span>
                <span class="k">if</span><span class="p">(</span><span class="nv">$file</span><span class="p">){</span>
                    <span class="c1">// recuperamos el nombre del archivo:</span>
                    <span class="nv">$originalFilename</span> <span class="o">=</span> <span class="nb">pathinfo</span><span class="p">(</span><span class="nv">$file</span><span class="o">-&gt;</span><span class="na">getClientOriginalName</span><span class="p">(),</span> <span class="nx">PATHINFO_FILENAME</span><span class="p">);</span>
                    <span class="c1">// lo cambiamos por un nombre seguro:</span>
                    <span class="nv">$safeFilename</span> <span class="o">=</span> <span class="nv">$slugger</span><span class="o">-&gt;</span><span class="na">slug</span><span class="p">(</span><span class="nv">$originalFilename</span><span class="p">);</span>
                    <span class="c1">// y le agregamos un identificador único:</span>
                    <span class="nv">$newFilename</span> <span class="o">=</span> <span class="nv">$safeFilename</span> <span class="o">.</span> <span class="s1">&#39;-&#39;</span> <span class="o">.</span> <span class="nb">uniqid</span><span class="p">()</span> <span class="o">.</span> <span class="s1">&#39;.&#39;</span> <span class="o">.</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">guessExtension</span><span class="p">();</span>
                    <span class="c1">// controlamos lo que nos va a llegar:</span>
                    <span class="k">try</span><span class="p">{</span>
                        <span class="c1">// movemos el archivo al directorio correspondiente en el proyecto:</span>
                        <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">move</span><span class="p">(</span>
                            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getParameter</span><span class="p">(</span><span class="s1">&#39;avatars&#39;</span><span class="p">),</span>
                            <span class="nv">$newFilename</span>
                        <span class="p">);</span>
                    <span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">FileException</span> <span class="nv">$e</span><span class="p">){</span>
                        <span class="c1">// ignoramos el error y seguimos adelante</span>
                    <span class="p">}</span>

                    <span class="c1">// grabamos en la base de datos el nombre del archivo:</span>
                    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setAvatar</span><span class="p">(</span><span class="nv">$newFilename</span><span class="p">);</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span> <span class="c1">// si no se ha cargado un archivo para evitar borrar el actual volvemos a escribirlo usando la variable de comprobación:</span>
                    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setAvatar</span><span class="p">(</span><span class="nv">$isAvatar</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="nv">$plainPassword</span> <span class="o">=</span> <span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">();</span>
                <span class="c1">// solo cambiará la contraseña si recibe algo por el campo contraseña:</span>
                <span class="k">if</span><span class="p">(</span><span class="nv">$plainPassword</span><span class="p">){</span>
                    <span class="nv">$hashedPassword</span> <span class="o">=</span> <span class="nv">$passwordHasher</span><span class="o">-&gt;</span><span class="na">hashPassword</span><span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="nv">$plainPassword</span><span class="p">);</span>
                    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$hashedPassword</span><span class="p">);</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="c1">// sino pegara el hash del antiguo password:</span>
                    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$oldPassword</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
                <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// retornamos en el template el formulario con los datos:</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;user/profile.html.twig&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;user_edit_form&#39;</span> <span class="o">=&gt;</span> <span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">createView</span><span class="p">(),</span>
            <span class="s1">&#39;avatar&#39;</span> <span class="o">=&gt;</span> <span class="nv">$avatar</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Creamos una nueva plantilla en <strong>user</strong> llamada <strong>profile.html.twig</strong>:</p></li>
</ul>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>{% extends &#39;base.html.twig&#39; %}

{% block title %}Perfil de usuario{% endblock %}

{% block body %}

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container mt-4 text-center&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>Datos de usuario<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">hr</span> <span class="p">/&gt;</span>
            <span class="cm">&lt;!-- la imagen vamos a cargarla desde controlador --&gt;</span>
            <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;{{avatar}}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;avatarEdit rounded img-thumbnail img-fluid&quot;</span>  <span class="na">alt</span><span class="o">=</span><span class="s">&quot;Avatar&quot;</span> <span class="p">/&gt;</span>
            <span class="cm">&lt;!-- No olvides poner que el formulario es tipo multipart --&gt;</span>
            <span class="p">&lt;</span><span class="nt">form</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;userEditForm&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">role</span><span class="o">=</span><span class="s">&quot;form&quot;</span> <span class="na">enctype</span><span class="o">=</span><span class="s">&#39;multipart/form-data&#39;</span><span class="p">&gt;</span>
                {{ form_row(user_edit_form._token) }}
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-12 mt-3&quot;</span><span class="p">&gt;</span>
                        {{ form_label(user_edit_form.avatar, &#39;avatar&#39;, {&#39;label_attr&#39;: {&#39;style&#39;: &#39;display:none&#39;}}) }}
                        {{ form_widget(user_edit_form.avatar, {&#39;attr&#39;: {&#39;class&#39;: &#39;col me-2 form-control form-sm&#39;, &#39;placeholder&#39;: &#39;Avatar&#39;}}) }}
                        {{ form_errors(user_edit_form.avatar) }}
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-12 mt-3&quot;</span><span class="p">&gt;</span>
                        {{ form_label(user_edit_form.name, &#39;name&#39;, {&#39;label_attr&#39;: {&#39;style&#39;: &#39;display:none&#39;}}) }}
                        {{ form_widget(user_edit_form.name, {&#39;attr&#39;: {&#39;class&#39;: &#39;col me-2 form-control form-sm&#39;, &#39;placeholder&#39;: &#39;Nombre&#39;}}) }}
                        {{ form_errors(user_edit_form.name) }}
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-12 mt-3&quot;</span><span class="p">&gt;</span>
                        {{ form_label(user_edit_form.lastname, &#39;lastname&#39;, {&#39;label_attr&#39;: {&#39;style&#39;: &#39;display:none&#39;}}) }}
                        {{ form_widget(user_edit_form.lastname, {&#39;attr&#39;: {&#39;class&#39;: &#39;col me-2 form-control form-sm&#39;, &#39;placeholder&#39;: &#39;Apellidos&#39;}}) }}
                        {{ form_errors(user_edit_form.lastname) }}
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-12 mt-3&quot;</span><span class="p">&gt;</span>
                        {{ form_label(user_edit_form.email, &#39;email&#39;, {&#39;label_attr&#39;: {&#39;style&#39;: &#39;display:none&#39;}}) }}
                        {{ form_widget(user_edit_form.email, {&#39;attr&#39;: {&#39;class&#39;: &#39;col me-2 form-control form-sm&#39;, &#39;placeholder&#39;: &#39;Email&#39;}}) }}
                        {{ form_errors(user_edit_form.email) }}
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-12 mt-3&quot;</span><span class="p">&gt;</span>
                        {{ form_label(user_edit_form.password, &#39;password&#39;, {&#39;label_attr&#39;: {&#39;style&#39;: &#39;display:none&#39;}}) }}
                        {{ form_widget(user_edit_form.password, {&#39;attr&#39;: {&#39;class&#39;: &#39;col me-2 form-control form-sm&#39;, &#39;placeholder&#39;: &#39;Contraseña (dejar en blanco para no cambiar)&#39;}}) }}
                        {{ form_errors(user_edit_form.password) }}
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-12 mt-3&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-success form-control mt-3&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Actualizar datos&quot;</span> <span class="p">/&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-12 mt-3&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{path(&#39;logout&#39;)}}&quot;</span><span class="p">&gt;</span>Cerrar sesión<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

{% endblock %}
</pre></div>
</div>
<ul class="simple">
<li><p>Creamos la ruta en <strong>routes.yaml</strong>:</p></li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">index</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\TaskController::index</span><span class="w"></span>

<span class="nt">finish</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tasks/finish/{id}</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\TaskController::finish</span><span class="w"></span>

<span class="nt">delete</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tasks/delete/{id}</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\TaskController::delete</span><span class="w"></span>

<span class="nt">update</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tasks/update/{id}</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\TaskController::update</span><span class="w"></span>

<span class="nt">login</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/login</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\UserController::login</span><span class="w"></span>

<span class="nt">logout</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/logout</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\UserController::logout</span><span class="w"></span>

<span class="nt">register</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/register</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\UserController::register</span><span class="w"></span>

<span class="c1"># cargamos la ruta para editar perfil:</span><span class="w"></span>
<span class="nt">profile</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/profile</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\UserController::profile</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><p>Y debemos especificar la ruta donde se van a guardar los avatars en <strong>config/services.yaml</strong>:</p></li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># This file is the entry point to configure your own services.</span><span class="w"></span>
<span class="c1"># Files in the packages/ subdirectory configure your dependencies.</span><span class="w"></span>

<span class="c1"># Put parameters here that don&#39;t need to change on each machine where the app is deployed</span><span class="w"></span>
<span class="c1"># https://symfony.com/doc/current/best_practices.html#use-parameters-for-application-configuration</span><span class="w"></span>
<span class="nt">parameters</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="c1"># añadimos el directorio donde se van a guardar los avatares:</span><span class="w"></span>
<span class="w">    </span><span class="nt">avatars</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;%kernel.project_dir%/public/uploads/avatars&#39;</span><span class="w"></span>
<span class="nt">services</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="c1"># default configuration for services in *this* file</span><span class="w"></span>
<span class="w">    </span><span class="nt">_defaults</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">autowire</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">      </span><span class="c1"># Automatically injects dependencies in your services.</span><span class="w"></span>
<span class="w">        </span><span class="nt">autoconfigure</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"> </span><span class="c1"># Automatically registers your services as commands, event subscribers, etc.</span><span class="w"></span>

<span class="w">    </span><span class="c1"># makes classes in src/ available to be used as services</span><span class="w"></span>
<span class="w">    </span><span class="c1"># this creates a service per class whose id is the fully-qualified class name</span><span class="w"></span>
<span class="w">    </span><span class="nt">App\</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">resource</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;../src/&#39;</span><span class="w"></span>
<span class="w">        </span><span class="nt">exclude</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;../src/DependencyInjection/&#39;</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;../src/Entity/&#39;</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;../src/Kernel.php&#39;</span><span class="w"></span>

<span class="w">    </span><span class="c1"># add more service definitions when explicit configuration is needed</span><span class="w"></span>
<span class="w">    </span><span class="c1"># please note that last definitions always *replace* previous ones</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><p>Ajustamos el css del avatar para que no sea tan grande la imagen en <strong>base.css</strong>:</p></li>
</ul>
<div class="highlight-css notranslate"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nc">avatar</span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">height</span><span class="p">:</span><span class="w"> </span><span class="mi">40</span><span class="kt">px</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">40</span><span class="kt">px</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="p">.</span><span class="nc">avatarEdit</span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="kt">px</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">height</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="kt">px</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="paso-10-cargar-avatar-rutas-y-nombre-en-navbar">
<h3><a class="toc-backref" href="#id26">Paso 10: Cargar avatar, rutas y nombre en navbar</a><a class="headerlink" href="#paso-10-cargar-avatar-rutas-y-nombre-en-navbar" title="Enlazar permanentemente con este título">¶</a></h3>
<ul class="simple">
<li><p>En primer lugar editamos la plantilla <strong>base.html.twig</strong>:</p></li>
</ul>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>{% block title %}Task Learn{% endblock %}<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;icon&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 128 128%22&gt;&lt;text y=%221.2em%22 font-size=%2296%22&gt;⚫️&lt;/text&gt;&lt;/svg&gt;&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css&quot;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&quot;sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx&quot;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&quot;anonymous&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{asset(&#39;assets/css/base.css&#39;)}}&quot;</span> <span class="p">/&gt;</span>
       {% if app.request.get(&#39;_route&#39;) in [&#39;login&#39;,&#39;reset_password&#39;] %}
            <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{asset(&#39;assets/css/login_style.css&#39;)}}&quot;</span> <span class="p">/&gt;</span>
        {% endif %}
        {# Run `composer require symfony/webpack-encore-bundle` to start using Symfony UX #}
        {% block stylesheets %}
            {{ encore_entry_link_tags(&#39;app&#39;) }}
        {% endblock %}

        {% block javascripts %}
            {{ encore_entry_script_tags(&#39;app&#39;) }}
        {% endblock %}
    <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
        {% if app.request.get(&#39;_route&#39;) not in [&#39;login&#39;,&#39;reset_password&#39;] %}
            <span class="p">&lt;</span><span class="nt">nav</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar navbar-expand-lg navbar-dark bg-dark&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-11 align-items-start ms-2&quot;</span> <span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ path(&#39;index&#39;) }}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar-brand&quot;</span><span class="p">&gt;</span>Task Learn<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

                <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar-nav mb-2 mb-lg-0 col-md-1 align-items-end me-3&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-item align-items-end&quot;</span><span class="p">&gt;</span>
                        <span class="cm">&lt;!-- cambiamos la ruta por profile: --&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{path(&#39;profile&#39;)}}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-link text-center&quot;</span><span class="p">&gt;</span>
                        <span class="cm">&lt;!-- cambiamos por la variable avatar y username (OJO: para evitar erroes abrá que cargarlo en cada controlador) --&gt;</span>
                            <span class="p">&lt;</span><span class="nt">img</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;avatar rounded img-thumbnail img-fluid&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;{{avatar}}&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;foto&quot;</span> <span class="p">/&gt;</span>
                            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">small</span><span class="p">&gt;</span>{{username}}<span class="p">&lt;/</span><span class="nt">small</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>
        {% endif %}

        {% block body %}{% endblock %}

        <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.min.js&quot;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&quot;sha384-ODmDIVzN+pFdexxHEHFBQH3/9/vQ9uori45z4JjnFsRydbmQbmL5t1tQ0culUzyK&quot;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&quot;anonymous&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;{{asset(&#39;assets/js/base.js&#39;)}}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>A continuación vamos a editar el controlador <strong>UserController.php</strong>:</p></li>
</ul>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Bundle\FrameworkBundle\Controller\AbstractController</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Routing\Annotation\Route</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Doctrine\ORM\EntityManagerInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\PasswordHasher\Hasher\UserPasswordHasherInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Security\Http\Authentication\AuthenticationUtils</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\String\Slugger\SluggerInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\File\Exception\FileException</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\File\UploadedFile</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Entity\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Form\UserType</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">AbstractController</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">login</span><span class="p">(</span><span class="nx">AuthenticationUtils</span> <span class="nv">$authenticationUtils</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nv">$error</span> <span class="o">=</span> <span class="nv">$authenticationUtils</span><span class="o">-&gt;</span><span class="na">getLastAuthenticationError</span><span class="p">();</span>
        <span class="nv">$lastUsername</span> <span class="o">=</span> <span class="nv">$authenticationUtils</span><span class="o">-&gt;</span><span class="na">getLastUsername</span><span class="p">();</span>

        <span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
        <span class="nv">$registrationForm</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">UserType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$user</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;user/login.html.twig&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;registration_form&#39;</span> <span class="o">=&gt;</span> <span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">createView</span><span class="p">(),</span>
            <span class="s1">&#39;last_username&#39;</span> <span class="o">=&gt;</span> <span class="nv">$lastUsername</span><span class="p">,</span>
            <span class="s1">&#39;error&#39;</span> <span class="o">=&gt;</span> <span class="nv">$error</span>
        <span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">logout</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span> <span class="p">{}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">(</span>
        <span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span>
        <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">,</span>
        <span class="nx">UserPasswordHasherInterface</span> <span class="nv">$passwordHasher</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
        <span class="nv">$registrationForm</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">UserType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$user</span><span class="p">);</span>

        <span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">handleRequest</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">isSubmitted</span><span class="p">()){</span>
            <span class="k">if</span><span class="p">(</span><span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">()){</span>
                <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setRoles</span><span class="p">([</span><span class="s1">&#39;ROLE_USER&#39;</span><span class="p">]);</span>
                <span class="nv">$plainPassword</span> <span class="o">=</span> <span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">();</span>
                <span class="nv">$hashedPassword</span> <span class="o">=</span> <span class="nv">$passwordHasher</span><span class="o">-&gt;</span><span class="na">hashPassword</span><span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="nv">$plainPassword</span><span class="p">);</span>
                <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$hashedPassword</span><span class="p">);</span>

                <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
                <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
                <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">profile</span><span class="p">(</span>
        <span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span>
        <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">,</span>
        <span class="nx">UserPasswordHasherInterface</span> <span class="nv">$passwordHasher</span><span class="p">,</span>
        <span class="nx">SluggerInterface</span> <span class="nv">$slugger</span>
    <span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getUser</span><span class="p">();</span>
        <span class="nv">$isAvatar</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getAvatar</span><span class="p">();</span>
        <span class="c1">// cargamos el nombre de usuario:</span>
        <span class="nv">$username</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">();</span>

        <span class="k">if</span><span class="p">(</span><span class="nv">$isAvatar</span><span class="p">){</span>
            <span class="nv">$avatar</span> <span class="o">=</span> <span class="s1">&#39;./uploads/avatars/&#39;</span> <span class="o">.</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getAvatar</span><span class="p">();</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="nv">$avatar</span> <span class="o">=</span> <span class="s1">&#39;./assets/images/avatar.png&#39;</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nv">$oldPassword</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getPassword</span><span class="p">();</span>
        <span class="nv">$userEditForm</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">UserType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$user</span><span class="p">);</span>

        <span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">handleRequest</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>

        <span class="k">if</span><span class="p">(</span><span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">isSubmitted</span><span class="p">()){</span>
            <span class="k">if</span><span class="p">(</span><span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">()){</span>
                <span class="nv">$file</span> <span class="o">=</span> <span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;avatar&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">();</span>
                <span class="k">if</span><span class="p">(</span><span class="nv">$file</span><span class="p">){</span>
                    <span class="nv">$originalFilename</span> <span class="o">=</span> <span class="nb">pathinfo</span><span class="p">(</span><span class="nv">$file</span><span class="o">-&gt;</span><span class="na">getClientOriginalName</span><span class="p">(),</span> <span class="nx">PATHINFO_FILENAME</span><span class="p">);</span>
                    <span class="nv">$safeFilename</span> <span class="o">=</span> <span class="nv">$slugger</span><span class="o">-&gt;</span><span class="na">slug</span><span class="p">(</span><span class="nv">$originalFilename</span><span class="p">);</span>
                    <span class="nv">$newFilename</span> <span class="o">=</span> <span class="nv">$safeFilename</span> <span class="o">.</span> <span class="s1">&#39;-&#39;</span> <span class="o">.</span> <span class="nb">uniqid</span><span class="p">()</span> <span class="o">.</span> <span class="s1">&#39;.&#39;</span> <span class="o">.</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">guessExtension</span><span class="p">();</span>
                    <span class="k">try</span><span class="p">{</span>
                        <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">move</span><span class="p">(</span>
                            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getParameter</span><span class="p">(</span><span class="s1">&#39;avatars&#39;</span><span class="p">),</span>
                            <span class="nv">$newFilename</span>
                        <span class="p">);</span>
                    <span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">FileException</span> <span class="nv">$e</span><span class="p">){</span>
                        <span class="c1">// ignoramos el error y seguimos adelante</span>
                    <span class="p">}</span>

                    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setAvatar</span><span class="p">(</span><span class="nv">$newFilename</span><span class="p">);</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setAvatar</span><span class="p">(</span><span class="nv">$isAvatar</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="nv">$plainPassword</span> <span class="o">=</span> <span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">();</span>
                <span class="k">if</span><span class="p">(</span><span class="nv">$plainPassword</span><span class="p">){</span>
                    <span class="nv">$hashedPassword</span> <span class="o">=</span> <span class="nv">$passwordHasher</span><span class="o">-&gt;</span><span class="na">hashPassword</span><span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="nv">$plainPassword</span><span class="p">);</span>
                    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$hashedPassword</span><span class="p">);</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$oldPassword</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
                <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;user/profile.html.twig&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;user_edit_form&#39;</span> <span class="o">=&gt;</span> <span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">createView</span><span class="p">(),</span>
            <span class="s1">&#39;avatar&#39;</span> <span class="o">=&gt;</span> <span class="nv">$avatar</span><span class="p">,</span> <span class="c1">// ya estamos cargando el avatar</span>
            <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="nv">$username</span> <span class="c1">// cargamos el username</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Finalmente editamos <strong>TaskController.php</strong>:</p></li>
</ul>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Bundle\FrameworkBundle\Controller\AbstractController</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Routing\Annotation\Route</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Doctrine\ORM\EntityManagerInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Entity\Task</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Entity\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Form\TaskType</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">TaskController</span> <span class="k">extends</span> <span class="nx">AbstractController</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getUser</span><span class="p">();</span>
        <span class="c1">// cargamos el avatar:</span>
        <span class="nv">$isAvatar</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getAvatar</span><span class="p">();</span>
        <span class="c1">// cargamos el nombre de usuario:</span>
        <span class="nv">$username</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">();</span>

        <span class="c1">// comprobamos también si hay avatar o no:</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$isAvatar</span><span class="p">){</span>
            <span class="nv">$avatar</span> <span class="o">=</span> <span class="s1">&#39;./uploads/avatars/&#39;</span> <span class="o">.</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getAvatar</span><span class="p">();</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="nv">$avatar</span> <span class="o">=</span> <span class="s1">&#39;./assets/images/avatar.png&#39;</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nv">$tasks</span> <span class="o">=</span> <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="nx">Task</span><span class="o">::</span><span class="na">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">findBy</span><span class="p">([</span><span class="s1">&#39;owner&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="p">]);</span>
        <span class="nv">$task</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Task</span><span class="p">();</span>
        <span class="nv">$form</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">TaskType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$task</span><span class="p">);</span>
        <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">handleRequest</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>

        <span class="k">if</span><span class="p">(</span><span class="nv">$form</span><span class="o">-&gt;</span><span class="na">isSubmitted</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">()){</span>
            <span class="nv">$task</span><span class="o">-&gt;</span><span class="na">setDateCreated</span><span class="p">(</span><span class="k">new</span> <span class="nx">\DateTime</span><span class="p">())</span>
                <span class="o">-&gt;</span><span class="na">setIsComplete</span><span class="p">(</span><span class="k">false</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">setOwner</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
            <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$task</span><span class="p">);</span>
            <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;task/index.html.twig&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;tasks&#39;</span> <span class="o">=&gt;</span> <span class="nv">$tasks</span><span class="p">,</span>
            <span class="s1">&#39;taskForm&#39;</span> <span class="o">=&gt;</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">createView</span><span class="p">(),</span>
            <span class="s1">&#39;taskEditForm&#39;</span> <span class="o">=&gt;</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">createView</span><span class="p">(),</span>
            <span class="c1">// cargamos para la plantilla los elementos:</span>
            <span class="s1">&#39;avatar&#39;</span> <span class="o">=&gt;</span> <span class="nv">$avatar</span><span class="p">,</span>
            <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="nv">$username</span>
        <span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">finish</span><span class="p">(</span><span class="nv">$id</span><span class="p">,</span> <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getUser</span><span class="p">();</span>
        <span class="nv">$task</span> <span class="o">=</span> <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="nx">Task</span><span class="o">::</span><span class="na">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">findOneBy</span><span class="p">([</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$id</span><span class="p">,</span> <span class="s1">&#39;owner&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="p">]);</span>

        <span class="k">if</span><span class="p">(</span><span class="nv">$task</span><span class="p">){</span>
            <span class="nv">$task</span><span class="o">-&gt;</span><span class="na">setIsComplete</span><span class="p">(</span><span class="k">true</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">setDateFinish</span><span class="p">(</span><span class="k">new</span> <span class="nx">\DateTime</span><span class="p">());</span>

            <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$task</span><span class="p">);</span>
            <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">delete</span><span class="p">(</span><span class="nv">$id</span><span class="p">,</span> <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getUser</span><span class="p">();</span>
        <span class="nv">$task</span> <span class="o">=</span> <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="nx">Task</span><span class="o">::</span><span class="na">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">findOneBy</span><span class="p">([</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$id</span><span class="p">,</span> <span class="s1">&#39;owner&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="p">]);</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$task</span><span class="p">){</span>
            <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">remove</span><span class="p">(</span><span class="nv">$task</span><span class="p">);</span>
            <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nv">$id</span><span class="p">,</span> <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">,</span> <span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getUser</span><span class="p">();</span>
        <span class="nv">$task</span> <span class="o">=</span> <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="nx">Task</span><span class="o">::</span><span class="na">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">findOneBy</span><span class="p">([</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$id</span><span class="p">,</span> <span class="s1">&#39;owner&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="p">]);</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$task</span><span class="p">){</span>
            <span class="nx">dump</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">));</span>
            <span class="nv">$form</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">TaskType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$task</span><span class="p">);</span>
            <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">handleRequest</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="nv">$form</span><span class="o">-&gt;</span><span class="na">isSubmitted</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">()){</span>
                <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">);</span>

    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="paso-11-securizar-rutas">
<h3><a class="toc-backref" href="#id27">Paso 11: Securizar Rutas</a><a class="headerlink" href="#paso-11-securizar-rutas" title="Enlazar permanentemente con este título">¶</a></h3>
<ul class="simple">
<li><p>Para securizar rutas añadimos al <strong>access_control</strong> la ruta en <strong>security.yaml</strong>:</p></li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">security</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="c1"># https://symfony.com/doc/current/security.html#registering-the-user-hashing-passwords</span><span class="w"></span>
<span class="w">    </span><span class="nt">password_hashers</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">Symfony\Component\Security\Core\User\PasswordAuthenticatedUserInterface</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;auto&#39;</span><span class="w"></span>
<span class="w">    </span><span class="c1"># https://symfony.com/doc/current/security.html#loading-the-user-the-user-provider</span><span class="w"></span>
<span class="w">    </span><span class="nt">providers</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="c1"># used to reload user from session &amp; other features (e.g. switch_user)</span><span class="w"></span>
<span class="w">        </span><span class="nt">app_user_provider</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="nt">entity</span><span class="p">:</span><span class="w"></span>
<span class="w">                </span><span class="nt">class</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Entity\User</span><span class="w"></span>
<span class="w">                </span><span class="nt">property</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">email</span><span class="w"></span>
<span class="w">    </span><span class="nt">firewalls</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">dev</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^/(_(profiler|wdt)|css|images|js)/</span><span class="w"></span>
<span class="w">            </span><span class="nt">security</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w"></span>
<span class="w">        </span><span class="nt">main</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="nt">lazy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">            </span><span class="nt">provider</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app_user_provider</span><span class="w"></span>
<span class="w">            </span><span class="nt">form_login</span><span class="p">:</span><span class="w"></span>
<span class="w">                </span><span class="nt">login_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">login</span><span class="w"></span>
<span class="w">                </span><span class="nt">check_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">login</span><span class="w"></span>
<span class="w">            </span><span class="nt">logout</span><span class="p">:</span><span class="w"></span>
<span class="w">                </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">logout</span><span class="w"></span>

<span class="w">            </span><span class="c1"># activate different ways to authenticate</span><span class="w"></span>
<span class="w">            </span><span class="c1"># https://symfony.com/doc/current/security.html#the-firewall</span><span class="w"></span>

<span class="w">            </span><span class="c1"># https://symfony.com/doc/current/security/impersonating_user.html</span><span class="w"></span>
<span class="w">            </span><span class="c1"># switch_user: true</span><span class="w"></span>

<span class="w">    </span><span class="c1"># Easy way to control access for large sections of your site</span><span class="w"></span>
<span class="w">    </span><span class="c1"># Note: Only the *first* access control that matches will be used</span><span class="w"></span>
<span class="w">    </span><span class="nt">access_control</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="c1"># - { path: ^/admin, roles: ROLE_ADMIN }</span><span class="w"></span>
<span class="w">        </span><span class="c1"># - { path: ^/profile, roles: ROLE_USER }</span><span class="w"></span>
<span class="w">        </span><span class="c1"># añadimos aquí la ruta raiz y la del usuario:</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> path</span><span class="p">:</span><span class="w"> </span><span class="nv">^/$</span><span class="p p-Indicator">,</span><span class="nt"> roles</span><span class="p">:</span><span class="w"> </span><span class="nv">ROLE_USER</span><span class="w"> </span><span class="p p-Indicator">}</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> path</span><span class="p">:</span><span class="w"> </span><span class="nv">^/user</span><span class="p p-Indicator">,</span><span class="nt"> roles</span><span class="p">:</span><span class="w"> </span><span class="nv">ROLE_USER</span><span class="w"> </span><span class="p p-Indicator">}</span><span class="w"></span>

<span class="nt">when@test</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">security</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">password_hashers</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="c1"># By default, password hashers are resource intensive and take time. This is</span><span class="w"></span>
<span class="w">            </span><span class="c1"># important to generate secure password hashes. In tests however, secure hashes</span><span class="w"></span>
<span class="w">            </span><span class="c1"># are not important, waste resources and increase test times. The following</span><span class="w"></span>
<span class="w">            </span><span class="c1"># reduces the work factor to the lowest possible values.</span><span class="w"></span>
<span class="w">            </span><span class="nt">Symfony\Component\Security\Core\User\PasswordAuthenticatedUserInterface</span><span class="p">:</span><span class="w"></span>
<span class="w">                </span><span class="nt">algorithm</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">auto</span><span class="w"></span>
<span class="w">                </span><span class="nt">cost</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span><span class="w"> </span><span class="c1"># Lowest possible value for bcrypt</span><span class="w"></span>
<span class="w">                </span><span class="nt">time_cost</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class="w"> </span><span class="c1"># Lowest possible value for argon</span><span class="w"></span>
<span class="w">                </span><span class="nt">memory_cost</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span><span class="w"> </span><span class="c1"># Lowest possible value for argon</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><p>Con esto ya solo podemos acceder iniciando sesión. Prueba a hacer logout e intenta acceder y te debe redirigir a la ruta login.</p></li>
</ul>
</section>
<section id="paso-12-recuperar-contrasena-email">
<h3><a class="toc-backref" href="#id28">Paso 12: Recuperar contraseña (email)</a><a class="headerlink" href="#paso-12-recuperar-contrasena-email" title="Enlazar permanentemente con este título">¶</a></h3>
<ul class="simple">
<li><p>Lo primero que tenemos que hacer es registrarnos en <a class="reference external" href="https://mailtrap.io/">https://mailtrap.io/</a></p></li>
<li><p>En mailtrap, elegimos en el apartado __Integrations__ Symfony 5+ y copiamos la linea que nos muestra de __MAILER_DSN__</p></li>
<li><p>Editamos el archivo .env y añadimos la información del servidor de correo:</p></li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># In all environments, the following files are loaded if they exist,</span><span class="w"></span>
<span class="c1"># the latter taking precedence over the former:</span><span class="w"></span>
<span class="c1">#</span><span class="w"></span>
<span class="c1">#  * .env                contains default values for the environment variables needed by the app</span><span class="w"></span>
<span class="c1">#  * .env.local          uncommitted file with local overrides</span><span class="w"></span>
<span class="c1">#  * .env.$APP_ENV       committed environment-specific defaults</span><span class="w"></span>
<span class="c1">#  * .env.$APP_ENV.local uncommitted environment-specific overrides</span><span class="w"></span>
<span class="c1">#</span><span class="w"></span>
<span class="c1"># Real environment variables win over .env files.</span><span class="w"></span>
<span class="c1">#</span><span class="w"></span>
<span class="c1"># DO NOT DEFINE PRODUCTION SECRETS IN THIS FILE NOR IN ANY OTHER COMMITTED FILES.</span><span class="w"></span>
<span class="c1"># https://symfony.com/doc/current/configuration/secrets.html</span><span class="w"></span>
<span class="c1">#</span><span class="w"></span>
<span class="c1"># Run &quot;composer dump-env prod&quot; to compile .env files for production use (requires symfony/flex &gt;=1.2).</span><span class="w"></span>
<span class="c1"># https://symfony.com/doc/current/best_practices.html#use-environment-variables-for-infrastructure-configuration</span><span class="w"></span>

<span class="c1">###&gt; symfony/webapp-pack ###</span><span class="w"></span>
<span class="l l-Scalar l-Scalar-Plain">MESSENGER_TRANSPORT_DSN=doctrine://default?auto_setup=0</span><span class="w"></span>
<span class="l l-Scalar l-Scalar-Plain">###&lt; symfony/webapp-pack</span><span class="w"> </span><span class="c1">###</span><span class="w"></span>

<span class="c1">###&gt; symfony/framework-bundle ###</span><span class="w"></span>
<span class="l l-Scalar l-Scalar-Plain">APP_ENV=dev</span><span class="w"></span>
<span class="l l-Scalar l-Scalar-Plain">APP_SECRET=0c15b00ac6370aa12e08a36e4c4e5ef7</span><span class="w"></span>
<span class="l l-Scalar l-Scalar-Plain">###&lt; symfony/framework-bundle</span><span class="w"> </span><span class="c1">###</span><span class="w"></span>

<span class="c1">###&gt; doctrine/doctrine-bundle ###</span><span class="w"></span>
<span class="c1"># Format described at https://www.doctrine-project.org/projects/doctrine-dbal/en/latest/reference/configuration.html#connecting-using-a-url</span><span class="w"></span>
<span class="c1"># IMPORTANT: You MUST configure your server version, either here or in config/packages/doctrine.yaml</span><span class="w"></span>
<span class="c1">#</span><span class="w"></span>
<span class="c1"># DATABASE_URL=&quot;sqlite:///%kernel.project_dir%/var/data.db&quot;</span><span class="w"></span>
<span class="l l-Scalar l-Scalar-Plain">DATABASE_URL=&quot;mysql://root:@127.0.0.1:3306/symfony_task_learn?serverVersion=8&amp;charset=utf8mb4&quot;</span><span class="w"></span>
<span class="l l-Scalar l-Scalar-Plain"># DATABASE_URL=&quot;postgresql://app:!ChangeMe!@127.0.0.1:5432/app?serverVersion=14&amp;charset=utf8&quot;</span><span class="w"></span>
<span class="l l-Scalar l-Scalar-Plain">###&lt; doctrine/doctrine-bundle</span><span class="w"> </span><span class="c1">###</span><span class="w"></span>

<span class="c1">###&gt; symfony/messenger ###</span><span class="w"></span>
<span class="c1"># Choose one of the transports below</span><span class="w"></span>
<span class="c1"># MESSENGER_TRANSPORT_DSN=doctrine://default</span><span class="w"></span>
<span class="c1"># MESSENGER_TRANSPORT_DSN=amqp://guest:guest@localhost:5672/%2f/messages</span><span class="w"></span>
<span class="c1"># MESSENGER_TRANSPORT_DSN=redis://localhost:6379/messages</span><span class="w"></span>
<span class="c1">###&lt; symfony/messenger ###</span><span class="w"></span>

<span class="c1">###&gt; symfony/mailer ###</span><span class="w"></span>
<span class="l l-Scalar l-Scalar-Plain">MAILER_DSN=smtp://6c40b3252c8798:53a66737d4ef3f@smtp.mailtrap.io:2525?encryption=tls&amp;auth_mode=login</span><span class="w"></span>
<span class="l l-Scalar l-Scalar-Plain">###&lt; symfony/mailer</span><span class="w"> </span><span class="c1">###</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><p>nos vamos a la carpeta <strong>config/packages</strong> y editamos <strong>messenger.yaml</strong>:</p></li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">framework</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">messenger</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">failure_transport</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">failed</span><span class="w"></span>

<span class="w">        </span><span class="nt">transports</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="c1"># https://symfony.com/doc/current/messenger.html#transport-configuration</span><span class="w"></span>
<span class="w">            </span><span class="nt">async</span><span class="p">:</span><span class="w"></span>
<span class="w">                </span><span class="nt">dsn</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;%env(MESSENGER_TRANSPORT_DSN)%&#39;</span><span class="w"></span>
<span class="w">                </span><span class="nt">options</span><span class="p">:</span><span class="w"></span>
<span class="w">                    </span><span class="nt">use_notify</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">                    </span><span class="nt">check_delayed_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">60000</span><span class="w"></span>
<span class="w">                </span><span class="nt">retry_strategy</span><span class="p">:</span><span class="w"></span>
<span class="w">                    </span><span class="nt">max_retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class="w"></span>
<span class="w">                    </span><span class="nt">multiplier</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w"></span>
<span class="w">            </span><span class="nt">failed</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;doctrine://default?queue_name=failed&#39;</span><span class="w"></span>
<span class="w">            </span><span class="c1"># sync: &#39;sync://&#39;</span><span class="w"></span>

<span class="w">        </span><span class="nt">routing</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="c1"># Comentamos esta línea ya que da problemas en la versión 6:</span><span class="w"></span>
<span class="w">            </span><span class="c1"># Symfony\Component\Mailer\Messenger\SendEmailMessage: async</span><span class="w"></span>
<span class="w">            </span><span class="nt">Symfony\Component\Notifier\Message\ChatMessage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">async</span><span class="w"></span>
<span class="w">            </span><span class="nt">Symfony\Component\Notifier\Message\SmsMessage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">async</span><span class="w"></span>

<span class="w">            </span><span class="c1"># Route your messages to the transports</span><span class="w"></span>
<span class="w">            </span><span class="c1"># &#39;App\Message\YourMessage&#39;: async</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><p>Vamos a añadir unas claves a <strong>.env</strong>:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># In all environments, the following files are loaded if they exist,
# the latter taking precedence over the former:
#
#  * .env                contains default values for the environment variables needed by the app
#  * .env.local          uncommitted file with local overrides
#  * .env.$APP_ENV       committed environment-specific defaults
#  * .env.$APP_ENV.local uncommitted environment-specific overrides
#
# Real environment variables win over .env files.
#
# DO NOT DEFINE PRODUCTION SECRETS IN THIS FILE NOR IN ANY OTHER COMMITTED FILES.
# https://symfony.com/doc/current/configuration/secrets.html
#
# Run &quot;composer dump-env prod&quot; to compile .env files for production use (requires symfony/flex &gt;=1.2).
# https://symfony.com/doc/current/best_practices.html#use-environment-variables-for-infrastructure-configuration

###&gt; symfony/webapp-pack ###
MESSENGER_TRANSPORT_DSN=doctrine://default?auto_setup=0
###&lt; symfony/webapp-pack ###

###&gt; symfony/framework-bundle ###
APP_ENV=dev
APP_SECRET=0c15b00ac6370aa12e08a36e4c4e5ef7
###&lt; symfony/framework-bundle ###

###&gt; doctrine/doctrine-bundle ###
# Format described at https://www.doctrine-project.org/projects/doctrine-dbal/en/latest/reference/configuration.html#connecting-using-a-url
# IMPORTANT: You MUST configure your server version, either here or in config/packages/doctrine.yaml
#
# DATABASE_URL=&quot;sqlite:///%kernel.project_dir%/var/data.db&quot;
DATABASE_URL=&quot;mysql://root:@127.0.0.1:3306/symfony_task_learn?serverVersion=8&amp;charset=utf8mb4&quot;
# DATABASE_URL=&quot;postgresql://app:!ChangeMe!@127.0.0.1:5432/app?serverVersion=14&amp;charset=utf8&quot;
###&lt; doctrine/doctrine-bundle ###

###&gt; symfony/messenger ###
# Choose one of the transports below
# MESSENGER_TRANSPORT_DSN=doctrine://default
# MESSENGER_TRANSPORT_DSN=amqp://guest:guest@localhost:5672/%2f/messages
# MESSENGER_TRANSPORT_DSN=redis://localhost:6379/messages
###&lt; symfony/messenger ###

###&gt; symfony/mailer ###
MAILER_DSN=smtp://6c40b325c9a698:53a66737d4e53f@smtp.mailtrap.io:2525?encryption=tls&amp;auth_mode=login
###&lt; symfony/mailer ###

# Declaramos el método y las dos claves secretas que queramos:
HASH_METHOD=&quot;AES-256-CBC&quot;
START_KEY=&quot;fv83729&quot;
END_KEY=&quot;89s67s&quot;
</pre></div>
</div>
<ul class="simple">
<li><p>Ahora vamos a editar el controlador <strong>UserController.php</strong>:</p></li>
</ul>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Bundle\FrameworkBundle\Controller\AbstractController</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Routing\Annotation\Route</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Doctrine\ORM\EntityManagerInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\PasswordHasher\Hasher\UserPasswordHasherInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Security\Http\Authentication\AuthenticationUtils</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\String\Slugger\SluggerInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\File\Exception\FileException</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\File\UploadedFile</span><span class="p">;</span>
<span class="c1">// cargamos el componente mailerinterface:</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Mailer\MailerInterface</span><span class="p">;</span>
<span class="c1">// cargamos también el mime email</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Mime\Email</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Entity\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Form\UserType</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">AbstractController</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">login</span><span class="p">(</span><span class="nx">AuthenticationUtils</span> <span class="nv">$authenticationUtils</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nv">$error</span> <span class="o">=</span> <span class="nv">$authenticationUtils</span><span class="o">-&gt;</span><span class="na">getLastAuthenticationError</span><span class="p">();</span>
        <span class="nv">$lastUsername</span> <span class="o">=</span> <span class="nv">$authenticationUtils</span><span class="o">-&gt;</span><span class="na">getLastUsername</span><span class="p">();</span>

        <span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
        <span class="nv">$registrationForm</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">UserType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$user</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;user/login.html.twig&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;registration_form&#39;</span> <span class="o">=&gt;</span> <span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">createView</span><span class="p">(),</span>
            <span class="s1">&#39;last_username&#39;</span> <span class="o">=&gt;</span> <span class="nv">$lastUsername</span><span class="p">,</span>
            <span class="s1">&#39;error&#39;</span> <span class="o">=&gt;</span> <span class="nv">$error</span>
        <span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">logout</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span> <span class="p">{}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">(</span>
        <span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span>
        <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">,</span>
        <span class="nx">UserPasswordHasherInterface</span> <span class="nv">$passwordHasher</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
        <span class="nv">$registrationForm</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">UserType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$user</span><span class="p">);</span>

        <span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">handleRequest</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">isSubmitted</span><span class="p">()){</span>
            <span class="k">if</span><span class="p">(</span><span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">()){</span>
                <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setRoles</span><span class="p">([</span><span class="s1">&#39;ROLE_USER&#39;</span><span class="p">]);</span>
                <span class="nv">$plainPassword</span> <span class="o">=</span> <span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">();</span>
                <span class="nv">$hashedPassword</span> <span class="o">=</span> <span class="nv">$passwordHasher</span><span class="o">-&gt;</span><span class="na">hashPassword</span><span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="nv">$plainPassword</span><span class="p">);</span>
                <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$hashedPassword</span><span class="p">);</span>

                <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
                <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
                <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">profile</span><span class="p">(</span>
        <span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span>
        <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">,</span>
        <span class="nx">UserPasswordHasherInterface</span> <span class="nv">$passwordHasher</span><span class="p">,</span>
        <span class="nx">SluggerInterface</span> <span class="nv">$slugger</span>
    <span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getUser</span><span class="p">();</span>
        <span class="nv">$isAvatar</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getAvatar</span><span class="p">();</span>
        <span class="nv">$username</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">();</span>

        <span class="k">if</span><span class="p">(</span><span class="nv">$isAvatar</span><span class="p">){</span>
            <span class="nv">$avatar</span> <span class="o">=</span> <span class="s1">&#39;./uploads/avatars/&#39;</span> <span class="o">.</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getAvatar</span><span class="p">();</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="nv">$avatar</span> <span class="o">=</span> <span class="s1">&#39;./assets/images/avatar.png&#39;</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nv">$oldPassword</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getPassword</span><span class="p">();</span>
        <span class="nv">$userEditForm</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">UserType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$user</span><span class="p">);</span>

        <span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">handleRequest</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>

        <span class="k">if</span><span class="p">(</span><span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">isSubmitted</span><span class="p">()){</span>
            <span class="k">if</span><span class="p">(</span><span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">()){</span>
                <span class="nv">$file</span> <span class="o">=</span> <span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;avatar&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">();</span>
                <span class="k">if</span><span class="p">(</span><span class="nv">$file</span><span class="p">){</span>
                    <span class="nv">$originalFilename</span> <span class="o">=</span> <span class="nb">pathinfo</span><span class="p">(</span><span class="nv">$file</span><span class="o">-&gt;</span><span class="na">getClientOriginalName</span><span class="p">(),</span> <span class="nx">PATHINFO_FILENAME</span><span class="p">);</span>
                    <span class="nv">$safeFilename</span> <span class="o">=</span> <span class="nv">$slugger</span><span class="o">-&gt;</span><span class="na">slug</span><span class="p">(</span><span class="nv">$originalFilename</span><span class="p">);</span>
                    <span class="nv">$newFilename</span> <span class="o">=</span> <span class="nv">$safeFilename</span> <span class="o">.</span> <span class="s1">&#39;-&#39;</span> <span class="o">.</span> <span class="nb">uniqid</span><span class="p">()</span> <span class="o">.</span> <span class="s1">&#39;.&#39;</span> <span class="o">.</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">guessExtension</span><span class="p">();</span>
                    <span class="k">try</span><span class="p">{</span>
                        <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">move</span><span class="p">(</span>
                            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getParameter</span><span class="p">(</span><span class="s1">&#39;avatars&#39;</span><span class="p">),</span>
                            <span class="nv">$newFilename</span>
                        <span class="p">);</span>
                    <span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">FileException</span> <span class="nv">$e</span><span class="p">){</span>
                        <span class="c1">// ignoramos el error y seguimos adelante</span>
                    <span class="p">}</span>

                    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setAvatar</span><span class="p">(</span><span class="nv">$newFilename</span><span class="p">);</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setAvatar</span><span class="p">(</span><span class="nv">$isAvatar</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="nv">$plainPassword</span> <span class="o">=</span> <span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">();</span>
                <span class="k">if</span><span class="p">(</span><span class="nv">$plainPassword</span><span class="p">){</span>
                    <span class="nv">$hashedPassword</span> <span class="o">=</span> <span class="nv">$passwordHasher</span><span class="o">-&gt;</span><span class="na">hashPassword</span><span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="nv">$plainPassword</span><span class="p">);</span>
                    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$hashedPassword</span><span class="p">);</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$oldPassword</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
                <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;user/profile.html.twig&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;user_edit_form&#39;</span> <span class="o">=&gt;</span> <span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">createView</span><span class="p">(),</span>
            <span class="s1">&#39;avatar&#39;</span> <span class="o">=&gt;</span> <span class="nv">$avatar</span><span class="p">,</span>
            <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="nv">$username</span>
        <span class="p">]);</span>
    <span class="p">}</span>

    <span class="c1">// Creamos un controlador nuevo y le pasamos la interfaz de mailer:</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">send_reset_email</span><span class="p">(</span>
        <span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span>
        <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">,</span>
        <span class="nx">MailerInterface</span> <span class="nv">$mailer</span><span class="p">){</span>
        <span class="c1">// recuperamos el email de la request:</span>
        <span class="nv">$email</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;reset_email&#39;</span><span class="p">);</span>
        <span class="c1">// recuperamos el usuario de la base de datos:</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="na">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">findOneBy</span><span class="p">([</span><span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="nv">$email</span><span class="p">]);</span>
        <span class="c1">// si existe el usuario enviaremos el email:</span>

        <span class="k">if</span><span class="p">(</span><span class="nv">$user</span><span class="p">){</span>

            <span class="c1">// codificamos el id del usuario:</span>
            <span class="nv">$prefix</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;sha256&#39;</span><span class="p">,</span> <span class="nv">$_ENV</span><span class="p">[</span><span class="s1">&#39;START_KEY&#39;</span><span class="p">]);</span>
            <span class="nv">$sufix</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;sha256&#39;</span><span class="p">,</span> <span class="nv">$_ENV</span><span class="p">[</span><span class="s1">&#39;END_KEY&#39;</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
            <span class="nv">$hashId</span> <span class="o">=</span> <span class="nb">openssl_encrypt</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getId</span><span class="p">(),</span> <span class="nv">$_ENV</span><span class="p">[</span><span class="s1">&#39;HASH_METHOD&#39;</span><span class="p">],</span> <span class="nv">$prefix</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$sufix</span><span class="p">);</span>

            <span class="c1">// creamos una ruta con el id del usuario en un md5:</span>
            <span class="nv">$urlSource</span> <span class="o">=</span> <span class="s2">&quot;http://localhost:5000/reset_password/&quot;</span> <span class="o">.</span> <span class="nb">md5</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getId</span><span class="p">());</span>
            <span class="k">echo</span> <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$urlSource</span><span class="p">);</span>
            <span class="c1">// Construimos el email:</span>
            <span class="nv">$emailToSend</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Email</span><span class="p">())</span>
                            <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;pytonicus@gmail.com&#39;</span><span class="p">)</span>
                            <span class="o">-&gt;</span><span class="na">to</span><span class="p">(</span><span class="nv">$email</span><span class="p">)</span>
                            <span class="o">-&gt;</span><span class="na">subject</span><span class="p">(</span><span class="s1">&#39;ASUNTO: Recuperar contraseña&#39;</span><span class="p">)</span>
                            <span class="o">-&gt;</span><span class="na">text</span><span class="p">(</span><span class="s1">&#39;reestablecer contraseña&#39;</span><span class="p">)</span>
                            <span class="o">-&gt;</span><span class="na">html</span><span class="p">(</span><span class="s1">&#39;&lt;a href=&quot;&#39;</span> <span class="o">.</span> <span class="nv">$urlSource</span> <span class="o">.</span> <span class="s1">&#39;&quot;&gt;&#39;</span> <span class="o">.</span> <span class="nv">$urlSource</span> <span class="o">.</span> <span class="s1">&#39;&lt;/a&gt;&#39;</span><span class="p">);</span>
            <span class="c1">// enviamos el email:</span>
            <span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="nv">$emailToSend</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">);</span>
        <span class="cm">/* Este código lo usamos para depurar el correo:</span>
<span class="cm">        return new Response(</span>
<span class="cm">            &#39;&lt;html&gt;&lt;body&gt;TESTING DE EMAIL&lt;/body&gt;&lt;/html&gt;&#39;</span>
<span class="cm">        ); */</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Editamos el template <strong>login.html.twig</strong>:</p></li>
</ul>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>{% extends &#39;base.html.twig&#39; %}

{% block title %}Hello UserController!{% endblock %}

{% block body %}

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;bodystyle text-center&quot;</span> <span class="na">cz-shortcut-listen</span><span class="o">=</span><span class="s">&quot;true&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-signin text-center&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Por favor inicia sesión<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{{ path(&#39;login&#39;)}}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-floating&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;email&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;username&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;_username&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;{{last_username}}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-control&quot;</span> <span class="p">/&gt;</span>
                <span class="p">&lt;</span><span class="nt">label</span> <span class="na">htmlFor</span><span class="o">=</span><span class="s">&quot;floatingInput&quot;</span><span class="p">&gt;</span>Email<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-floating&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;_password&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-control&quot;</span> <span class="p">/&gt;</span>
                <span class="p">&lt;</span><span class="nt">label</span> <span class="na">htmlFor</span><span class="o">=</span><span class="s">&quot;floatingPassword&quot;</span><span class="p">&gt;</span>Contraseña<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mb-3&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;button&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;cursor&quot;</span> <span class="na">data-bs-toggle</span><span class="o">=</span><span class="s">&quot;modal&quot;</span> <span class="na">data-bs-target</span><span class="o">=</span><span class="s">&quot;#registerUser&quot;</span>  <span class="na">data-bs-toggle</span><span class="o">=</span><span class="s">&quot;modal&quot;</span> <span class="na">data-bs-target</span><span class="o">=</span><span class="s">&quot;#registerUser&quot;</span><span class="p">&gt;</span>Crear usuario<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mb-3&quot;</span><span class="p">&gt;</span>
            <span class="cm">&lt;!-- actualizamos el botón para desplegar el modal si ha olvidado contraseña --&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;button&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;cursor&quot;</span> <span class="na">data-bs-toggle</span><span class="o">=</span><span class="s">&quot;modal&quot;</span> <span class="na">data-bs-target</span><span class="o">=</span><span class="s">&quot;#resetPassword&quot;</span>  <span class="na">data-bs-toggle</span><span class="o">=</span><span class="s">&quot;modal&quot;</span> <span class="na">data-bs-target</span><span class="o">=</span><span class="s">&quot;#resetPassword&quot;</span><span class="p">&gt;</span>¿has olvidado la contraseña?<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-100 btn btn-lg btn-primary&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Iniciar sesión<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal fade&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;registerUser&quot;</span> <span class="na">tabIndex</span><span class="o">=</span><span class="s">&quot;-1&quot;</span> <span class="na">aria-labelledby</span><span class="o">=</span><span class="s">&quot;exampleModalLabel&quot;</span> <span class="na">aria-hidden</span><span class="o">=</span><span class="s">&quot;true&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-dialog&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-content&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-header&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">h5</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-title&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;exampleModalLabel&quot;</span><span class="p">&gt;</span>Registro<span class="p">&lt;/</span><span class="nt">h5</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;button&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn-close&quot;</span> <span class="na">data-bs-dismiss</span><span class="o">=</span><span class="s">&quot;modal&quot;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&quot;Close&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-body&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container&quot;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">form</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;userForm&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{{path(&#39;register&#39;)}}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">role</span><span class="o">=</span><span class="s">&quot;form&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container&quot;</span><span class="p">&gt;</span>
                                {{ form_row(registration_form._token) }}

                                {{ form_label(registration_form.email, &#39;email&#39;, {&#39;label_attr&#39;: {&#39;style&#39;: &#39;display:none&#39;}}) }}
                                {{ form_widget(registration_form.email, {&#39;attr&#39;: {&#39;class&#39;: &#39;form-control mt-3&#39;, &#39;placeholder&#39;:&#39;Email&#39;}}) }}
                                {{ form_errors(registration_form.email) }}

                                {{ form_label(registration_form.password, &#39;password&#39;, {&#39;label_attr&#39;: {&#39;style&#39;: &#39;display:none&#39;}}) }}
                                {{ form_widget(registration_form.password, {&#39;attr&#39;:{&#39;class&#39;: &#39;form-control mt-3&#39;, &#39;placeholder&#39;: &#39;Contraseña&#39;, &#39;type&#39;:&#39;password&#39;}}) }}
                                {{ form_errors(registration_form.password, {&#39;attr&#39;: {&#39;class&#39;: &#39;col-md-3&#39;}}) }}

                                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-success form-control mt-3&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Darse de alta&quot;</span> <span class="p">/&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- modal para recuperar contraseña --&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal fade&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;resetPassword&quot;</span> <span class="na">tabIndex</span><span class="o">=</span><span class="s">&quot;-1&quot;</span> <span class="na">aria-labelledby</span><span class="o">=</span><span class="s">&quot;exampleModalLabel&quot;</span> <span class="na">aria-hidden</span><span class="o">=</span><span class="s">&quot;true&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-dialog&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-content&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-header&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">h5</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-title&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;exampleModalLabel&quot;</span><span class="p">&gt;</span>Resetear contraseña<span class="p">&lt;/</span><span class="nt">h5</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;button&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn-close&quot;</span> <span class="na">data-bs-dismiss</span><span class="o">=</span><span class="s">&quot;modal&quot;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&quot;Close&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-body&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col text-center&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{{path(&#39;send_reset_email&#39;)}}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">role</span><span class="o">=</span><span class="s">&quot;form&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;email&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;reset_email&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-control mt-3&quot;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Email&quot;</span> <span class="p">/&gt;</span>
                        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span>  <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-success form-control mt-3&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Enviar email&quot;</span> <span class="na">data-bs-dismiss</span><span class="o">=</span><span class="s">&quot;modal&quot;</span> <span class="p">/&gt;</span>
                        <span class="p">&lt;</span><span class="nt">small</span><span class="p">&gt;</span>Recibirás un email que te llevará donde resetear tu contraseña<span class="p">&lt;/</span><span class="nt">small</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

{% endblock %}
</pre></div>
</div>
<ul class="simple">
<li><p>Y finalmente las rutas <strong>routes.yaml</strong>:</p></li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">index</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\TaskController::index</span><span class="w"></span>

<span class="nt">finish</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tasks/finish/{id}</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\TaskController::finish</span><span class="w"></span>

<span class="nt">delete</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tasks/delete/{id}</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\TaskController::delete</span><span class="w"></span>

<span class="nt">update</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tasks/update/{id}</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\TaskController::update</span><span class="w"></span>

<span class="nt">login</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/login</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\UserController::login</span><span class="w"></span>

<span class="nt">logout</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/logout</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\UserController::logout</span><span class="w"></span>

<span class="nt">register</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/register</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\UserController::register</span><span class="w"></span>

<span class="nt">profile</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/profile</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\UserController::profile</span><span class="w"></span>

<span class="c1"># creamos una ruta para resetear contraseña:</span><span class="w"></span>
<span class="nt">send_reset_email</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/send_reset_email</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\UserController::send_reset_email</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><p>Este correo nos manda un enlace para restaurar contraseña que crearemos en el siguiente paso</p></li>
</ul>
</section>
<section id="paso-13-recuperar-contrasena-pagina-de-recuperacion">
<h3><a class="toc-backref" href="#id29">Paso 13: Recuperar contraseña (pagina de recuperación)</a><a class="headerlink" href="#paso-13-recuperar-contrasena-pagina-de-recuperacion" title="Enlazar permanentemente con este título">¶</a></h3>
<ul class="simple">
<li><p>Crear un nuevo formulario: <code class="docutils literal notranslate"><span class="pre">php</span> <span class="pre">bin/console</span> <span class="pre">make:form</span> <span class="pre">Reset</span></code></p></li>
<li><p>Editar el nuevo formulario <strong>ResetType.php</strong>:</p></li>
</ul>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Form</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\Form\AbstractType</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\FormBuilderInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\OptionsResolver\OptionsResolver</span><span class="p">;</span>
<span class="c1">// añadimos el tipo password y repeated para repetir la contraseña:</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\Extension\Core\Type\PasswordType</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\Extension\Core\Type\RepeatedType</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ResetType</span> <span class="k">extends</span> <span class="nx">AbstractType</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">buildForm</span><span class="p">(</span><span class="nx">FormBuilderInterface</span> <span class="nv">$builder</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$options</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$builder</span>
            <span class="c1">// añadimos el campo para resetear el password:</span>
            <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="nx">RepeatedType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="nx">PasswordType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
                <span class="s1">&#39;invalid_message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Las contraseñas no coinciden&#39;</span><span class="p">,</span>
                <span class="s1">&#39;required&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
                <span class="s1">&#39;empty_data&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="s1">&#39;first_options&#39;</span>  <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;label&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Nueva contraseña&#39;</span><span class="p">),</span>
                <span class="s1">&#39;second_options&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;label&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Repetir contraseña&#39;</span><span class="p">),</span>
            <span class="p">))</span>
        <span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">configureOptions</span><span class="p">(</span><span class="nx">OptionsResolver</span> <span class="nv">$resolver</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$resolver</span><span class="o">-&gt;</span><span class="na">setDefaults</span><span class="p">([</span>
            <span class="c1">// Configure your form options here</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Añadimos un nuevo método para el controlador <strong>UserController.php</strong>:</p></li>
</ul>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Bundle\FrameworkBundle\Controller\AbstractController</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Routing\Annotation\Route</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Doctrine\ORM\EntityManagerInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\PasswordHasher\Hasher\UserPasswordHasherInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Security\Http\Authentication\AuthenticationUtils</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\String\Slugger\SluggerInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\File\Exception\FileException</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\File\UploadedFile</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Mailer\MailerInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Mime\Email</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Entity\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Form\UserType</span><span class="p">;</span>
<span class="c1">// importamos el nuevo fomrulario:</span>
<span class="k">use</span> <span class="nx">App\Form\ResetType</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">AbstractController</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">login</span><span class="p">(</span><span class="nx">AuthenticationUtils</span> <span class="nv">$authenticationUtils</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nv">$error</span> <span class="o">=</span> <span class="nv">$authenticationUtils</span><span class="o">-&gt;</span><span class="na">getLastAuthenticationError</span><span class="p">();</span>
        <span class="nv">$lastUsername</span> <span class="o">=</span> <span class="nv">$authenticationUtils</span><span class="o">-&gt;</span><span class="na">getLastUsername</span><span class="p">();</span>

        <span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
        <span class="nv">$registrationForm</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">UserType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$user</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;user/login.html.twig&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;registration_form&#39;</span> <span class="o">=&gt;</span> <span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">createView</span><span class="p">(),</span>
            <span class="s1">&#39;last_username&#39;</span> <span class="o">=&gt;</span> <span class="nv">$lastUsername</span><span class="p">,</span>
            <span class="s1">&#39;error&#39;</span> <span class="o">=&gt;</span> <span class="nv">$error</span>
        <span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">logout</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span> <span class="p">{}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">(</span>
        <span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span>
        <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">,</span>
        <span class="nx">UserPasswordHasherInterface</span> <span class="nv">$passwordHasher</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
        <span class="nv">$registrationForm</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">UserType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$user</span><span class="p">);</span>

        <span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">handleRequest</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">isSubmitted</span><span class="p">()){</span>
            <span class="k">if</span><span class="p">(</span><span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">()){</span>
                <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setRoles</span><span class="p">([</span><span class="s1">&#39;ROLE_USER&#39;</span><span class="p">]);</span>
                <span class="nv">$plainPassword</span> <span class="o">=</span> <span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">();</span>
                <span class="nv">$hashedPassword</span> <span class="o">=</span> <span class="nv">$passwordHasher</span><span class="o">-&gt;</span><span class="na">hashPassword</span><span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="nv">$plainPassword</span><span class="p">);</span>
                <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$hashedPassword</span><span class="p">);</span>

                <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
                <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
                <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">profile</span><span class="p">(</span>
        <span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span>
        <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">,</span>
        <span class="nx">UserPasswordHasherInterface</span> <span class="nv">$passwordHasher</span><span class="p">,</span>
        <span class="nx">SluggerInterface</span> <span class="nv">$slugger</span>
    <span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getUser</span><span class="p">();</span>
        <span class="nv">$isAvatar</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getAvatar</span><span class="p">();</span>
        <span class="nv">$username</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">();</span>

        <span class="k">if</span><span class="p">(</span><span class="nv">$isAvatar</span><span class="p">){</span>
            <span class="nv">$avatar</span> <span class="o">=</span> <span class="s1">&#39;./uploads/avatars/&#39;</span> <span class="o">.</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getAvatar</span><span class="p">();</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="nv">$avatar</span> <span class="o">=</span> <span class="s1">&#39;./assets/images/avatar.png&#39;</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nv">$oldPassword</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getPassword</span><span class="p">();</span>
        <span class="nv">$userEditForm</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">UserType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$user</span><span class="p">);</span>

        <span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">handleRequest</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>

        <span class="k">if</span><span class="p">(</span><span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">isSubmitted</span><span class="p">()){</span>
            <span class="k">if</span><span class="p">(</span><span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">()){</span>
                <span class="nv">$file</span> <span class="o">=</span> <span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;avatar&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">();</span>
                <span class="k">if</span><span class="p">(</span><span class="nv">$file</span><span class="p">){</span>
                    <span class="nv">$originalFilename</span> <span class="o">=</span> <span class="nb">pathinfo</span><span class="p">(</span><span class="nv">$file</span><span class="o">-&gt;</span><span class="na">getClientOriginalName</span><span class="p">(),</span> <span class="nx">PATHINFO_FILENAME</span><span class="p">);</span>
                    <span class="nv">$safeFilename</span> <span class="o">=</span> <span class="nv">$slugger</span><span class="o">-&gt;</span><span class="na">slug</span><span class="p">(</span><span class="nv">$originalFilename</span><span class="p">);</span>
                    <span class="nv">$newFilename</span> <span class="o">=</span> <span class="nv">$safeFilename</span> <span class="o">.</span> <span class="s1">&#39;-&#39;</span> <span class="o">.</span> <span class="nb">uniqid</span><span class="p">()</span> <span class="o">.</span> <span class="s1">&#39;.&#39;</span> <span class="o">.</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">guessExtension</span><span class="p">();</span>
                    <span class="k">try</span><span class="p">{</span>
                        <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">move</span><span class="p">(</span>
                            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getParameter</span><span class="p">(</span><span class="s1">&#39;avatars&#39;</span><span class="p">),</span>
                            <span class="nv">$newFilename</span>
                        <span class="p">);</span>
                    <span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">FileException</span> <span class="nv">$e</span><span class="p">){</span>
                        <span class="c1">// ignoramos el error y seguimos adelante</span>
                    <span class="p">}</span>

                    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setAvatar</span><span class="p">(</span><span class="nv">$newFilename</span><span class="p">);</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setAvatar</span><span class="p">(</span><span class="nv">$isAvatar</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="nv">$plainPassword</span> <span class="o">=</span> <span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">();</span>
                <span class="k">if</span><span class="p">(</span><span class="nv">$plainPassword</span><span class="p">){</span>
                    <span class="nv">$hashedPassword</span> <span class="o">=</span> <span class="nv">$passwordHasher</span><span class="o">-&gt;</span><span class="na">hashPassword</span><span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="nv">$plainPassword</span><span class="p">);</span>
                    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$hashedPassword</span><span class="p">);</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$oldPassword</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
                <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;user/profile.html.twig&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;user_edit_form&#39;</span> <span class="o">=&gt;</span> <span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">createView</span><span class="p">(),</span>
            <span class="s1">&#39;avatar&#39;</span> <span class="o">=&gt;</span> <span class="nv">$avatar</span><span class="p">,</span>
            <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="nv">$username</span>
        <span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">send_reset_email</span><span class="p">(</span>
        <span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span>
        <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">,</span>
        <span class="nx">MailerInterface</span> <span class="nv">$mailer</span><span class="p">){</span>
        <span class="nv">$email</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;reset_email&#39;</span><span class="p">);</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="na">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">findOneBy</span><span class="p">([</span><span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="nv">$email</span><span class="p">]);</span>

        <span class="k">if</span><span class="p">(</span><span class="nv">$user</span><span class="p">){</span>
            <span class="c1">// codificamos el id del usuario:</span>
            <span class="nv">$prefix</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;sha256&#39;</span><span class="p">,</span> <span class="nv">$_ENV</span><span class="p">[</span><span class="s1">&#39;START_KEY&#39;</span><span class="p">]);</span>
            <span class="nv">$sufix</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;sha256&#39;</span><span class="p">,</span> <span class="nv">$_ENV</span><span class="p">[</span><span class="s1">&#39;END_KEY&#39;</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
            <span class="nv">$hashId</span> <span class="o">=</span> <span class="nb">openssl_encrypt</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getId</span><span class="p">(),</span> <span class="nv">$_ENV</span><span class="p">[</span><span class="s1">&#39;HASH_METHOD&#39;</span><span class="p">],</span> <span class="nv">$prefix</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$sufix</span><span class="p">);</span>

            <span class="nv">$urlSource</span> <span class="o">=</span> <span class="s2">&quot;http://localhost:5000/reset_password/&quot;</span> <span class="o">.</span> <span class="nb">base64_encode</span><span class="p">(</span><span class="nv">$hashId</span><span class="p">);</span>
            <span class="k">echo</span> <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$urlSource</span><span class="p">);</span>

            <span class="nv">$emailToSend</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Email</span><span class="p">())</span>
                            <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;pytonicus@gmail.com&#39;</span><span class="p">)</span>
                            <span class="o">-&gt;</span><span class="na">to</span><span class="p">(</span><span class="nv">$email</span><span class="p">)</span>
                            <span class="o">-&gt;</span><span class="na">subject</span><span class="p">(</span><span class="s1">&#39;ASUNTO: Recuperar contraseña&#39;</span><span class="p">)</span>
                            <span class="o">-&gt;</span><span class="na">text</span><span class="p">(</span><span class="s1">&#39;reestablecer contraseña&#39;</span><span class="p">)</span>
                            <span class="o">-&gt;</span><span class="na">html</span><span class="p">(</span><span class="s1">&#39;&lt;a href=&quot;&#39;</span> <span class="o">.</span> <span class="nv">$urlSource</span> <span class="o">.</span> <span class="s1">&#39;&quot;&gt;&#39;</span> <span class="o">.</span> <span class="nv">$urlSource</span> <span class="o">.</span> <span class="s1">&#39;&lt;/a&gt;&#39;</span><span class="p">);</span>
            <span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="nv">$emailToSend</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">);</span>
        <span class="cm">/* Este código lo usamos para depurar el correo:</span>
<span class="cm">        return new Response(</span>
<span class="cm">            &#39;&lt;html&gt;&lt;body&gt;TESTING DE EMAIL&lt;/body&gt;&lt;/html&gt;&#39;</span>
<span class="cm">        ); */</span>
    <span class="p">}</span>

    <span class="c1">// metodo para resetear la contraseña:</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">reset_password</span><span class="p">(</span>
        <span class="nv">$hashId</span><span class="p">,</span>
        <span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span>
        <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">,</span>
        <span class="nx">UserPasswordHasherInterface</span> <span class="nv">$passwordHasher</span>
        <span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// descodificamos el id del usuario:</span>
        <span class="nv">$prefix</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;sha256&#39;</span><span class="p">,</span> <span class="nv">$_ENV</span><span class="p">[</span><span class="s1">&#39;START_KEY&#39;</span><span class="p">]);</span>
        <span class="nv">$sufix</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;sha256&#39;</span><span class="p">,</span> <span class="nv">$_ENV</span><span class="p">[</span><span class="s1">&#39;END_KEY&#39;</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
        <span class="nv">$id</span> <span class="o">=</span> <span class="nb">openssl_decrypt</span><span class="p">(</span><span class="nb">base64_decode</span><span class="p">(</span><span class="nv">$hashId</span><span class="p">),</span> <span class="nv">$_ENV</span><span class="p">[</span><span class="s1">&#39;HASH_METHOD&#39;</span><span class="p">],</span> <span class="nv">$prefix</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$sufix</span><span class="p">);</span>

        <span class="c1">// recuperamos el usuario mediante el id descifrado:</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="na">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">findOneBy</span><span class="p">([</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$id</span><span class="p">]);</span>
        <span class="c1">// si existe un usuario vamos a crear un formulario:</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$user</span><span class="p">){</span>
            <span class="c1">// creamos un formulario para resetear password:</span>
            <span class="nv">$newPasswordForm</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">ResetType</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
            <span class="c1">// recuperamos la request en cuanto se reciba la nueva contraseña:</span>
            <span class="nv">$newPasswordForm</span><span class="o">-&gt;</span><span class="na">handleRequest</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>

            <span class="k">if</span><span class="p">(</span><span class="nv">$newPasswordForm</span><span class="o">-&gt;</span><span class="na">isSubmitted</span><span class="p">()){</span>
                <span class="k">if</span><span class="p">(</span><span class="nv">$newPasswordForm</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">()){</span>
                    <span class="nv">$plainPassword</span> <span class="o">=</span> <span class="nv">$newPasswordForm</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">][</span><span class="s1">&#39;first&#39;</span><span class="p">];</span>
                    <span class="k">if</span><span class="p">(</span><span class="nv">$plainPassword</span><span class="p">){</span>
                        <span class="c1">// obtenemos la data del password correcto y lo codificamos:</span>
                        <span class="nv">$hashedPassword</span> <span class="o">=</span> <span class="nv">$passwordHasher</span><span class="o">-&gt;</span><span class="na">hashPassword</span><span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="nv">$plainPassword</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">());</span>
                        <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$hashedPassword</span><span class="p">);</span>
                    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                        <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$oldPassword</span><span class="p">);</span>
                    <span class="p">}</span>
                    <span class="c1">// guardamos y redireccionamos a login:</span>
                    <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
                    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="c1">// si por un casual el usuario no existe hacemos redirección a login:</span>
            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;user/reset_password.html.twig&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;new_password_form&#39;</span> <span class="o">=&gt;</span> <span class="nv">$newPasswordForm</span><span class="o">-&gt;</span><span class="na">createView</span><span class="p">(),</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Creamos una nueva plantilla en <strong>user</strong> llamada <strong>reset_password.html.twig</strong>:</p></li>
</ul>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>{% extends &#39;base.html.twig&#39; %}

{% block title %}Hello UserController!{% endblock %}

{% block body %}

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;bodystyle text-center&quot;</span> <span class="na">cz-shortcut-listen</span><span class="o">=</span><span class="s">&quot;true&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-signin text-center&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Restablecer contraseña<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
        {{ form_row(new_password_form._token) }}
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-floating&quot;</span><span class="p">&gt;</span>
                {{ form_label(new_password_form.password.first) }}
                {{ form_widget(new_password_form.password.first, {&#39;attr&#39;: {&#39;class&#39;: &#39;form-control&#39;, &#39;placeholder&#39;:&#39;Nueva contraseña&#39;}}) }}
                {{ form_errors(new_password_form.password.first) }}
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-floating&quot;</span><span class="p">&gt;</span>
                {{ form_label(new_password_form.password.second, ) }}
                {{ form_widget(new_password_form.password.second, {&#39;attr&#39;: {&#39;class&#39;: &#39;form-control&#39;, &#39;placeholder&#39;:&#39;Repetir nueva contraseña&#39;}}) }}
                {{ form_errors(new_password_form.password.second) }}
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-100 btn btn-lg btn-secondary&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Cambiar contraseña<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

{% endblock %}
</pre></div>
</div>
<ul class="simple">
<li><p>Y finalmente asignamos la nueva ruta a <strong>routes.yaml</strong>:</p></li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">index</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\TaskController::index</span><span class="w"></span>

<span class="nt">finish</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tasks/finish/{id}</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\TaskController::finish</span><span class="w"></span>

<span class="nt">delete</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tasks/delete/{id}</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\TaskController::delete</span><span class="w"></span>

<span class="nt">update</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tasks/update/{id}</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\TaskController::update</span><span class="w"></span>

<span class="nt">login</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/login</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\UserController::login</span><span class="w"></span>

<span class="nt">logout</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/logout</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\UserController::logout</span><span class="w"></span>

<span class="nt">register</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/register</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\UserController::register</span><span class="w"></span>

<span class="nt">profile</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/profile</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\UserController::profile</span><span class="w"></span>

<span class="nt">send_reset_email</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/send_reset_email</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\UserController::send_reset_email</span><span class="w"></span>

<span class="c1"># ruta para resetear contraseña:</span><span class="w"></span>
<span class="nt">reset_password</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/reset_password/{hashId}</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\UserController::reset_password</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="paso-14-crear-alertas">
<h3><a class="toc-backref" href="#id30">Paso 14: Crear alertas</a><a class="headerlink" href="#paso-14-crear-alertas" title="Enlazar permanentemente con este título">¶</a></h3>
<ul class="simple">
<li><p>Vamos a comenzar por las alertas del login. Editamos <strong>UserController.php</strong>:</p></li>
</ul>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Bundle\FrameworkBundle\Controller\AbstractController</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Routing\Annotation\Route</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Doctrine\ORM\EntityManagerInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\PasswordHasher\Hasher\UserPasswordHasherInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Security\Http\Authentication\AuthenticationUtils</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\String\Slugger\SluggerInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\File\Exception\FileException</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\File\UploadedFile</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Mailer\MailerInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Mime\Email</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Entity\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Form\UserType</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Form\ResetType</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">AbstractController</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">login</span><span class="p">(</span><span class="nx">AuthenticationUtils</span> <span class="nv">$authenticationUtils</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nv">$error</span> <span class="o">=</span> <span class="nv">$authenticationUtils</span><span class="o">-&gt;</span><span class="na">getLastAuthenticationError</span><span class="p">();</span>
        <span class="nv">$lastUsername</span> <span class="o">=</span> <span class="nv">$authenticationUtils</span><span class="o">-&gt;</span><span class="na">getLastUsername</span><span class="p">();</span>

        <span class="c1">// creamos un array con los datos del alert a mostrar</span>
        <span class="nv">$alert</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;show&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span>
        <span class="p">);</span>
        <span class="c1">// comprobar si existe error de autenticación y lanzarlo:</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$error</span><span class="p">){</span>
            <span class="nv">$alert</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;show&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;show&#39;</span><span class="p">,</span>
                <span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;alert-warning&#39;</span><span class="p">,</span>
                <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Error de autentiación, usuario o contraseñas incorrectos&#39;</span>
            <span class="p">);</span>
        <span class="p">}</span>

        <span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
        <span class="nv">$registrationForm</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">UserType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$user</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;user/login.html.twig&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;registration_form&#39;</span> <span class="o">=&gt;</span> <span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">createView</span><span class="p">(),</span>
            <span class="s1">&#39;last_username&#39;</span> <span class="o">=&gt;</span> <span class="nv">$lastUsername</span><span class="p">,</span>
            <span class="s1">&#39;error&#39;</span> <span class="o">=&gt;</span> <span class="nv">$error</span><span class="p">,</span>
            <span class="s1">&#39;alert&#39;</span> <span class="o">=&gt;</span> <span class="nv">$alert</span> <span class="c1">// renderizamos en twig el alert</span>
        <span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">logout</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span> <span class="p">{}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">(</span>
        <span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span>
        <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">,</span>
        <span class="nx">UserPasswordHasherInterface</span> <span class="nv">$passwordHasher</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
        <span class="nv">$registrationForm</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">UserType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$user</span><span class="p">);</span>

        <span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">handleRequest</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">isSubmitted</span><span class="p">()){</span>
            <span class="k">if</span><span class="p">(</span><span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">()){</span>
                <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setRoles</span><span class="p">([</span><span class="s1">&#39;ROLE_USER&#39;</span><span class="p">]);</span>
                <span class="nv">$plainPassword</span> <span class="o">=</span> <span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">();</span>
                <span class="nv">$hashedPassword</span> <span class="o">=</span> <span class="nv">$passwordHasher</span><span class="o">-&gt;</span><span class="na">hashPassword</span><span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="nv">$plainPassword</span><span class="p">);</span>
                <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$hashedPassword</span><span class="p">);</span>

                <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
                <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
                <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">profile</span><span class="p">(</span>
        <span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span>
        <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">,</span>
        <span class="nx">UserPasswordHasherInterface</span> <span class="nv">$passwordHasher</span><span class="p">,</span>
        <span class="nx">SluggerInterface</span> <span class="nv">$slugger</span>
    <span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getUser</span><span class="p">();</span>
        <span class="nv">$isAvatar</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getAvatar</span><span class="p">();</span>
        <span class="nv">$username</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">();</span>

        <span class="k">if</span><span class="p">(</span><span class="nv">$isAvatar</span><span class="p">){</span>
            <span class="nv">$avatar</span> <span class="o">=</span> <span class="s1">&#39;./uploads/avatars/&#39;</span> <span class="o">.</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getAvatar</span><span class="p">();</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="nv">$avatar</span> <span class="o">=</span> <span class="s1">&#39;./assets/images/avatar.png&#39;</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nv">$oldPassword</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getPassword</span><span class="p">();</span>
        <span class="nv">$userEditForm</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">UserType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$user</span><span class="p">);</span>

        <span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">handleRequest</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>

        <span class="k">if</span><span class="p">(</span><span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">isSubmitted</span><span class="p">()){</span>
            <span class="k">if</span><span class="p">(</span><span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">()){</span>
                <span class="nv">$file</span> <span class="o">=</span> <span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;avatar&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">();</span>
                <span class="k">if</span><span class="p">(</span><span class="nv">$file</span><span class="p">){</span>
                    <span class="nv">$originalFilename</span> <span class="o">=</span> <span class="nb">pathinfo</span><span class="p">(</span><span class="nv">$file</span><span class="o">-&gt;</span><span class="na">getClientOriginalName</span><span class="p">(),</span> <span class="nx">PATHINFO_FILENAME</span><span class="p">);</span>
                    <span class="nv">$safeFilename</span> <span class="o">=</span> <span class="nv">$slugger</span><span class="o">-&gt;</span><span class="na">slug</span><span class="p">(</span><span class="nv">$originalFilename</span><span class="p">);</span>
                    <span class="nv">$newFilename</span> <span class="o">=</span> <span class="nv">$safeFilename</span> <span class="o">.</span> <span class="s1">&#39;-&#39;</span> <span class="o">.</span> <span class="nb">uniqid</span><span class="p">()</span> <span class="o">.</span> <span class="s1">&#39;.&#39;</span> <span class="o">.</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">guessExtension</span><span class="p">();</span>
                    <span class="k">try</span><span class="p">{</span>
                        <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">move</span><span class="p">(</span>
                            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getParameter</span><span class="p">(</span><span class="s1">&#39;avatars&#39;</span><span class="p">),</span>
                            <span class="nv">$newFilename</span>
                        <span class="p">);</span>
                    <span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">FileException</span> <span class="nv">$e</span><span class="p">){</span>
                        <span class="c1">// ignoramos el error y seguimos adelante</span>
                    <span class="p">}</span>

                    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setAvatar</span><span class="p">(</span><span class="nv">$newFilename</span><span class="p">);</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setAvatar</span><span class="p">(</span><span class="nv">$isAvatar</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="nv">$plainPassword</span> <span class="o">=</span> <span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">();</span>
                <span class="k">if</span><span class="p">(</span><span class="nv">$plainPassword</span><span class="p">){</span>
                    <span class="nv">$hashedPassword</span> <span class="o">=</span> <span class="nv">$passwordHasher</span><span class="o">-&gt;</span><span class="na">hashPassword</span><span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="nv">$plainPassword</span><span class="p">);</span>
                    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$hashedPassword</span><span class="p">);</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$oldPassword</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
                <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;user/profile.html.twig&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;user_edit_form&#39;</span> <span class="o">=&gt;</span> <span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">createView</span><span class="p">(),</span>
            <span class="s1">&#39;avatar&#39;</span> <span class="o">=&gt;</span> <span class="nv">$avatar</span><span class="p">,</span>
            <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="nv">$username</span>
        <span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">send_reset_email</span><span class="p">(</span>
        <span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span>
        <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">,</span>
        <span class="nx">MailerInterface</span> <span class="nv">$mailer</span><span class="p">){</span>
        <span class="nv">$email</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;reset_email&#39;</span><span class="p">);</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="na">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">findOneBy</span><span class="p">([</span><span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="nv">$email</span><span class="p">]);</span>

        <span class="k">if</span><span class="p">(</span><span class="nv">$user</span><span class="p">){</span>
            <span class="nv">$prefix</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;sha256&#39;</span><span class="p">,</span> <span class="nv">$_ENV</span><span class="p">[</span><span class="s1">&#39;START_KEY&#39;</span><span class="p">]);</span>
            <span class="nv">$sufix</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;sha256&#39;</span><span class="p">,</span> <span class="nv">$_ENV</span><span class="p">[</span><span class="s1">&#39;END_KEY&#39;</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
            <span class="nv">$hashId</span> <span class="o">=</span> <span class="nb">openssl_encrypt</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getId</span><span class="p">(),</span> <span class="nv">$_ENV</span><span class="p">[</span><span class="s1">&#39;HASH_METHOD&#39;</span><span class="p">],</span> <span class="nv">$prefix</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$sufix</span><span class="p">);</span>

            <span class="nv">$urlSource</span> <span class="o">=</span> <span class="s2">&quot;http://localhost:5000/reset_password/&quot;</span> <span class="o">.</span> <span class="nb">base64_encode</span><span class="p">(</span><span class="nv">$hashId</span><span class="p">);</span>
            <span class="k">echo</span> <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$urlSource</span><span class="p">);</span>

            <span class="nv">$emailToSend</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Email</span><span class="p">())</span>
                            <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;pytonicus@gmail.com&#39;</span><span class="p">)</span>
                            <span class="o">-&gt;</span><span class="na">to</span><span class="p">(</span><span class="nv">$email</span><span class="p">)</span>
                            <span class="o">-&gt;</span><span class="na">subject</span><span class="p">(</span><span class="s1">&#39;ASUNTO: Recuperar contraseña&#39;</span><span class="p">)</span>
                            <span class="o">-&gt;</span><span class="na">text</span><span class="p">(</span><span class="s1">&#39;reestablecer contraseña&#39;</span><span class="p">)</span>
                            <span class="o">-&gt;</span><span class="na">html</span><span class="p">(</span><span class="s1">&#39;&lt;a href=&quot;&#39;</span> <span class="o">.</span> <span class="nv">$urlSource</span> <span class="o">.</span> <span class="s1">&#39;&quot;&gt;&#39;</span> <span class="o">.</span> <span class="nv">$urlSource</span> <span class="o">.</span> <span class="s1">&#39;&lt;/a&gt;&#39;</span><span class="p">);</span>
            <span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="nv">$emailToSend</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">);</span>
        <span class="cm">/* Este código lo usamos para depurar el correo:</span>
<span class="cm">        return new Response(</span>
<span class="cm">            &#39;&lt;html&gt;&lt;body&gt;TESTING DE EMAIL&lt;/body&gt;&lt;/html&gt;&#39;</span>
<span class="cm">        ); */</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">reset_password</span><span class="p">(</span>
        <span class="nv">$hashId</span><span class="p">,</span>
        <span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span>
        <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">,</span>
        <span class="nx">UserPasswordHasherInterface</span> <span class="nv">$passwordHasher</span>
        <span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$prefix</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;sha256&#39;</span><span class="p">,</span> <span class="nv">$_ENV</span><span class="p">[</span><span class="s1">&#39;START_KEY&#39;</span><span class="p">]);</span>
        <span class="nv">$sufix</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;sha256&#39;</span><span class="p">,</span> <span class="nv">$_ENV</span><span class="p">[</span><span class="s1">&#39;END_KEY&#39;</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
        <span class="nv">$id</span> <span class="o">=</span> <span class="nb">openssl_decrypt</span><span class="p">(</span><span class="nb">base64_decode</span><span class="p">(</span><span class="nv">$hashId</span><span class="p">),</span> <span class="nv">$_ENV</span><span class="p">[</span><span class="s1">&#39;HASH_METHOD&#39;</span><span class="p">],</span> <span class="nv">$prefix</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$sufix</span><span class="p">);</span>

        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="na">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">findOneBy</span><span class="p">([</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$id</span><span class="p">]);</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$user</span><span class="p">){</span>
            <span class="nv">$newPasswordForm</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">ResetType</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
            <span class="nv">$newPasswordForm</span><span class="o">-&gt;</span><span class="na">handleRequest</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>

            <span class="k">if</span><span class="p">(</span><span class="nv">$newPasswordForm</span><span class="o">-&gt;</span><span class="na">isSubmitted</span><span class="p">()){</span>
                <span class="k">if</span><span class="p">(</span><span class="nv">$newPasswordForm</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">()){</span>
                    <span class="nv">$plainPassword</span> <span class="o">=</span> <span class="nv">$newPasswordForm</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">][</span><span class="s1">&#39;first&#39;</span><span class="p">];</span>
                    <span class="k">if</span><span class="p">(</span><span class="nv">$plainPassword</span><span class="p">){</span>
                        <span class="nv">$hashedPassword</span> <span class="o">=</span> <span class="nv">$passwordHasher</span><span class="o">-&gt;</span><span class="na">hashPassword</span><span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="nv">$plainPassword</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">());</span>
                        <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$hashedPassword</span><span class="p">);</span>
                    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                        <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$oldPassword</span><span class="p">);</span>
                    <span class="p">}</span>
                    <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
                    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;user/reset_password.html.twig&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;new_password_form&#39;</span> <span class="o">=&gt;</span> <span class="nv">$newPasswordForm</span><span class="o">-&gt;</span><span class="na">createView</span><span class="p">(),</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Implementamos el alert en la plantilla twig <strong>login.html.twig</strong>:</p></li>
</ul>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>{% extends &#39;base.html.twig&#39; %}

{% block title %}Hello UserController!{% endblock %}

{% block body %}

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot; bodystyle text-center&quot;</span> <span class="na">cz-shortcut-listen</span><span class="o">=</span><span class="s">&quot;true&quot;</span><span class="p">&gt;</span>
    <span class="cm">&lt;!-- Creamos un alert para avisar de cada estado y le pasamos los datos del array --&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;alert-group alert {{alert[&#39;status&#39;]}} alert-dismissible fade {{alert[&#39;show&#39;]}}&quot;</span> <span class="na">role</span><span class="o">=</span><span class="s">&quot;alert&quot;</span><span class="p">&gt;</span>
        {{alert[&#39;message&#39;]}}
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;button&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn-close&quot;</span> <span class="na">data-bs-dismiss</span><span class="o">=</span><span class="s">&quot;alert&quot;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&quot;Close&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-signin text-center&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Por favor inicia sesión<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{{ path(&#39;login&#39;)}}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-floating&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;email&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;username&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;_username&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;{{last_username}}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-control&quot;</span> <span class="p">/&gt;</span>
                <span class="p">&lt;</span><span class="nt">label</span> <span class="na">htmlFor</span><span class="o">=</span><span class="s">&quot;floatingInput&quot;</span><span class="p">&gt;</span>Email<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-floating&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;_password&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-control&quot;</span> <span class="p">/&gt;</span>
                <span class="p">&lt;</span><span class="nt">label</span> <span class="na">htmlFor</span><span class="o">=</span><span class="s">&quot;floatingPassword&quot;</span><span class="p">&gt;</span>Contraseña<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mb-3&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;button&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;cursor&quot;</span> <span class="na">data-bs-toggle</span><span class="o">=</span><span class="s">&quot;modal&quot;</span> <span class="na">data-bs-target</span><span class="o">=</span><span class="s">&quot;#registerUser&quot;</span>  <span class="na">data-bs-toggle</span><span class="o">=</span><span class="s">&quot;modal&quot;</span> <span class="na">data-bs-target</span><span class="o">=</span><span class="s">&quot;#registerUser&quot;</span><span class="p">&gt;</span>Crear usuario<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mb-3&quot;</span><span class="p">&gt;</span>
            <span class="cm">&lt;!-- actualizamos el botón para desplegar el modal si ha olvidado contraseña --&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;button&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;cursor&quot;</span> <span class="na">data-bs-toggle</span><span class="o">=</span><span class="s">&quot;modal&quot;</span> <span class="na">data-bs-target</span><span class="o">=</span><span class="s">&quot;#resetPassword&quot;</span>  <span class="na">data-bs-toggle</span><span class="o">=</span><span class="s">&quot;modal&quot;</span> <span class="na">data-bs-target</span><span class="o">=</span><span class="s">&quot;#resetPassword&quot;</span><span class="p">&gt;</span>¿has olvidado la contraseña?<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;w-100 btn btn-lg btn-primary&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Iniciar sesión<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal fade&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;registerUser&quot;</span> <span class="na">tabIndex</span><span class="o">=</span><span class="s">&quot;-1&quot;</span> <span class="na">aria-labelledby</span><span class="o">=</span><span class="s">&quot;exampleModalLabel&quot;</span> <span class="na">aria-hidden</span><span class="o">=</span><span class="s">&quot;true&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-dialog&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-content&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-header&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">h5</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-title&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;exampleModalLabel&quot;</span><span class="p">&gt;</span>Registro<span class="p">&lt;/</span><span class="nt">h5</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;button&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn-close&quot;</span> <span class="na">data-bs-dismiss</span><span class="o">=</span><span class="s">&quot;modal&quot;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&quot;Close&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-body&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container&quot;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">form</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;userForm&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{{path(&#39;register&#39;)}}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">role</span><span class="o">=</span><span class="s">&quot;form&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container&quot;</span><span class="p">&gt;</span>
                                {{ form_row(registration_form._token) }}

                                {{ form_label(registration_form.email, &#39;email&#39;, {&#39;label_attr&#39;: {&#39;style&#39;: &#39;display:none&#39;}}) }}
                                {{ form_widget(registration_form.email, {&#39;attr&#39;: {&#39;class&#39;: &#39;form-control mt-3&#39;, &#39;placeholder&#39;:&#39;Email&#39;}}) }}
                                {{ form_errors(registration_form.email) }}

                                {{ form_label(registration_form.password, &#39;password&#39;, {&#39;label_attr&#39;: {&#39;style&#39;: &#39;display:none&#39;}}) }}
                                {{ form_widget(registration_form.password, {&#39;attr&#39;:{&#39;class&#39;: &#39;form-control mt-3&#39;, &#39;placeholder&#39;: &#39;Contraseña&#39;, &#39;type&#39;:&#39;password&#39;}}) }}
                                {{ form_errors(registration_form.password, {&#39;attr&#39;: {&#39;class&#39;: &#39;col-md-3&#39;}}) }}

                                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-success form-control mt-3&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Darse de alta&quot;</span> <span class="p">/&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- modal para recuperar contraseña --&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal fade&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;resetPassword&quot;</span> <span class="na">tabIndex</span><span class="o">=</span><span class="s">&quot;-1&quot;</span> <span class="na">aria-labelledby</span><span class="o">=</span><span class="s">&quot;exampleModalLabel&quot;</span> <span class="na">aria-hidden</span><span class="o">=</span><span class="s">&quot;true&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-dialog&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-content&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-header&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">h5</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-title&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;exampleModalLabel&quot;</span><span class="p">&gt;</span>Resetear contraseña<span class="p">&lt;/</span><span class="nt">h5</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;button&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn-close&quot;</span> <span class="na">data-bs-dismiss</span><span class="o">=</span><span class="s">&quot;modal&quot;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&quot;Close&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-body&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col text-center&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{{path(&#39;send_reset_email&#39;)}}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">role</span><span class="o">=</span><span class="s">&quot;form&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;email&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;reset_email&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-control mt-3&quot;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Email&quot;</span> <span class="p">/&gt;</span>
                        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span>  <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-success form-control mt-3&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Enviar email&quot;</span> <span class="na">data-bs-dismiss</span><span class="o">=</span><span class="s">&quot;modal&quot;</span> <span class="p">/&gt;</span>
                        <span class="p">&lt;</span><span class="nt">small</span><span class="p">&gt;</span>Recibirás un email que te llevará donde resetear tu contraseña<span class="p">&lt;/</span><span class="nt">small</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

{% endblock %}
</pre></div>
</div>
<ul class="simple">
<li><p>Añadimos el siguiente estilo al final de la hoja <strong>base.css</strong>:</p></li>
</ul>
<div class="highlight-css notranslate"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nc">alert-group</span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">position</span><span class="p">:</span><span class="kc">fixed</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">top</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="kt">%</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><p>Ahora cuando vayamos a iniciar sesión con un usuario o contraseña incorrecto nos avisará.</p></li>
<li><p>Seguimos con la creación de un nuevo usuario, volvemos a editar la parte de registro en <strong>UserController.php</strong>:</p></li>
</ul>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Bundle\FrameworkBundle\Controller\AbstractController</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Routing\Annotation\Route</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Doctrine\ORM\EntityManagerInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\PasswordHasher\Hasher\UserPasswordHasherInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Security\Http\Authentication\AuthenticationUtils</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\String\Slugger\SluggerInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\File\Exception\FileException</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\File\UploadedFile</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Mailer\MailerInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Mime\Email</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Entity\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Form\UserType</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Form\ResetType</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">AbstractController</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">login</span><span class="p">(</span><span class="nx">AuthenticationUtils</span> <span class="nv">$authenticationUtils</span><span class="p">,</span> <span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nv">$error</span> <span class="o">=</span> <span class="nv">$authenticationUtils</span><span class="o">-&gt;</span><span class="na">getLastAuthenticationError</span><span class="p">();</span>
        <span class="nv">$lastUsername</span> <span class="o">=</span> <span class="nv">$authenticationUtils</span><span class="o">-&gt;</span><span class="na">getLastUsername</span><span class="p">();</span>

        <span class="c1">// en la alerta actual recogemos cualquier parametro recibido si existe de redirecciones como login:</span>
        <span class="nv">$alert</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;show&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;show&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;show&quot;</span><span class="p">)</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">)</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">)</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span>
        <span class="p">);</span>

        <span class="k">if</span><span class="p">(</span><span class="nv">$error</span><span class="p">){</span>
            <span class="nv">$alert</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;show&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;show&#39;</span><span class="p">,</span>
                <span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;alert-warning&#39;</span><span class="p">,</span>
                <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Error de autentiación, usuario o contraseñas incorrectos&#39;</span>
            <span class="p">);</span>
        <span class="p">}</span>

        <span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
        <span class="nv">$registrationForm</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">UserType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$user</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;user/login.html.twig&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;registration_form&#39;</span> <span class="o">=&gt;</span> <span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">createView</span><span class="p">(),</span>
            <span class="s1">&#39;last_username&#39;</span> <span class="o">=&gt;</span> <span class="nv">$lastUsername</span><span class="p">,</span>
            <span class="s1">&#39;error&#39;</span> <span class="o">=&gt;</span> <span class="nv">$error</span><span class="p">,</span>
            <span class="s1">&#39;alert&#39;</span> <span class="o">=&gt;</span> <span class="nv">$alert</span> <span class="c1">// renderizamos en twig el alert</span>
        <span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">logout</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span> <span class="p">{}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">(</span>
        <span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span>
        <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">,</span>
        <span class="nx">UserPasswordHasherInterface</span> <span class="nv">$passwordHasher</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
        <span class="nv">$registrationForm</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">UserType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$user</span><span class="p">);</span>

        <span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">handleRequest</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">isSubmitted</span><span class="p">()){</span>
            <span class="c1">// vamos a comprobar si existe el usuario:</span>
            <span class="nv">$email</span> <span class="o">=</span> <span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">();</span>
            <span class="nv">$emailExists</span> <span class="o">=</span> <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="na">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">findOneBy</span><span class="p">([</span><span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="nv">$email</span><span class="p">]);</span>
            <span class="k">if</span><span class="p">(</span><span class="nv">$emailExists</span><span class="p">){</span>
                <span class="c1">// redireccionamos a login y lanzamos una alerta de error en caso de que exista:</span>
                <span class="nv">$alert</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">&#39;show&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;show&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;alert-danger&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;El email ya se encuentra registrado.&#39;</span>
                <span class="p">);</span>
                <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="nv">$alert</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">if</span><span class="p">(</span><span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">()){</span>
                <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setRoles</span><span class="p">([</span><span class="s1">&#39;ROLE_USER&#39;</span><span class="p">]);</span>
                <span class="nv">$plainPassword</span> <span class="o">=</span> <span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">();</span>
                <span class="nv">$hashedPassword</span> <span class="o">=</span> <span class="nv">$passwordHasher</span><span class="o">-&gt;</span><span class="na">hashPassword</span><span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="nv">$plainPassword</span><span class="p">);</span>
                <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$hashedPassword</span><span class="p">);</span>

                <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
                <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
                <span class="c1">// definimos la alerta que llegará en caso de que funcione o no el registro:</span>
                <span class="nv">$alert</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">&#39;show&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;show&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;alert-success&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Usuario registrado con éxito. Ya puede iniciar sesión.&#39;</span>
                <span class="p">);</span>
                <span class="c1">// enviamos por parametros los datos del alert:</span>
                <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="nv">$alert</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">profile</span><span class="p">(</span>
        <span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span>
        <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">,</span>
        <span class="nx">UserPasswordHasherInterface</span> <span class="nv">$passwordHasher</span><span class="p">,</span>
        <span class="nx">SluggerInterface</span> <span class="nv">$slugger</span>
    <span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getUser</span><span class="p">();</span>
        <span class="nv">$isAvatar</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getAvatar</span><span class="p">();</span>
        <span class="nv">$username</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">();</span>

        <span class="k">if</span><span class="p">(</span><span class="nv">$isAvatar</span><span class="p">){</span>
            <span class="nv">$avatar</span> <span class="o">=</span> <span class="s1">&#39;./uploads/avatars/&#39;</span> <span class="o">.</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getAvatar</span><span class="p">();</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="nv">$avatar</span> <span class="o">=</span> <span class="s1">&#39;./assets/images/avatar.png&#39;</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nv">$oldPassword</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getPassword</span><span class="p">();</span>
        <span class="nv">$userEditForm</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">UserType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$user</span><span class="p">);</span>

        <span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">handleRequest</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>

        <span class="k">if</span><span class="p">(</span><span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">isSubmitted</span><span class="p">()){</span>
            <span class="k">if</span><span class="p">(</span><span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">()){</span>
                <span class="nv">$file</span> <span class="o">=</span> <span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;avatar&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">();</span>
                <span class="k">if</span><span class="p">(</span><span class="nv">$file</span><span class="p">){</span>
                    <span class="nv">$originalFilename</span> <span class="o">=</span> <span class="nb">pathinfo</span><span class="p">(</span><span class="nv">$file</span><span class="o">-&gt;</span><span class="na">getClientOriginalName</span><span class="p">(),</span> <span class="nx">PATHINFO_FILENAME</span><span class="p">);</span>
                    <span class="nv">$safeFilename</span> <span class="o">=</span> <span class="nv">$slugger</span><span class="o">-&gt;</span><span class="na">slug</span><span class="p">(</span><span class="nv">$originalFilename</span><span class="p">);</span>
                    <span class="nv">$newFilename</span> <span class="o">=</span> <span class="nv">$safeFilename</span> <span class="o">.</span> <span class="s1">&#39;-&#39;</span> <span class="o">.</span> <span class="nb">uniqid</span><span class="p">()</span> <span class="o">.</span> <span class="s1">&#39;.&#39;</span> <span class="o">.</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">guessExtension</span><span class="p">();</span>
                    <span class="k">try</span><span class="p">{</span>
                        <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">move</span><span class="p">(</span>
                            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getParameter</span><span class="p">(</span><span class="s1">&#39;avatars&#39;</span><span class="p">),</span>
                            <span class="nv">$newFilename</span>
                        <span class="p">);</span>
                    <span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">FileException</span> <span class="nv">$e</span><span class="p">){</span>
                        <span class="c1">// ignoramos el error y seguimos adelante</span>
                    <span class="p">}</span>

                    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setAvatar</span><span class="p">(</span><span class="nv">$newFilename</span><span class="p">);</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setAvatar</span><span class="p">(</span><span class="nv">$isAvatar</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="nv">$plainPassword</span> <span class="o">=</span> <span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">();</span>
                <span class="k">if</span><span class="p">(</span><span class="nv">$plainPassword</span><span class="p">){</span>
                    <span class="nv">$hashedPassword</span> <span class="o">=</span> <span class="nv">$passwordHasher</span><span class="o">-&gt;</span><span class="na">hashPassword</span><span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="nv">$plainPassword</span><span class="p">);</span>
                    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$hashedPassword</span><span class="p">);</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$oldPassword</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>

                <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;user/profile.html.twig&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;user_edit_form&#39;</span> <span class="o">=&gt;</span> <span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">createView</span><span class="p">(),</span>
            <span class="s1">&#39;avatar&#39;</span> <span class="o">=&gt;</span> <span class="nv">$avatar</span><span class="p">,</span>
            <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="nv">$username</span>
        <span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">send_reset_email</span><span class="p">(</span>
        <span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span>
        <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">,</span>
        <span class="nx">MailerInterface</span> <span class="nv">$mailer</span><span class="p">){</span>
        <span class="nv">$email</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;reset_email&#39;</span><span class="p">);</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="na">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">findOneBy</span><span class="p">([</span><span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="nv">$email</span><span class="p">]);</span>

        <span class="k">if</span><span class="p">(</span><span class="nv">$user</span><span class="p">){</span>
            <span class="nv">$prefix</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;sha256&#39;</span><span class="p">,</span> <span class="nv">$_ENV</span><span class="p">[</span><span class="s1">&#39;START_KEY&#39;</span><span class="p">]);</span>
            <span class="nv">$sufix</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;sha256&#39;</span><span class="p">,</span> <span class="nv">$_ENV</span><span class="p">[</span><span class="s1">&#39;END_KEY&#39;</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
            <span class="nv">$hashId</span> <span class="o">=</span> <span class="nb">openssl_encrypt</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getId</span><span class="p">(),</span> <span class="nv">$_ENV</span><span class="p">[</span><span class="s1">&#39;HASH_METHOD&#39;</span><span class="p">],</span> <span class="nv">$prefix</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$sufix</span><span class="p">);</span>

            <span class="nv">$urlSource</span> <span class="o">=</span> <span class="s2">&quot;http://localhost:5000/reset_password/&quot;</span> <span class="o">.</span> <span class="nb">base64_encode</span><span class="p">(</span><span class="nv">$hashId</span><span class="p">);</span>
            <span class="k">echo</span> <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$urlSource</span><span class="p">);</span>

            <span class="nv">$emailToSend</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Email</span><span class="p">())</span>
                            <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;pytonicus@gmail.com&#39;</span><span class="p">)</span>
                            <span class="o">-&gt;</span><span class="na">to</span><span class="p">(</span><span class="nv">$email</span><span class="p">)</span>
                            <span class="o">-&gt;</span><span class="na">subject</span><span class="p">(</span><span class="s1">&#39;ASUNTO: Recuperar contraseña&#39;</span><span class="p">)</span>
                            <span class="o">-&gt;</span><span class="na">text</span><span class="p">(</span><span class="s1">&#39;reestablecer contraseña&#39;</span><span class="p">)</span>
                            <span class="o">-&gt;</span><span class="na">html</span><span class="p">(</span><span class="s1">&#39;&lt;a href=&quot;&#39;</span> <span class="o">.</span> <span class="nv">$urlSource</span> <span class="o">.</span> <span class="s1">&#39;&quot;&gt;&#39;</span> <span class="o">.</span> <span class="nv">$urlSource</span> <span class="o">.</span> <span class="s1">&#39;&lt;/a&gt;&#39;</span><span class="p">);</span>
            <span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="nv">$emailToSend</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">);</span>
        <span class="cm">/* Este código lo usamos para depurar el correo:</span>
<span class="cm">        return new Response(</span>
<span class="cm">            &#39;&lt;html&gt;&lt;body&gt;TESTING DE EMAIL&lt;/body&gt;&lt;/html&gt;&#39;</span>
<span class="cm">        ); */</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">reset_password</span><span class="p">(</span>
        <span class="nv">$hashId</span><span class="p">,</span>
        <span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span>
        <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">,</span>
        <span class="nx">UserPasswordHasherInterface</span> <span class="nv">$passwordHasher</span>
        <span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$prefix</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;sha256&#39;</span><span class="p">,</span> <span class="nv">$_ENV</span><span class="p">[</span><span class="s1">&#39;START_KEY&#39;</span><span class="p">]);</span>
        <span class="nv">$sufix</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;sha256&#39;</span><span class="p">,</span> <span class="nv">$_ENV</span><span class="p">[</span><span class="s1">&#39;END_KEY&#39;</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
        <span class="nv">$id</span> <span class="o">=</span> <span class="nb">openssl_decrypt</span><span class="p">(</span><span class="nb">base64_decode</span><span class="p">(</span><span class="nv">$hashId</span><span class="p">),</span> <span class="nv">$_ENV</span><span class="p">[</span><span class="s1">&#39;HASH_METHOD&#39;</span><span class="p">],</span> <span class="nv">$prefix</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$sufix</span><span class="p">);</span>

        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="na">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">findOneBy</span><span class="p">([</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$id</span><span class="p">]);</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$user</span><span class="p">){</span>
            <span class="nv">$newPasswordForm</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">ResetType</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
            <span class="nv">$newPasswordForm</span><span class="o">-&gt;</span><span class="na">handleRequest</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>

            <span class="k">if</span><span class="p">(</span><span class="nv">$newPasswordForm</span><span class="o">-&gt;</span><span class="na">isSubmitted</span><span class="p">()){</span>
                <span class="k">if</span><span class="p">(</span><span class="nv">$newPasswordForm</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">()){</span>
                    <span class="nv">$plainPassword</span> <span class="o">=</span> <span class="nv">$newPasswordForm</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">][</span><span class="s1">&#39;first&#39;</span><span class="p">];</span>
                    <span class="k">if</span><span class="p">(</span><span class="nv">$plainPassword</span><span class="p">){</span>
                        <span class="nv">$hashedPassword</span> <span class="o">=</span> <span class="nv">$passwordHasher</span><span class="o">-&gt;</span><span class="na">hashPassword</span><span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="nv">$plainPassword</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">());</span>
                        <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$hashedPassword</span><span class="p">);</span>
                    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                        <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$oldPassword</span><span class="p">);</span>
                    <span class="p">}</span>
                    <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
                    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;user/reset_password.html.twig&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;new_password_form&#39;</span> <span class="o">=&gt;</span> <span class="nv">$newPasswordForm</span><span class="o">-&gt;</span><span class="na">createView</span><span class="p">(),</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Ya sabiendo como funcionan login y register podemos editar el resto de <strong>UserController.php</strong>:</p></li>
</ul>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Bundle\FrameworkBundle\Controller\AbstractController</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Routing\Annotation\Route</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Doctrine\ORM\EntityManagerInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\PasswordHasher\Hasher\UserPasswordHasherInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Security\Http\Authentication\AuthenticationUtils</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\String\Slugger\SluggerInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\File\Exception\FileException</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\File\UploadedFile</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Mailer\MailerInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Mime\Email</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Entity\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Form\UserType</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Form\ResetType</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">AbstractController</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">login</span><span class="p">(</span><span class="nx">AuthenticationUtils</span> <span class="nv">$authenticationUtils</span><span class="p">,</span> <span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nv">$error</span> <span class="o">=</span> <span class="nv">$authenticationUtils</span><span class="o">-&gt;</span><span class="na">getLastAuthenticationError</span><span class="p">();</span>
        <span class="nv">$lastUsername</span> <span class="o">=</span> <span class="nv">$authenticationUtils</span><span class="o">-&gt;</span><span class="na">getLastUsername</span><span class="p">();</span>

        <span class="nv">$alert</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;show&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;show&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;show&quot;</span><span class="p">)</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">)</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">)</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span>
        <span class="p">);</span>

        <span class="k">if</span><span class="p">(</span><span class="nv">$error</span><span class="p">){</span>
            <span class="nv">$alert</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;show&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;show&#39;</span><span class="p">,</span>
                <span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;alert-warning&#39;</span><span class="p">,</span>
                <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Error de autentiación, usuario o contraseñas incorrectos&#39;</span>
            <span class="p">);</span>
        <span class="p">}</span>

        <span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
        <span class="nv">$registrationForm</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">UserType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$user</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;user/login.html.twig&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;registration_form&#39;</span> <span class="o">=&gt;</span> <span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">createView</span><span class="p">(),</span>
            <span class="s1">&#39;last_username&#39;</span> <span class="o">=&gt;</span> <span class="nv">$lastUsername</span><span class="p">,</span>
            <span class="s1">&#39;error&#39;</span> <span class="o">=&gt;</span> <span class="nv">$error</span><span class="p">,</span>
            <span class="s1">&#39;alert&#39;</span> <span class="o">=&gt;</span> <span class="nv">$alert</span>
        <span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">logout</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span> <span class="p">{}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">(</span>
        <span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span>
        <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">,</span>
        <span class="nx">UserPasswordHasherInterface</span> <span class="nv">$passwordHasher</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
        <span class="nv">$registrationForm</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">UserType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$user</span><span class="p">);</span>

        <span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">handleRequest</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">isSubmitted</span><span class="p">()){</span>
            <span class="nv">$email</span> <span class="o">=</span> <span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">();</span>
            <span class="nv">$emailExists</span> <span class="o">=</span> <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="na">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">findOneBy</span><span class="p">([</span><span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="nv">$email</span><span class="p">]);</span>
            <span class="k">if</span><span class="p">(</span><span class="nv">$emailExists</span><span class="p">){</span>
                <span class="nv">$alert</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">&#39;show&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;show&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;alert-danger&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;El email ya se encuentra registrado.&#39;</span>
                <span class="p">);</span>
                <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="nv">$alert</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">if</span><span class="p">(</span><span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">()){</span>
                <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setRoles</span><span class="p">([</span><span class="s1">&#39;ROLE_USER&#39;</span><span class="p">]);</span>
                <span class="nv">$plainPassword</span> <span class="o">=</span> <span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">();</span>
                <span class="nv">$hashedPassword</span> <span class="o">=</span> <span class="nv">$passwordHasher</span><span class="o">-&gt;</span><span class="na">hashPassword</span><span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="nv">$plainPassword</span><span class="p">);</span>
                <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$hashedPassword</span><span class="p">);</span>

                <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
                <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
                <span class="nv">$alert</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">&#39;show&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;show&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;alert-success&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Usuario registrado con éxito. Ya puede iniciar sesión.&#39;</span>
                <span class="p">);</span>
                <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="nv">$alert</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">profile</span><span class="p">(</span>
        <span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span>
        <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">,</span>
        <span class="nx">UserPasswordHasherInterface</span> <span class="nv">$passwordHasher</span><span class="p">,</span>
        <span class="nx">SluggerInterface</span> <span class="nv">$slugger</span>
    <span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getUser</span><span class="p">();</span>
        <span class="nv">$isAvatar</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getAvatar</span><span class="p">();</span>
        <span class="nv">$username</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">();</span>

        <span class="c1">// cargamos los datos para el alert con parámetros a recibir:</span>
        <span class="nv">$alert</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;show&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;show&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;show&quot;</span><span class="p">)</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">)</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">)</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span>
        <span class="p">);</span>

        <span class="k">if</span><span class="p">(</span><span class="nv">$isAvatar</span><span class="p">){</span>
            <span class="nv">$avatar</span> <span class="o">=</span> <span class="s1">&#39;./uploads/avatars/&#39;</span> <span class="o">.</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getAvatar</span><span class="p">();</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="nv">$avatar</span> <span class="o">=</span> <span class="s1">&#39;./assets/images/avatar.png&#39;</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nv">$oldPassword</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getPassword</span><span class="p">();</span>
        <span class="nv">$userEditForm</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">UserType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$user</span><span class="p">);</span>

        <span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">handleRequest</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>

        <span class="k">if</span><span class="p">(</span><span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">isSubmitted</span><span class="p">()){</span>
            <span class="k">if</span><span class="p">(</span><span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">()){</span>
                <span class="nv">$file</span> <span class="o">=</span> <span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;avatar&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">();</span>
                <span class="k">if</span><span class="p">(</span><span class="nv">$file</span><span class="p">){</span>
                    <span class="nv">$originalFilename</span> <span class="o">=</span> <span class="nb">pathinfo</span><span class="p">(</span><span class="nv">$file</span><span class="o">-&gt;</span><span class="na">getClientOriginalName</span><span class="p">(),</span> <span class="nx">PATHINFO_FILENAME</span><span class="p">);</span>
                    <span class="nv">$safeFilename</span> <span class="o">=</span> <span class="nv">$slugger</span><span class="o">-&gt;</span><span class="na">slug</span><span class="p">(</span><span class="nv">$originalFilename</span><span class="p">);</span>
                    <span class="nv">$newFilename</span> <span class="o">=</span> <span class="nv">$safeFilename</span> <span class="o">.</span> <span class="s1">&#39;-&#39;</span> <span class="o">.</span> <span class="nb">uniqid</span><span class="p">()</span> <span class="o">.</span> <span class="s1">&#39;.&#39;</span> <span class="o">.</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">guessExtension</span><span class="p">();</span>
                    <span class="k">try</span><span class="p">{</span>
                        <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">move</span><span class="p">(</span>
                            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getParameter</span><span class="p">(</span><span class="s1">&#39;avatars&#39;</span><span class="p">),</span>
                            <span class="nv">$newFilename</span>
                        <span class="p">);</span>
                    <span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">FileException</span> <span class="nv">$e</span><span class="p">){</span>
                        <span class="c1">// ignoramos el error y seguimos adelante</span>
                    <span class="p">}</span>

                    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setAvatar</span><span class="p">(</span><span class="nv">$newFilename</span><span class="p">);</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setAvatar</span><span class="p">(</span><span class="nv">$isAvatar</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="nv">$plainPassword</span> <span class="o">=</span> <span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">();</span>
                <span class="k">if</span><span class="p">(</span><span class="nv">$plainPassword</span><span class="p">){</span>
                    <span class="nv">$hashedPassword</span> <span class="o">=</span> <span class="nv">$passwordHasher</span><span class="o">-&gt;</span><span class="na">hashPassword</span><span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="nv">$plainPassword</span><span class="p">);</span>
                    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$hashedPassword</span><span class="p">);</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$oldPassword</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>

                <span class="c1">// al actualizar los datos lanzamos un mensaje de aviso:</span>
                <span class="nv">$alert</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">&#39;show&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;show&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;alert-success&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Usuario actualizado con éxito.&#39;</span>
                <span class="p">);</span>

                <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="nv">$alert</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;user/profile.html.twig&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;user_edit_form&#39;</span> <span class="o">=&gt;</span> <span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">createView</span><span class="p">(),</span>
            <span class="s1">&#39;avatar&#39;</span> <span class="o">=&gt;</span> <span class="nv">$avatar</span><span class="p">,</span>
            <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="nv">$username</span><span class="p">,</span>
            <span class="s1">&#39;alert&#39;</span> <span class="o">=&gt;</span> <span class="nv">$alert</span> <span class="c1">// recuerda cargar en twig el alert</span>
        <span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">send_reset_email</span><span class="p">(</span>
        <span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span>
        <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">,</span>
        <span class="nx">MailerInterface</span> <span class="nv">$mailer</span><span class="p">){</span>
        <span class="nv">$email</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;reset_email&#39;</span><span class="p">);</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="na">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">findOneBy</span><span class="p">([</span><span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="nv">$email</span><span class="p">]);</span>

        <span class="k">if</span><span class="p">(</span><span class="nv">$user</span><span class="p">){</span>
            <span class="nv">$prefix</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;sha256&#39;</span><span class="p">,</span> <span class="nv">$_ENV</span><span class="p">[</span><span class="s1">&#39;START_KEY&#39;</span><span class="p">]);</span>
            <span class="nv">$sufix</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;sha256&#39;</span><span class="p">,</span> <span class="nv">$_ENV</span><span class="p">[</span><span class="s1">&#39;END_KEY&#39;</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
            <span class="nv">$hashId</span> <span class="o">=</span> <span class="nb">openssl_encrypt</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getId</span><span class="p">(),</span> <span class="nv">$_ENV</span><span class="p">[</span><span class="s1">&#39;HASH_METHOD&#39;</span><span class="p">],</span> <span class="nv">$prefix</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$sufix</span><span class="p">);</span>

            <span class="nv">$urlSource</span> <span class="o">=</span> <span class="s2">&quot;http://localhost:5000/reset_password/&quot;</span> <span class="o">.</span> <span class="nb">base64_encode</span><span class="p">(</span><span class="nv">$hashId</span><span class="p">);</span>
            <span class="k">echo</span> <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$urlSource</span><span class="p">);</span>

            <span class="nv">$emailToSend</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Email</span><span class="p">())</span>
                            <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;pytonicus@gmail.com&#39;</span><span class="p">)</span>
                            <span class="o">-&gt;</span><span class="na">to</span><span class="p">(</span><span class="nv">$email</span><span class="p">)</span>
                            <span class="o">-&gt;</span><span class="na">subject</span><span class="p">(</span><span class="s1">&#39;ASUNTO: Recuperar contraseña&#39;</span><span class="p">)</span>
                            <span class="o">-&gt;</span><span class="na">text</span><span class="p">(</span><span class="s1">&#39;reestablecer contraseña&#39;</span><span class="p">)</span>
                            <span class="o">-&gt;</span><span class="na">html</span><span class="p">(</span><span class="s1">&#39;&lt;a href=&quot;&#39;</span> <span class="o">.</span> <span class="nv">$urlSource</span> <span class="o">.</span> <span class="s1">&#39;&quot;&gt;&#39;</span> <span class="o">.</span> <span class="nv">$urlSource</span> <span class="o">.</span> <span class="s1">&#39;&lt;/a&gt;&#39;</span><span class="p">);</span>
            <span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="nv">$emailToSend</span><span class="p">);</span>


            <span class="c1">// se envía el mensaje de que todo ha salido bien:</span>
            <span class="nv">$alert</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;show&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;show&#39;</span><span class="p">,</span>
                <span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;alert-success&#39;</span><span class="p">,</span>
                <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Se ha enviado un email con un enlace para restablecer contraseña.&#39;</span>
            <span class="p">);</span>

        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="c1">// se envía el mensaje de que no existe el email en la base de datos</span>
            <span class="nv">$alert</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;show&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;show&#39;</span><span class="p">,</span>
                <span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;alert-warning&#39;</span><span class="p">,</span>
                <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;El email no se encuentra registrado en el sistema.&#39;</span>
            <span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// cargamos el alert:</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="nv">$alert</span><span class="p">);</span>
        <span class="cm">/* Este código lo usamos para depurar el correo:</span>
<span class="cm">        return new Response(</span>
<span class="cm">            &#39;&lt;html&gt;&lt;body&gt;TESTING DE EMAIL&lt;/body&gt;&lt;/html&gt;&#39;</span>
<span class="cm">        ); */</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">reset_password</span><span class="p">(</span>
        <span class="nv">$hashId</span><span class="p">,</span>
        <span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span>
        <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">,</span>
        <span class="nx">UserPasswordHasherInterface</span> <span class="nv">$passwordHasher</span>
        <span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$prefix</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;sha256&#39;</span><span class="p">,</span> <span class="nv">$_ENV</span><span class="p">[</span><span class="s1">&#39;START_KEY&#39;</span><span class="p">]);</span>
        <span class="nv">$sufix</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;sha256&#39;</span><span class="p">,</span> <span class="nv">$_ENV</span><span class="p">[</span><span class="s1">&#39;END_KEY&#39;</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
        <span class="nv">$id</span> <span class="o">=</span> <span class="nb">openssl_decrypt</span><span class="p">(</span><span class="nb">base64_decode</span><span class="p">(</span><span class="nv">$hashId</span><span class="p">),</span> <span class="nv">$_ENV</span><span class="p">[</span><span class="s1">&#39;HASH_METHOD&#39;</span><span class="p">],</span> <span class="nv">$prefix</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$sufix</span><span class="p">);</span>

        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="na">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">findOneBy</span><span class="p">([</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$id</span><span class="p">]);</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$user</span><span class="p">){</span>
            <span class="nv">$newPasswordForm</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">ResetType</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
            <span class="nv">$newPasswordForm</span><span class="o">-&gt;</span><span class="na">handleRequest</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>

            <span class="k">if</span><span class="p">(</span><span class="nv">$newPasswordForm</span><span class="o">-&gt;</span><span class="na">isSubmitted</span><span class="p">()){</span>
                <span class="k">if</span><span class="p">(</span><span class="nv">$newPasswordForm</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">()){</span>
                    <span class="nv">$plainPassword</span> <span class="o">=</span> <span class="nv">$newPasswordForm</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">][</span><span class="s1">&#39;first&#39;</span><span class="p">];</span>
                    <span class="k">if</span><span class="p">(</span><span class="nv">$plainPassword</span><span class="p">){</span>
                        <span class="nv">$hashedPassword</span> <span class="o">=</span> <span class="nv">$passwordHasher</span><span class="o">-&gt;</span><span class="na">hashPassword</span><span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="nv">$plainPassword</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">());</span>
                        <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$hashedPassword</span><span class="p">);</span>
                    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                        <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$oldPassword</span><span class="p">);</span>
                    <span class="p">}</span>
                    <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
                    <span class="c1">// se envía el mensaje de que se ha restablecido la contraseña:</span>
                    <span class="nv">$alert</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
                        <span class="s1">&#39;show&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;show&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;alert-success&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;La contraseña ha sido reestablecida con éxito, ya puede iniciar sesión.&#39;</span>
                    <span class="p">);</span>
                    <span class="c1">// añadimos la alerta:</span>
                    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="nv">$alert</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="c1">// se envía el mensaje de que hubo un error al intentar reestablecer:</span>
            <span class="nv">$alert</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;show&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;show&#39;</span><span class="p">,</span>
                <span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;alert-danger&#39;</span><span class="p">,</span>
                <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Ha habido un error al reestablecer la contraseña, por favor inténtelo de nuevo.&#39;</span>
            <span class="p">);</span>
            <span class="c1">// igualmente pasamos el alert:</span>
            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="nv">$alert</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;user/reset_password.html.twig&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;new_password_form&#39;</span> <span class="o">=&gt;</span> <span class="nv">$newPasswordForm</span><span class="o">-&gt;</span><span class="na">createView</span><span class="p">(),</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>En el caso de profile tendremos que añadir el alert en <strong>profile.html.twig</strong>:</p></li>
</ul>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>{% extends &#39;base.html.twig&#39; %}

{% block title %}Perfil de usuario{% endblock %}

{% block body %}

<span class="cm">&lt;!-- Creamos un alert para avisar de cada estado y le pasamos los datos del array --&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;alert-group alert {{alert[&#39;status&#39;]}} alert-dismissible fade {{alert[&#39;show&#39;]}}&quot;</span> <span class="na">role</span><span class="o">=</span><span class="s">&quot;alert&quot;</span><span class="p">&gt;</span>
    {{alert[&#39;message&#39;]}}
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;button&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn-close&quot;</span> <span class="na">data-bs-dismiss</span><span class="o">=</span><span class="s">&quot;alert&quot;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&quot;Close&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container mt-4 text-center&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>Datos de usuario<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">hr</span> <span class="p">/&gt;</span>
            <span class="cm">&lt;!-- la imagen vamos a cargarla desde controlador --&gt;</span>
            <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;{{avatar}}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;avatarEdit rounded img-thumbnail img-fluid&quot;</span>  <span class="na">alt</span><span class="o">=</span><span class="s">&quot;Avatar&quot;</span> <span class="p">/&gt;</span>
            <span class="cm">&lt;!-- No olvides poner que el formulario es tipo multipart --&gt;</span>
            <span class="p">&lt;</span><span class="nt">form</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;userEditForm&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">role</span><span class="o">=</span><span class="s">&quot;form&quot;</span> <span class="na">enctype</span><span class="o">=</span><span class="s">&#39;multipart/form-data&#39;</span><span class="p">&gt;</span>
                {{ form_row(user_edit_form._token) }}
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-12 mt-3&quot;</span><span class="p">&gt;</span>
                        {{ form_label(user_edit_form.avatar, &#39;avatar&#39;, {&#39;label_attr&#39;: {&#39;style&#39;: &#39;display:none&#39;}}) }}
                        {{ form_widget(user_edit_form.avatar, {&#39;attr&#39;: {&#39;class&#39;: &#39;col me-2 form-control form-sm&#39;, &#39;placeholder&#39;: &#39;Avatar&#39;}}) }}
                        {{ form_errors(user_edit_form.avatar) }}
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-12 mt-3&quot;</span><span class="p">&gt;</span>
                        {{ form_label(user_edit_form.name, &#39;name&#39;, {&#39;label_attr&#39;: {&#39;style&#39;: &#39;display:none&#39;}}) }}
                        {{ form_widget(user_edit_form.name, {&#39;attr&#39;: {&#39;class&#39;: &#39;col me-2 form-control form-sm&#39;, &#39;placeholder&#39;: &#39;Nombre&#39;}}) }}
                        {{ form_errors(user_edit_form.name) }}
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-12 mt-3&quot;</span><span class="p">&gt;</span>
                        {{ form_label(user_edit_form.lastname, &#39;lastname&#39;, {&#39;label_attr&#39;: {&#39;style&#39;: &#39;display:none&#39;}}) }}
                        {{ form_widget(user_edit_form.lastname, {&#39;attr&#39;: {&#39;class&#39;: &#39;col me-2 form-control form-sm&#39;, &#39;placeholder&#39;: &#39;Apellidos&#39;}}) }}
                        {{ form_errors(user_edit_form.lastname) }}
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-12 mt-3&quot;</span><span class="p">&gt;</span>
                        {{ form_label(user_edit_form.email, &#39;email&#39;, {&#39;label_attr&#39;: {&#39;style&#39;: &#39;display:none&#39;}}) }}
                        {{ form_widget(user_edit_form.email, {&#39;attr&#39;: {&#39;class&#39;: &#39;col me-2 form-control form-sm&#39;, &#39;placeholder&#39;: &#39;Email&#39;}}) }}
                        {{ form_errors(user_edit_form.email) }}
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-12 mt-3&quot;</span><span class="p">&gt;</span>
                        {{ form_label(user_edit_form.password, &#39;password&#39;, {&#39;label_attr&#39;: {&#39;style&#39;: &#39;display:none&#39;}}) }}
                        {{ form_widget(user_edit_form.password, {&#39;attr&#39;: {&#39;class&#39;: &#39;col me-2 form-control form-sm&#39;, &#39;placeholder&#39;: &#39;Contraseña (dejar en blanco para no cambiar)&#39;}}) }}
                        {{ form_errors(user_edit_form.password) }}
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-12 mt-3&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-success form-control mt-3&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Actualizar datos&quot;</span> <span class="p">/&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-12 mt-3&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{path(&#39;logout&#39;)}}&quot;</span><span class="p">&gt;</span>Cerrar sesión<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

{% endblock %}
</pre></div>
</div>
</section>
<section id="paso-15-eliminar-usuario">
<h3><a class="toc-backref" href="#id31">Paso 15: Eliminar Usuario</a><a class="headerlink" href="#paso-15-eliminar-usuario" title="Enlazar permanentemente con este título">¶</a></h3>
<ul class="simple">
<li><p>Para eliminar un usuario vamos a añadir un nuevo botón en el template <strong>profile.html.twig</strong>:</p></li>
</ul>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>{% extends &#39;base.html.twig&#39; %}

{% block title %}Perfil de usuario{% endblock %}

{% block body %}

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;alert-group alert {{alert[&#39;status&#39;]}} alert-dismissible fade {{alert[&#39;show&#39;]}}&quot;</span> <span class="na">role</span><span class="o">=</span><span class="s">&quot;alert&quot;</span><span class="p">&gt;</span>
    {{alert[&#39;message&#39;]}}
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;button&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn-close&quot;</span> <span class="na">data-bs-dismiss</span><span class="o">=</span><span class="s">&quot;alert&quot;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&quot;Close&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container mt-4 text-center&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>Datos de usuario<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">hr</span> <span class="p">/&gt;</span>
            <span class="cm">&lt;!-- la imagen vamos a cargarla desde controlador --&gt;</span>
            <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;{{avatar}}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;avatarEdit rounded img-thumbnail img-fluid&quot;</span>  <span class="na">alt</span><span class="o">=</span><span class="s">&quot;Avatar&quot;</span> <span class="p">/&gt;</span>
            <span class="cm">&lt;!-- No olvides poner que el formulario es tipo multipart --&gt;</span>
            <span class="p">&lt;</span><span class="nt">form</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;userEditForm&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">role</span><span class="o">=</span><span class="s">&quot;form&quot;</span> <span class="na">enctype</span><span class="o">=</span><span class="s">&#39;multipart/form-data&#39;</span><span class="p">&gt;</span>
                {{ form_row(user_edit_form._token) }}
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-12 mt-3&quot;</span><span class="p">&gt;</span>
                        {{ form_label(user_edit_form.avatar, &#39;avatar&#39;, {&#39;label_attr&#39;: {&#39;style&#39;: &#39;display:none&#39;}}) }}
                        {{ form_widget(user_edit_form.avatar, {&#39;attr&#39;: {&#39;class&#39;: &#39;col me-2 form-control form-sm&#39;, &#39;placeholder&#39;: &#39;Avatar&#39;}}) }}
                        {{ form_errors(user_edit_form.avatar) }}
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-12 mt-3&quot;</span><span class="p">&gt;</span>
                        {{ form_label(user_edit_form.name, &#39;name&#39;, {&#39;label_attr&#39;: {&#39;style&#39;: &#39;display:none&#39;}}) }}
                        {{ form_widget(user_edit_form.name, {&#39;attr&#39;: {&#39;class&#39;: &#39;col me-2 form-control form-sm&#39;, &#39;placeholder&#39;: &#39;Nombre&#39;}}) }}
                        {{ form_errors(user_edit_form.name) }}
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-12 mt-3&quot;</span><span class="p">&gt;</span>
                        {{ form_label(user_edit_form.lastname, &#39;lastname&#39;, {&#39;label_attr&#39;: {&#39;style&#39;: &#39;display:none&#39;}}) }}
                        {{ form_widget(user_edit_form.lastname, {&#39;attr&#39;: {&#39;class&#39;: &#39;col me-2 form-control form-sm&#39;, &#39;placeholder&#39;: &#39;Apellidos&#39;}}) }}
                        {{ form_errors(user_edit_form.lastname) }}
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-12 mt-3&quot;</span><span class="p">&gt;</span>
                        {{ form_label(user_edit_form.email, &#39;email&#39;, {&#39;label_attr&#39;: {&#39;style&#39;: &#39;display:none&#39;}}) }}
                        {{ form_widget(user_edit_form.email, {&#39;attr&#39;: {&#39;class&#39;: &#39;col me-2 form-control form-sm&#39;, &#39;placeholder&#39;: &#39;Email&#39;}}) }}
                        {{ form_errors(user_edit_form.email) }}
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-12 mt-3&quot;</span><span class="p">&gt;</span>
                        {{ form_label(user_edit_form.password, &#39;password&#39;, {&#39;label_attr&#39;: {&#39;style&#39;: &#39;display:none&#39;}}) }}
                        {{ form_widget(user_edit_form.password, {&#39;attr&#39;: {&#39;class&#39;: &#39;col me-2 form-control form-sm&#39;, &#39;placeholder&#39;: &#39;Contraseña (dejar en blanco para no cambiar)&#39;}}) }}
                        {{ form_errors(user_edit_form.password) }}
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-12 mt-3&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-success form-control mt-3&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Actualizar datos&quot;</span> <span class="p">/&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-12 mt-3&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{path(&#39;logout&#39;)}}&quot;</span><span class="p">&gt;</span>Cerrar sesión<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="cm">&lt;!-- creamos un nuevo botón para eliminar el usuario: --&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-md-12 mt-3&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;button&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;cursor cursor-delete me-2 mb-1&quot;</span> <span class="na">data-bs-toggle</span><span class="o">=</span><span class="s">&quot;modal&quot;</span> <span class="na">data-bs-target</span><span class="o">=</span><span class="s">&quot;#deleteUserModal&quot;</span><span class="p">&gt;</span>Dar de baja usuario<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- cargamos el modal aquí abajo: --&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal fade&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;deleteUserModal&quot;</span> <span class="na">tabIndex</span><span class="o">=</span><span class="s">&quot;-1&quot;</span> <span class="na">aria-labelledby</span><span class="o">=</span><span class="s">&quot;exampleModalLabel&quot;</span> <span class="na">aria-hidden</span><span class="o">=</span><span class="s">&quot;true&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-dialog&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-content&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-header&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">h5</span> <span class="na">className</span><span class="o">=</span><span class="s">&quot;modal-title&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;exampleModalLabel&quot;</span><span class="p">&gt;</span>Cerrar cuenta<span class="p">&lt;/</span><span class="nt">h5</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;button&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn-close&quot;</span> <span class="na">data-bs-dismiss</span><span class="o">=</span><span class="s">&quot;modal&quot;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&quot;Close&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-body&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Se va a eliminar su cuenta de usuario junto a todas sus tareas<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Esta operación no tiene retorno, ¿proceder?<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-footer&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;button&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-secondary&quot;</span> <span class="na">data-bs-dismiss</span><span class="o">=</span><span class="s">&quot;modal&quot;</span><span class="p">&gt;</span>Cancelar<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
            <span class="cm">&lt;!-- añadir función al botón: --&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{path(&#39;delete_user&#39;)}}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-danger&quot;</span><span class="p">&gt;</span>Aceptar<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

{% endblock %}
</pre></div>
</div>
<ul class="simple">
<li><p>Añadimos el estilo nuevo del botón al final de <strong>base.css</strong>:</p></li>
</ul>
<div class="highlight-css notranslate"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nc">cursor</span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">border</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="kt">px</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="kc">transparent</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="nc">cursor-delete</span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="kc">red</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><p>Creamos el método para eliminar al usuario en <strong>UserController.php</strong>:</p></li>
</ul>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Bundle\FrameworkBundle\Controller\AbstractController</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Routing\Annotation\Route</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Doctrine\ORM\EntityManagerInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\PasswordHasher\Hasher\UserPasswordHasherInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Security\Http\Authentication\AuthenticationUtils</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\String\Slugger\SluggerInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\File\Exception\FileException</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\File\UploadedFile</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Mailer\MailerInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Mime\Email</span><span class="p">;</span>
<span class="c1">// cargamos las siguientes librerías para poder cerrar sesión antes de borrar usuario:</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Security\Core\Authentication\Token\Storage\TokenStorageInterface</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Entity\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Form\UserType</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Form\ResetType</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">AbstractController</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">login</span><span class="p">(</span><span class="nx">AuthenticationUtils</span> <span class="nv">$authenticationUtils</span><span class="p">,</span> <span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nv">$error</span> <span class="o">=</span> <span class="nv">$authenticationUtils</span><span class="o">-&gt;</span><span class="na">getLastAuthenticationError</span><span class="p">();</span>
        <span class="nv">$lastUsername</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>

        <span class="nv">$alert</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;show&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;show&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;show&quot;</span><span class="p">)</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">)</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">)</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span>
        <span class="p">);</span>

        <span class="k">if</span><span class="p">(</span><span class="nv">$error</span><span class="p">){</span>
            <span class="nv">$alert</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;show&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;show&#39;</span><span class="p">,</span>
                <span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;alert-warning&#39;</span><span class="p">,</span>
                <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Error de autentiación, usuario o contraseñas incorrectos&#39;</span>
            <span class="p">);</span>
        <span class="p">}</span>

        <span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
        <span class="nv">$registrationForm</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">UserType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$user</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;user/login.html.twig&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;registration_form&#39;</span> <span class="o">=&gt;</span> <span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">createView</span><span class="p">(),</span>
            <span class="s1">&#39;last_username&#39;</span> <span class="o">=&gt;</span> <span class="nv">$lastUsername</span><span class="p">,</span>
            <span class="s1">&#39;error&#39;</span> <span class="o">=&gt;</span> <span class="nv">$error</span><span class="p">,</span>
            <span class="s1">&#39;alert&#39;</span> <span class="o">=&gt;</span> <span class="nv">$alert</span>
        <span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">logout</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span> <span class="p">{}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">(</span>
        <span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span>
        <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">,</span>
        <span class="nx">UserPasswordHasherInterface</span> <span class="nv">$passwordHasher</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
        <span class="nv">$registrationForm</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">UserType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$user</span><span class="p">);</span>

        <span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">handleRequest</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">isSubmitted</span><span class="p">()){</span>
            <span class="nv">$email</span> <span class="o">=</span> <span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">();</span>
            <span class="nv">$emailExists</span> <span class="o">=</span> <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="na">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">findOneBy</span><span class="p">([</span><span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="nv">$email</span><span class="p">]);</span>
            <span class="k">if</span><span class="p">(</span><span class="nv">$emailExists</span><span class="p">){</span>
                <span class="nv">$alert</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">&#39;show&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;show&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;alert-danger&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;El email ya se encuentra registrado.&#39;</span>
                <span class="p">);</span>
                <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="nv">$alert</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">if</span><span class="p">(</span><span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">()){</span>
                <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setRoles</span><span class="p">([</span><span class="s1">&#39;ROLE_USER&#39;</span><span class="p">]);</span>
                <span class="nv">$plainPassword</span> <span class="o">=</span> <span class="nv">$registrationForm</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">();</span>
                <span class="nv">$hashedPassword</span> <span class="o">=</span> <span class="nv">$passwordHasher</span><span class="o">-&gt;</span><span class="na">hashPassword</span><span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="nv">$plainPassword</span><span class="p">);</span>
                <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$hashedPassword</span><span class="p">);</span>

                <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
                <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
                <span class="nv">$alert</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">&#39;show&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;show&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;alert-success&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Usuario registrado con éxito. Ya puede iniciar sesión.&#39;</span>
                <span class="p">);</span>
                <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="nv">$alert</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">profile</span><span class="p">(</span>
        <span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span>
        <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">,</span>
        <span class="nx">UserPasswordHasherInterface</span> <span class="nv">$passwordHasher</span><span class="p">,</span>
        <span class="nx">SluggerInterface</span> <span class="nv">$slugger</span>
    <span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getUser</span><span class="p">();</span>
        <span class="nv">$isAvatar</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getAvatar</span><span class="p">();</span>
        <span class="nv">$username</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">();</span>

        <span class="nv">$alert</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;show&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;show&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;show&quot;</span><span class="p">)</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">)</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">)</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span>
        <span class="p">);</span>

        <span class="k">if</span><span class="p">(</span><span class="nv">$isAvatar</span><span class="p">){</span>
            <span class="nv">$avatar</span> <span class="o">=</span> <span class="s1">&#39;./uploads/avatars/&#39;</span> <span class="o">.</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getAvatar</span><span class="p">();</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="nv">$avatar</span> <span class="o">=</span> <span class="s1">&#39;./assets/images/avatar.png&#39;</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nv">$oldPassword</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getPassword</span><span class="p">();</span>
        <span class="nv">$userEditForm</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">UserType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$user</span><span class="p">);</span>

        <span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">handleRequest</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>

        <span class="k">if</span><span class="p">(</span><span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">isSubmitted</span><span class="p">()){</span>
            <span class="k">if</span><span class="p">(</span><span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">()){</span>
                <span class="nv">$file</span> <span class="o">=</span> <span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;avatar&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">();</span>
                <span class="k">if</span><span class="p">(</span><span class="nv">$file</span><span class="p">){</span>
                    <span class="nv">$originalFilename</span> <span class="o">=</span> <span class="nb">pathinfo</span><span class="p">(</span><span class="nv">$file</span><span class="o">-&gt;</span><span class="na">getClientOriginalName</span><span class="p">(),</span> <span class="nx">PATHINFO_FILENAME</span><span class="p">);</span>
                    <span class="nv">$safeFilename</span> <span class="o">=</span> <span class="nv">$slugger</span><span class="o">-&gt;</span><span class="na">slug</span><span class="p">(</span><span class="nv">$originalFilename</span><span class="p">);</span>
                    <span class="nv">$newFilename</span> <span class="o">=</span> <span class="nv">$safeFilename</span> <span class="o">.</span> <span class="s1">&#39;-&#39;</span> <span class="o">.</span> <span class="nb">uniqid</span><span class="p">()</span> <span class="o">.</span> <span class="s1">&#39;.&#39;</span> <span class="o">.</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">guessExtension</span><span class="p">();</span>
                    <span class="k">try</span><span class="p">{</span>
                        <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">move</span><span class="p">(</span>
                            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getParameter</span><span class="p">(</span><span class="s1">&#39;avatars&#39;</span><span class="p">),</span>
                            <span class="nv">$newFilename</span>
                        <span class="p">);</span>
                    <span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">FileException</span> <span class="nv">$e</span><span class="p">){</span>
                        <span class="c1">// ignoramos el error y seguimos adelante</span>
                    <span class="p">}</span>

                    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setAvatar</span><span class="p">(</span><span class="nv">$newFilename</span><span class="p">);</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setAvatar</span><span class="p">(</span><span class="nv">$isAvatar</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="nv">$plainPassword</span> <span class="o">=</span> <span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">();</span>
                <span class="k">if</span><span class="p">(</span><span class="nv">$plainPassword</span><span class="p">){</span>
                    <span class="nv">$hashedPassword</span> <span class="o">=</span> <span class="nv">$passwordHasher</span><span class="o">-&gt;</span><span class="na">hashPassword</span><span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="nv">$plainPassword</span><span class="p">);</span>
                    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$hashedPassword</span><span class="p">);</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$oldPassword</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>

                <span class="nv">$alert</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">&#39;show&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;show&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;alert-success&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Usuario actualizado con éxito.&#39;</span>
                <span class="p">);</span>

                <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="nv">$alert</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;user/profile.html.twig&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;user_edit_form&#39;</span> <span class="o">=&gt;</span> <span class="nv">$userEditForm</span><span class="o">-&gt;</span><span class="na">createView</span><span class="p">(),</span>
            <span class="s1">&#39;avatar&#39;</span> <span class="o">=&gt;</span> <span class="nv">$avatar</span><span class="p">,</span>
            <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="nv">$username</span><span class="p">,</span>
            <span class="s1">&#39;alert&#39;</span> <span class="o">=&gt;</span> <span class="nv">$alert</span>
        <span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">send_reset_email</span><span class="p">(</span>
        <span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span>
        <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">,</span>
        <span class="nx">MailerInterface</span> <span class="nv">$mailer</span><span class="p">){</span>
        <span class="nv">$email</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;reset_email&#39;</span><span class="p">);</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="na">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">findOneBy</span><span class="p">([</span><span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="nv">$email</span><span class="p">]);</span>

        <span class="k">if</span><span class="p">(</span><span class="nv">$user</span><span class="p">){</span>
            <span class="nv">$prefix</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;sha256&#39;</span><span class="p">,</span> <span class="nv">$_ENV</span><span class="p">[</span><span class="s1">&#39;START_KEY&#39;</span><span class="p">]);</span>
            <span class="nv">$sufix</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;sha256&#39;</span><span class="p">,</span> <span class="nv">$_ENV</span><span class="p">[</span><span class="s1">&#39;END_KEY&#39;</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
            <span class="nv">$hashId</span> <span class="o">=</span> <span class="nb">openssl_encrypt</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getId</span><span class="p">(),</span> <span class="nv">$_ENV</span><span class="p">[</span><span class="s1">&#39;HASH_METHOD&#39;</span><span class="p">],</span> <span class="nv">$prefix</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$sufix</span><span class="p">);</span>

            <span class="nv">$urlSource</span> <span class="o">=</span> <span class="s2">&quot;http://localhost:5000/reset_password/&quot;</span> <span class="o">.</span> <span class="nb">base64_encode</span><span class="p">(</span><span class="nv">$hashId</span><span class="p">);</span>
            <span class="k">echo</span> <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$urlSource</span><span class="p">);</span>

            <span class="nv">$emailToSend</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Email</span><span class="p">())</span>
                            <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="s1">&#39;pytonicus@gmail.com&#39;</span><span class="p">)</span>
                            <span class="o">-&gt;</span><span class="na">to</span><span class="p">(</span><span class="nv">$email</span><span class="p">)</span>
                            <span class="o">-&gt;</span><span class="na">subject</span><span class="p">(</span><span class="s1">&#39;ASUNTO: Recuperar contraseña&#39;</span><span class="p">)</span>
                            <span class="o">-&gt;</span><span class="na">text</span><span class="p">(</span><span class="s1">&#39;reestablecer contraseña&#39;</span><span class="p">)</span>
                            <span class="o">-&gt;</span><span class="na">html</span><span class="p">(</span><span class="s1">&#39;&lt;a href=&quot;&#39;</span> <span class="o">.</span> <span class="nv">$urlSource</span> <span class="o">.</span> <span class="s1">&#39;&quot;&gt;&#39;</span> <span class="o">.</span> <span class="nv">$urlSource</span> <span class="o">.</span> <span class="s1">&#39;&lt;/a&gt;&#39;</span><span class="p">);</span>
            <span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="nv">$emailToSend</span><span class="p">);</span>


            <span class="nv">$alert</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;show&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;show&#39;</span><span class="p">,</span>
                <span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;alert-success&#39;</span><span class="p">,</span>
                <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Se ha enviado un email con un enlace para restablecer contraseña.&#39;</span>
            <span class="p">);</span>

        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="nv">$alert</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;show&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;show&#39;</span><span class="p">,</span>
                <span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;alert-warning&#39;</span><span class="p">,</span>
                <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;El email no se encuentra registrado en el sistema.&#39;</span>
            <span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="nv">$alert</span><span class="p">);</span>
        <span class="cm">/* Este código lo usamos para depurar el correo:</span>
<span class="cm">        return new Response(</span>
<span class="cm">            &#39;&lt;html&gt;&lt;body&gt;TESTING DE EMAIL&lt;/body&gt;&lt;/html&gt;&#39;</span>
<span class="cm">        ); */</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">reset_password</span><span class="p">(</span>
        <span class="nv">$hashId</span><span class="p">,</span>
        <span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span>
        <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">,</span>
        <span class="nx">UserPasswordHasherInterface</span> <span class="nv">$passwordHasher</span>
        <span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$prefix</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;sha256&#39;</span><span class="p">,</span> <span class="nv">$_ENV</span><span class="p">[</span><span class="s1">&#39;START_KEY&#39;</span><span class="p">]);</span>
        <span class="nv">$sufix</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;sha256&#39;</span><span class="p">,</span> <span class="nv">$_ENV</span><span class="p">[</span><span class="s1">&#39;END_KEY&#39;</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
        <span class="nv">$id</span> <span class="o">=</span> <span class="nb">openssl_decrypt</span><span class="p">(</span><span class="nb">base64_decode</span><span class="p">(</span><span class="nv">$hashId</span><span class="p">),</span> <span class="nv">$_ENV</span><span class="p">[</span><span class="s1">&#39;HASH_METHOD&#39;</span><span class="p">],</span> <span class="nv">$prefix</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$sufix</span><span class="p">);</span>

        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="na">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">findOneBy</span><span class="p">([</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$id</span><span class="p">]);</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$user</span><span class="p">){</span>
            <span class="nv">$newPasswordForm</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createForm</span><span class="p">(</span><span class="nx">ResetType</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
            <span class="nv">$newPasswordForm</span><span class="o">-&gt;</span><span class="na">handleRequest</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>

            <span class="k">if</span><span class="p">(</span><span class="nv">$newPasswordForm</span><span class="o">-&gt;</span><span class="na">isSubmitted</span><span class="p">()){</span>
                <span class="k">if</span><span class="p">(</span><span class="nv">$newPasswordForm</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">()){</span>
                    <span class="nv">$plainPassword</span> <span class="o">=</span> <span class="nv">$newPasswordForm</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">][</span><span class="s1">&#39;first&#39;</span><span class="p">];</span>
                    <span class="k">if</span><span class="p">(</span><span class="nv">$plainPassword</span><span class="p">){</span>
                        <span class="nv">$hashedPassword</span> <span class="o">=</span> <span class="nv">$passwordHasher</span><span class="o">-&gt;</span><span class="na">hashPassword</span><span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="nv">$plainPassword</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">());</span>
                        <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$hashedPassword</span><span class="p">);</span>
                    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                        <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$oldPassword</span><span class="p">);</span>
                    <span class="p">}</span>
                    <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
                    <span class="nv">$alert</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
                        <span class="s1">&#39;show&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;show&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;alert-success&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;La contraseña ha sido reestablecida con éxito, ya puede iniciar sesión.&#39;</span>
                    <span class="p">);</span>
                    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="nv">$alert</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="nv">$alert</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;show&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;show&#39;</span><span class="p">,</span>
                <span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;alert-danger&#39;</span><span class="p">,</span>
                <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Ha habido un error al reestablecer la contraseña, por favor inténtelo de nuevo.&#39;</span>
            <span class="p">);</span>
            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="nv">$alert</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;user/reset_password.html.twig&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;new_password_form&#39;</span> <span class="o">=&gt;</span> <span class="nv">$newPasswordForm</span><span class="o">-&gt;</span><span class="na">createView</span><span class="p">(),</span>
        <span class="p">]);</span>
    <span class="p">}</span>

    <span class="c1">// creamos el método para eliminar el usuario y para cerrar sesión:</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">delete_user</span><span class="p">(</span>
        <span class="nx">EntityManagerInterface</span> <span class="nv">$doctrine</span><span class="p">,</span>
        <span class="nx">TokenStorageInterface</span> <span class="nv">$tokenStorage</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="c1">// recuperamos el usuario que esta en sesión:</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getUser</span><span class="p">();</span>

        <span class="k">if</span><span class="p">(</span><span class="nv">$user</span><span class="p">){</span>
            <span class="c1">// cerramos la sesión vaciando el token:</span>
            <span class="nv">$tokenStorage</span><span class="o">-&gt;</span><span class="na">setToken</span><span class="p">();</span>

            <span class="c1">// borramos al usuario si realmente existe:</span>
            <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">remove</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
            <span class="nv">$doctrine</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="c1">// notificamos que ha sido dado de baja en login:</span>
        <span class="nv">$alert</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;show&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;show&#39;</span><span class="p">,</span>
            <span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;alert-danger&#39;</span><span class="p">,</span>
            <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Su usuario ha sido dado de baja. Ya no podrá iniciar sesión con el&#39;</span>
        <span class="p">);</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="nv">$alert</span><span class="p">);</span>

    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Asignamos la ruta nueva para eliminar usuario en <strong>routes.yaml</strong>:</p></li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">index</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\TaskController::index</span><span class="w"></span>

<span class="nt">finish</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tasks/finish/{id}</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\TaskController::finish</span><span class="w"></span>

<span class="nt">delete</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tasks/delete/{id}</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\TaskController::delete</span><span class="w"></span>

<span class="nt">update</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tasks/update/{id}</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\TaskController::update</span><span class="w"></span>

<span class="nt">login</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/login</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\UserController::login</span><span class="w"></span>

<span class="nt">logout</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/logout</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\UserController::logout</span><span class="w"></span>

<span class="nt">register</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/register</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\UserController::register</span><span class="w"></span>

<span class="nt">profile</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/profile</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\UserController::profile</span><span class="w"></span>

<span class="nt">send_reset_email</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/send_reset_email</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\UserController::send_reset_email</span><span class="w"></span>

<span class="nt">reset_password</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/reset_password/{hashId}</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\UserController::reset_password</span><span class="w"></span>

<span class="c1"># ruta para eliminar usuario:</span><span class="w"></span>
<span class="nt">delete_user</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/delete_user</span><span class="w"></span>
<span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">App\Controller\UserController::delete_user</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="paso-16-subir-cambios-a-github">
<h3><a class="toc-backref" href="#id32">Paso 16: Subir cambios a GitHub</a><a class="headerlink" href="#paso-16-subir-cambios-a-github" title="Enlazar permanentemente con este título">¶</a></h3>
<ul class="simple">
<li><p>Parar ejecución de app.</p></li>
<li><p>Añadir cambios: <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">add</span> <span class="pre">.</span></code></p></li>
<li><p>Realizar un commit: <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">commit</span> <span class="pre">-am</span> <span class="pre">&quot;Phase</span> <span class="pre">2</span> <span class="pre">complete&quot;</span></code></p></li>
<li><p>Subir cambios a Github con el nombre de la rama actual: <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">push</span> <span class="pre">origin</span> <span class="pre">feature/phase-2-user-authentication</span></code></p></li>
<li><p>Desde gitHub presionar botón <strong>Compare &amp; pull request</strong>.</p></li>
<li><p>cambiar rama base <strong>master</strong> por <strong>developer</strong> y pulsar <strong>Create pull request</strong></p></li>
<li><p>Pulsar en <strong>Merge pull request</strong> y a continuación en <strong>Confirm merge</strong>.</p></li>
<li><p>Una vez terminado volvemos a local y cambiamos de rama a developer: <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">checkout</span> <span class="pre">developer</span></code></p></li>
<li><p>Actualizamos rama developer: <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">pull</span> <span class="pre">origin</span> <span class="pre">developer</span></code></p></li>
</ul>
<p>Y con esto concluye la segunda fase del proyecto.</p>
<hr><br></section>
</section>
</section>


          </div>
          <div class="page-nav">
            <div class="inner"><ul class="page-nav">
  <li class="prev">
    <a href="../frontend/angular.html"
       title="capítulo anterior">← Frontend Angular Task Learn</a>
  </li>
</ul><div class="footer" role="contentinfo">
      &#169; Derechos de autor Creado por Guillermo Granados Gomez bajo Licencia MIT.
</div>
            </div>
          </div>
      </page>
    </div></div>
    
    
  </body>
</html>